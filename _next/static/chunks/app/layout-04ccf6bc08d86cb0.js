(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{347:()=>{},881:(t,e,o)=>{"use strict";o.d(e,{Providers:()=>i});var a=o(5155),n=o(4540),s=o(2738);function i(t){let{children:e}=t;return(0,a.jsxs)(n.Kq,{store:s.M,children:[" ",e," "]})}},1006:(t,e,o)=>{"use strict";o.d(e,{Ay:()=>b,GI:()=>l,Ih:()=>d,K9:()=>c,LT:()=>h,Q6:()=>n,QH:()=>s,Zv:()=>x,_h:()=>i,k5:()=>y,oc:()=>u,y5:()=>r});let a=(0,o(1990).Z0)({name:"annotationSettings",initialState:{bbox:{0:{name:"default",color:[255,255,255]}},keypoint:{0:{name:"default",color:[255,255,255]}},polygon:{0:{name:"default",color:[255,255,255]}},line:{0:{name:"default",color:[255,255,255]}},obb:{0:{name:"default",color:[255,255,255]}},rectMinEdgeSize:.02},reducers:{addRectClass:(t,e)=>{t.bbox[e.payload.id]=e.payload.attrs},addPointClass:(t,e)=>{t.keypoint[e.payload.id]=e.payload.attrs},addPolygonClass:(t,e)=>{t.polygon[e.payload.id]=e.payload.attrs},addLineClass:(t,e)=>{t.line[e.payload.id]=e.payload.attrs},addObbClass:(t,e)=>{t.obb[e.payload.id]=e.payload.attrs},deleteRectClass:(t,e)=>{delete t.bbox[e.payload]},deletePointClass:(t,e)=>{delete t.keypoint[e.payload]},deletePolygonClass:(t,e)=>{delete t.polygon[e.payload]},deleteLineClass:(t,e)=>{delete t.line[e.payload]},deleteObbClass:(t,e)=>{delete t.obb[e.payload]},setSettings:(t,e)=>({...t,...e.payload})}}),{addRectClass:n,deleteRectClass:s,addPolygonClass:i,deletePolygonClass:l,addPointClass:r,deletePointClass:d,addLineClass:c,deleteLineClass:y,addObbClass:x,deleteObbClass:h,setSettings:u}=a.actions,b=a.reducer},1783:(t,e,o)=>{"use strict";o.d(e,{Ay:()=>F,B:()=>H,Bb:()=>f,Bj:()=>C,C5:()=>A,DE:()=>V,HD:()=>k,Kg:()=>h,M:()=>u,Mu:()=>I,O8:()=>M,OE:()=>d,QA:()=>E,Rx:()=>D,U_:()=>x,_y:()=>p,aA:()=>m,cE:()=>g,cr:()=>y,eU:()=>w,fw:()=>b,ke:()=>z,nF:()=>N,nT:()=>O,nj:()=>v,rJ:()=>_,rY:()=>r,v0:()=>P,vJ:()=>j,xJ:()=>c,xh:()=>S});var a=o(1990),n=o(7355),s=o(8108);let i={selectedAnnotation:-1,selectedVertex:-1,hoveringAnnotation:-1,hoveringVertex:-1,annotations:{},annotationsHistory:{0:{annotations:{},length:0}},historyIndex:0,selectedTool:"SELECT",width:640,height:640,selectedClassID:0,lastIndex:0,historyLastIndex:0,zoom:800,offsets:{x:0,y:0},isDrawing:!1,isEditing:!1,previousMousePosition:null},l=(0,a.Z0)({name:"canvas",initialState:i,reducers:{loadAnnotations:(t,e)=>{t.lastIndex=e.payload.length;let o={};e.payload.forEach((t,e)=>{o[e]={object:t}}),t.annotations=o,t.annotationsHistory={0:{annotations:o,length:e.payload.length}}},startDrawRect:(t,e)=>{let o=e.payload.classID,a=e.payload.mousePosition,n={type:"bbox",class_id:o,x1:a.x,y1:a.y,x2:a.x,y2:a.y};t.annotations[t.lastIndex]={object:n},t.lastIndex+=1},drawPoint:(t,e)=>{let o=e.payload.classID,a=e.payload.mousePosition,n={type:"keypoint",class_id:o,x:a.x,y:a.y};t.annotations[t.lastIndex]={object:n},t.lastIndex+=1},resetHistory:t=>{t.annotationsHistory={0:{annotations:{},length:0}},t.historyIndex=0},saveAnnotationsHistory:t=>{t.annotationsHistory[t.historyIndex+1]={annotations:t.annotations,length:t.lastIndex},t.historyLastIndex=t.historyIndex+1,t.historyIndex+=1,console.log("saving state")},goForwardHistory:t=>{t.historyIndex<t.historyLastIndex&&(t.historyIndex+=1,t.annotations=t.annotationsHistory[t.historyIndex].annotations,t.lastIndex=t.annotationsHistory[t.historyIndex].length)},goBackwardHistory:t=>{t.historyIndex>0&&(t.historyIndex-=1,t.annotations=t.annotationsHistory[t.historyIndex].annotations,t.lastIndex=t.annotationsHistory[t.historyIndex].length)},updateDrawRect:(t,e)=>{let o=t.annotations[t.lastIndex-1].object;if("bbox"!=o.type)return;let a=e.payload;t.annotations[t.lastIndex-1].object={type:"bbox",class_id:o.class_id,x1:o.x1,y1:o.y1,x2:a.x,y2:a.y}},updateAnnotation:(t,e)=>{t.annotations[e.payload.Index].object=e.payload.updatedAnnotation},updateHoveringAnnotation:(t,e)=>{t.hoveringAnnotation=-1;let o=e.payload;for(let[e,a]of Object.entries(t.annotations)){switch(a.object.type){case"polygon":case"obb":case"line":break;case"bbox":n.A.containPoint(a.object,o.x,o.y)&&(t.hoveringAnnotation=Number(e));break;case"keypoint":s.A.isNear(a.object,o.x,o.y)&&(t.hoveringAnnotation=Number(e))}if(-1!=t.hoveringAnnotation)break}},updateHoveringVertex:(t,e)=>{let o=e.payload;if(t.selectedAnnotation>-1){let e=t.annotations[t.selectedAnnotation].object;switch(e.type){case"polygon":case"obb":case"line":break;case"bbox":let a=n.A.findNearestVertex(e,o.x,o.y);null!=a?t.hoveringVertex=a:t.hoveringVertex=-1}}},selectAnnotationFromHover:t=>{t.selectedAnnotation=t.hoveringAnnotation},selectVertexFromHover:t=>{t.selectedVertex=t.hoveringVertex},resetSelectedAnnotation:t=>{t.selectedAnnotation=-1},setSelectedAnnotation:(t,e)=>{t.selectedAnnotation=e.payload},resetSelectedVertex:t=>{t.selectedVertex=-1},moveVertex:(t,e)=>{let o=e.payload;if(t.selectedAnnotation>-1&&t.selectedVertex>-1){let e=t.annotations[t.selectedAnnotation].object;switch(e.type){case"polygon":case"obb":case"line":break;case"bbox":let a=n.A.moveVertex(e,o.x,o.y,t.selectedVertex);void 0!=a&&(t.annotations[t.selectedAnnotation].object=a)}}},moveSelectedPoint:(t,e)=>{let o=e.payload,a=t.annotations[t.selectedAnnotation].object;if("keypoint"==a.type){let e=s.A.move(a,o.x,o.y);t.annotations[t.selectedAnnotation].object=e}},setPreviousMousePosition:(t,e)=>{let o=e.payload;t.previousMousePosition={x:o.x,y:o.y}},resetPreviousMousePosition:t=>{t.previousMousePosition=null},setSelectedTool:(t,e)=>{t.selectedTool=e.payload},setCanvasSize:(t,e)=>{t.width=e.payload.width,t.height=e.payload.height},setSelectedClassID:(t,e)=>{t.selectedClassID=e.payload},removeAnnotation:(t,e)=>{delete t.annotations[e.payload]},setIsDrawing:(t,e)=>{t.isDrawing=e.payload},setIsEditing:(t,e)=>{t.isEditing=e.payload},zoomIn:t=>{t.zoom=t.zoom+50},zoomOut:t=>{t.zoom=Math.max(t.zoom-50,400)},setOffsets:(t,e)=>{t.offsets=e.payload},resetCanvasState:()=>i}}),{startDrawRect:r,updateDrawRect:d,updateHoveringAnnotation:c,updateHoveringVertex:y,goBackwardHistory:x,goForwardHistory:h,selectAnnotationFromHover:u,selectVertexFromHover:b,setSelectedTool:p,moveVertex:g,resetCanvasState:v,resetSelectedAnnotation:m,resetSelectedVertex:f,saveAnnotationsHistory:I,setCanvasSize:A,setSelectedClassID:P,loadAnnotations:k,resetHistory:w,setSelectedAnnotation:S,removeAnnotation:M,updateAnnotation:_,setIsDrawing:C,setIsEditing:j,drawPoint:V,moveSelectedPoint:H,setPreviousMousePosition:E,resetPreviousMousePosition:D,zoomIn:N,zoomOut:z,setOffsets:O}=l.actions,F=l.reducer},2738:(t,e,o)=>{"use strict";o.d(e,{M:()=>i});var a=o(1990),n=o(1783),s=o(1006);let i=(0,a.U1)({reducer:{canvas:n.Ay,settings:s.Ay}})},4147:t=>{t.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_8c1c42",variable:"__variable_8c1c42"}},5373:(t,e,o)=>{"use strict";o.d(e,{B:()=>l,ProjectProvider:()=>i});var a=o(5155),n=o(2115);let s=(0,n.createContext)(void 0);function i(t){let{children:e}=t,[o,i]=(0,n.useState)(null),[l,r]=(0,n.useState)(null),[d,c]=(0,n.useState)(null),[y,x]=(0,n.useState)(null),[h,u]=(0,n.useState)(!1);return(0,a.jsx)(s.Provider,{value:{rootDirHandle:o,setRootDirHandle:i,imagesDirHandle:l,setImagesDirHandle:r,annotationsDirHandle:d,setAnnotationsDirHandle:c,db:y,setDb:x,isReady:h,setIsReady:u},children:e})}function l(){let t=(0,n.useContext)(s);if(!t)throw Error("useProject must be used within a ProjectProvider");return t}},7355:(t,e,o)=>{"use strict";o.d(e,{A:()=>n});class a{static move(t,e,o){let a=!0;if([1,2,3,4].forEach(n=>{var s,i;let l=this.giveVertex(t,n);l&&(s=l.x,i=l.y,s+e<0||s+e>1||i+o<0||i+o>1)&&(a=!1)}),a){let a={...t};return a.x1=a.x1+e,a.x2=a.x2+e,a.y1=a.y1+o,a.y2=a.y2+o,a}return t}static moveVertex(t,e,o,a){if(null==a)return;let n={...t};switch(a){case 1:n.x1=e,n.y1=o;break;case 2:n.x2=e,n.y1=o;break;case 3:n.x2=e,n.y2=o;break;case 4:n.x1=e,n.y2=o}return n}static findNearestVertex(t,e,o){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.02,n=new Map([[1,{x:t.x1,y:t.y1}],[2,{x:t.x2,y:t.y1}],[3,{x:t.x2,y:t.y2}],[4,{x:t.x1,y:t.y2}]]),s=null,i=1/0;return n.forEach((t,n)=>{let l=Math.hypot(t.x-e,t.y-o);l<a&&l<i&&(i=l,s=n)}),s}static draw(t,e){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[255,0,0],s=e.width,i=e.height,l=e.getContext("2d");if(null==l)return;l.strokeStyle="rgba(".concat(n[0],", ").concat(n[1],", ").concat(n[2],", 1)");let r=t.x1*s,d=t.x2*s,c=t.y1*i,y=t.y2*i;if(l.beginPath(),l.lineWidth=1,l.fillStyle="rgba(".concat(n[0],", ").concat(n[1],", ").concat(n[2],", 0.9)"),l.rect(r-2,c-2,4,4),l.rect(r-2,y-2,4,4),l.rect(d-2,c-2,4,4),l.rect(d-2,y-2,4,4),a){let e=this.giveVertex(t,a);e&&l.rect(e.x*s-5,e.y*i-5,10,10)}l.fill(),l.rect(r,c,d-r,y-c),o?(l.fillStyle="rgba(".concat(n[0],", ").concat(n[1],", ").concat(n[2],", 0.2)"),l.fill()):l.stroke()}static containPoint(t,e,o){let a=Math.min(t.x1,t.x2),n=Math.max(t.x1,t.x2),s=Math.min(t.y1,t.y2),i=Math.max(t.y1,t.y2);return!!(a<e)&&!!(e<n)&&!!(s<o)&&!!(o<i)}static giveVertex(t,e){switch(e){case 1:return{x:t.x1,y:t.y1};case 2:return{x:t.x2,y:t.y1};case 3:return{x:t.x2,y:t.y2};case 4:return{x:t.x1,y:t.y2};default:return null}}static longestDimSize(t){return Math.max(Math.abs(t.y2-t.y1),Math.abs(t.x2-t.x1))}}let n=a},7604:(t,e,o)=>{Promise.resolve().then(o.t.bind(o,4147,23)),Promise.resolve().then(o.t.bind(o,8489,23)),Promise.resolve().then(o.t.bind(o,347,23)),Promise.resolve().then(o.bind(o,881)),Promise.resolve().then(o.bind(o,5373))},8108:(t,e,o)=>{"use strict";o.d(e,{A:()=>n});class a{static move(t,e,o){return{...t,x:e,y:o}}static isNear(t,e,o){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.02;return Math.hypot(t.x-e,t.y-o)<a}static draw(t,e){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[255,0,0],n=e.width,s=e.height,i=t.x*n,l=t.y*s,r=e.getContext("2d");r&&(r.beginPath(),r.fillStyle="rgba(".concat(a[0],", ").concat(a[1],", ").concat(a[2],", 0.9)"),r.arc(i,l,3,0,2*Math.PI),r.fill(),o&&(r.beginPath(),r.strokeStyle="rgba(".concat(a[0],", ").concat(a[1],", ").concat(a[2],", 0.8)"),r.lineWidth=2,r.arc(i,l,6,0,2*Math.PI),r.stroke()))}}let n=a},8489:t=>{t.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_63cdcc",variable:"__variable_63cdcc"}}},t=>{var e=e=>t(t.s=e);t.O(0,[896,635,441,684,358],()=>e(7604)),_N_E=t.O()}]);