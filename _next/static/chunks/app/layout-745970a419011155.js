(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{347:()=>{},1006:(t,e,n)=>{"use strict";n.d(e,{Ay:()=>r,Q6:()=>o,QH:()=>s,oc:()=>i});let a=(0,n(1990).Z0)({name:"annotationSettings",initialState:{rectClasses:{0:{name:"default",color:[255,255,255]}},rectMinEdgeSize:.02},reducers:{addRectClass:(t,e)=>{t.rectClasses[e.payload.id]=e.payload.attrs},deleteRectClass:(t,e)=>{delete t.rectClasses[e.payload]},setSettings:(t,e)=>({...t,...e.payload})}}),{addRectClass:o,deleteRectClass:s,setSettings:i}=a.actions,r=a.reducer},1783:(t,e,n)=>{"use strict";n.d(e,{Ay:()=>C,Bb:()=>m,Bj:()=>j,C5:()=>f,HD:()=>_,I_:()=>H,Kg:()=>x,M:()=>h,Mu:()=>I,O8:()=>V,OE:()=>l,U_:()=>y,_y:()=>v,aA:()=>p,cE:()=>g,cr:()=>d,eU:()=>S,fw:()=>u,nj:()=>b,rY:()=>r,v0:()=>A,xJ:()=>c,xh:()=>w});var a=n(1990),o=n(7355);let s={selectedAnnotation:-1,selectedVertex:-1,hoveringAnnotation:-1,hoveringVertex:-1,annotations:{},annotationsHistory:{0:{annotations:{},length:0}},historyIndex:0,selectedTool:"SELECT",width:640,height:640,selectedClassID:0,lastIndex:0,historyLastIndex:0,zoom:800,isDrawing:!1},i=(0,a.Z0)({name:"canvas",initialState:s,reducers:{loadAnnotations:(t,e)=>{t.lastIndex=e.payload.length;let n={};e.payload.forEach((t,e)=>{n[e]={object:t}}),t.annotations=n,t.annotationsHistory={0:{annotations:n,length:e.payload.length}}},startDrawRect:(t,e)=>{let n=e.payload.classID,a=e.payload.mousePosition,o={class_id:n,x1:a.x,y1:a.y,x2:a.x,y2:a.y};t.annotations[t.lastIndex]={object:o},t.lastIndex+=1},resetHistory:t=>{t.annotationsHistory={0:{annotations:{},length:0}},t.historyIndex=0},saveAnnotationsHistory:t=>{t.annotationsHistory[t.historyIndex+1]={annotations:t.annotations,length:t.lastIndex},t.historyLastIndex=t.historyIndex+1,t.historyIndex+=1,console.log("saving state")},goForwardHistory:t=>{t.historyIndex<t.historyLastIndex&&(t.historyIndex+=1,t.annotations=t.annotationsHistory[t.historyIndex].annotations,t.lastIndex=t.annotationsHistory[t.historyIndex].length)},goBackwardHistory:t=>{t.historyIndex>0&&(t.historyIndex-=1,t.annotations=t.annotationsHistory[t.historyIndex].annotations,t.lastIndex=t.annotationsHistory[t.historyIndex].length)},updateDrawRect:(t,e)=>{let n=t.annotations[t.lastIndex-1].object,a=e.payload;t.annotations[t.lastIndex-1].object={class_id:n.class_id,x1:n.x1,y1:n.y1,x2:a.x,y2:a.y}},updateRect:(t,e)=>{t.annotations[e.payload.Index].object=e.payload.updatedRect},updateHoveringAnnotation:(t,e)=>{t.hoveringAnnotation=-1;let n=e.payload;for(let[e,a]of Object.entries(t.annotations))if(o.A.containPoint(a.object,n.x,n.y)){t.hoveringAnnotation=Number(e);break}},updateHoveringVertex:(t,e)=>{let n=e.payload;if(t.selectedAnnotation>-1){let e=o.A.findNearestVertex(t.annotations[t.selectedAnnotation].object,n.x,n.y);null!=e?t.hoveringVertex=e:t.hoveringVertex=-1}},selectAnnotationFromHover:t=>{t.selectedAnnotation=t.hoveringAnnotation},selectVertexFromHover:t=>{t.selectedVertex=t.hoveringVertex},resetSelectedAnnotation:t=>{t.selectedAnnotation=-1},setSelectedAnnotation:(t,e)=>{t.selectedAnnotation=e.payload},resetSelectedVertex:t=>{t.selectedVertex=-1},moveVertex:(t,e)=>{let n=e.payload;if(t.selectedAnnotation>-1&&t.selectedVertex>-1){let e=o.A.moveVertex(t.annotations[t.selectedAnnotation].object,n.x,n.y,t.selectedVertex);void 0!=e&&(t.annotations[t.selectedAnnotation].object=e)}},setSelectedTool:(t,e)=>{t.selectedTool=e.payload},setCanvasSize:(t,e)=>{t.width=e.payload.width,t.height=e.payload.height},setSelectedClassID:(t,e)=>{t.selectedClassID=e.payload},removeAnnotation:(t,e)=>{delete t.annotations[e.payload]},setIsDrawing:(t,e)=>{t.isDrawing=e.payload},resetCanvasState:()=>s}}),{startDrawRect:r,updateDrawRect:l,updateHoveringAnnotation:c,updateHoveringVertex:d,goBackwardHistory:y,goForwardHistory:x,selectAnnotationFromHover:h,selectVertexFromHover:u,setSelectedTool:v,moveVertex:g,resetCanvasState:b,resetSelectedAnnotation:p,resetSelectedVertex:m,saveAnnotationsHistory:I,setCanvasSize:f,setSelectedClassID:A,loadAnnotations:_,resetHistory:S,setSelectedAnnotation:w,removeAnnotation:V,updateRect:H,setIsDrawing:j}=i.actions,C=i.reducer},4147:t=>{t.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_8c1c42",variable:"__variable_8c1c42"}},5373:(t,e,n)=>{"use strict";n.d(e,{B:()=>r,ProjectProvider:()=>i});var a=n(5155),o=n(2115);let s=(0,o.createContext)(void 0);function i(t){let{children:e}=t,[n,i]=(0,o.useState)(null),[r,l]=(0,o.useState)(null),[c,d]=(0,o.useState)(null),[y,x]=(0,o.useState)(null);return(0,a.jsx)(s.Provider,{value:{rootDirHandle:n,setRootDirHandle:i,imagesDirHandle:r,setImagesDirHandle:l,annotationsDirHandle:c,setAnnotationsDirHandle:d,db:y,setDb:x},children:e})}function r(){let t=(0,o.useContext)(s);if(!t)throw Error("useProject must be used within a ProjectProvider");return t}},7355:(t,e,n)=>{"use strict";n.d(e,{A:()=>o});class a{static moveVertex(t,e,n,a){if(null==a)return;let o={...t};switch(a){case 1:o.x1=e,o.y1=n;break;case 2:o.x2=e,o.y1=n;break;case 3:o.x2=e,o.y2=n;break;case 4:o.x1=e,o.y2=n}return o}static findNearestVertex(t,e,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.02,o=new Map([[1,{x:t.x1,y:t.y1}],[2,{x:t.x2,y:t.y1}],[3,{x:t.x2,y:t.y2}],[4,{x:t.x1,y:t.y2}]]),s=null,i=1/0;return o.forEach((t,o)=>{let r=Math.hypot(t.x-e,t.y-n);r<a&&r<i&&(i=r,s=o)}),s}static draw(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[255,0,0],s=e.width,i=e.height,r=e.getContext("2d");if(null==r)return;r.strokeStyle="rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 1)");let l=t.x1*s,c=t.x2*s,d=t.y1*i,y=t.y2*i;if(r.beginPath(),r.lineWidth=1,r.fillStyle="rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 0.9)"),r.rect(l-2,d-2,4,4),r.rect(l-2,y-2,4,4),r.rect(c-2,d-2,4,4),r.rect(c-2,y-2,4,4),a){let e=this.giveVertex(t,a);e&&r.rect(e.x*s-5,e.y*i-5,10,10)}r.fill(),r.rect(l,d,c-l,y-d),n?(r.fillStyle="rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 0.2)"),r.fill()):r.stroke()}static containPoint(t,e,n){let a=Math.min(t.x1,t.x2),o=Math.max(t.x1,t.x2),s=Math.min(t.y1,t.y2),i=Math.max(t.y1,t.y2);return!!(a<e)&&!!(e<o)&&!!(s<n)&&!!(n<i)}static giveVertex(t,e){switch(e){case 1:return{x:t.x1,y:t.y1};case 2:return{x:t.x2,y:t.y1};case 3:return{x:t.x2,y:t.y2};case 4:return{x:t.x1,y:t.y2};default:return null}}static longestDimSize(t){return Math.max(Math.abs(t.y2-t.y1),Math.abs(t.x2-t.x1))}}let o=a},7604:(t,e,n)=>{Promise.resolve().then(n.t.bind(n,4147,23)),Promise.resolve().then(n.t.bind(n,8489,23)),Promise.resolve().then(n.t.bind(n,347,23)),Promise.resolve().then(n.bind(n,9735)),Promise.resolve().then(n.bind(n,5373))},8489:t=>{t.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_63cdcc",variable:"__variable_63cdcc"}},9735:(t,e,n)=>{"use strict";n.d(e,{Providers:()=>c});var a=n(5155),o=n(4540),s=n(1990),i=n(1783),r=n(1006);let l=(0,s.U1)({reducer:{canvas:i.Ay,settings:r.Ay}});function c(t){let{children:e}=t;return(0,a.jsxs)(o.Kq,{store:l,children:[" ",e," "]})}}},t=>{var e=e=>t(t.s=e);t.O(0,[896,635,441,684,358],()=>e(7604)),_N_E=t.O()}]);