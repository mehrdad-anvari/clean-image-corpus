(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[407],{356:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ei});var o=n(5155),s=n(2115);function a(e){var t,n;let{cards:s,onSelect:a,imagesLen:i}=e,l=null!==(n=null===(t=s[2])||void 0===t?void 0:t[0])&&void 0!==n?n:0;return(0,o.jsxs)("aside",{className:"w-full flex-1 md:w-64 p-4 bg-zinc-900 border-r border-zinc-700 overflow-y-auto h-[90vh] max-h-screen shadow-inner flex flex-col gap-4 text-zinc-100",children:[(0,o.jsx)("div",{className:"flex flex-col gap-2",children:(0,o.jsxs)("div",{className:"text-center text-xs text-zinc-400",children:["Image ",(0,o.jsx)("span",{className:"font-semibold text-zinc-100",children:l+1})," of"," ",(0,o.jsx)("span",{className:"font-semibold text-zinc-100",children:i})]})}),(0,o.jsx)("div",{className:"grid grid-cols-1 gap-3 justify-items-center",children:s.map((e,t)=>{let[n,s]=e;return s?(0,o.jsx)("img",{src:s,alt:"Image ".concat(n),onClick:()=>a(t),className:"object-cover cursor-pointer rounded-md border transition-all duration-200 ".concat(2===t?"w-48 h-32 border-blue-500 shadow-lg opacity-100":"w-40 h-28 border-zinc-600 opacity-60 hover:opacity-90 hover:border-blue-400")},t):(0,o.jsx)("div",{className:"w-40 h-28 bg-zinc-700 text-zinc-400 flex items-center justify-center rounded-md",children:"Empty"},t)})})]})}var i=n(2596),l=n(9688);function c(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,l.QP)((0,i.$)(...t))}function r(e,t){let n=t.getBoundingClientRect();return{x:(e.clientX-n.left)/t.width,y:(e.clientY-n.top)/t.height}}function d(e){return{x:e.clientX,y:e.clientY}}var u=n(1783);function x(e,t,n){switch(e){case"bbox":n((0,u._y)("EDIT_RECT")),n((0,u.v0)(t));break;case"keypoint":n((0,u._y)("EDIT_POINT")),n((0,u.v0)(t));break;case"obb":n((0,u._y)("EDIT_OBB")),n((0,u.v0)(t));break;case"polygon":n((0,u._y)("EDIT_POLY")),n((0,u.v0)(t));break;case"pose":n((0,u._y)("EDIT_POSE")),n((0,u.v0)(t))}}var b=n(7355),m=n(2335),p=n(7132),h=n(1511);function f(e,t,n,o,s){if("wheel"===e.type&&(e.deltaY>0?o((0,u.nF)()):e.deltaY<0&&o((0,u.ke)())),"keydown"===e.type||"keyup"===e.type){var a,i;a=e,i=o,"keydown"===a.type&&(a.ctrlKey&&"key"in a&&"z"===a.key&&i((0,u.U_)()),a.ctrlKey&&"key"in a&&"y"===a.key&&i((0,u.Kg)()));return}if("mousemove"===e.type||"mousedown"===e.type||"mouseup"===e.type)switch(t.selectedTool){case"SELECT":!function(e,t,n,o,s){switch(e.type){case"mousedown":if(0==e.button){if(-1!=t.hoveringAnnotation){let e=t.annotations[t.hoveringAnnotation].object;x(e.type,e.class_id,o),o((0,u.M)())}else{let t=d(e);o((0,u.QA)(t))}}else if(2==e.button){let e=t.selectedClassID,s=Math.max(...Object.keys(t.annotations).map(Number));o(n[t.annotations[s].object.type][e+1]?(0,u.v0)(e+1):(0,u.v0)(0))}break;case"mouseup":t.previousMousePosition&&o((0,u.Rx)());break;case"mousemove":let a=r(e,s),i=t.previousMousePosition;if(i){let n=d(e),s={...t.offsets};s.x=s.x+(n.x-i.x),s.y=s.y+(n.y-i.y),o((0,u.nT)(s)),o((0,u.QA)(n))}o((0,u.xJ)(a)),o((0,u.cr)(a))}}(e,t,n,o,s);break;case"DRAW_RECT":!function(e,t,n,o,s){switch(e.type){case"mousedown":if(0==e.button){let n=r(e,s);o((0,u.rY)({classID:t.selectedClassID,mousePosition:n})),o((0,u.Bj)(!0))}else if(2==e.button){let e=n.bbox,s=t.selectedClassID;o(e[s+1]?(0,u.v0)(s+1):(0,u.v0)(0))}break;case"mouseup":0==e.button&&(o((0,u.Mu)()),o((0,u.Bj)(!1)));break;case"mousemove":if(t.isDrawing){let t=r(e,s);o((0,u.OE)(t))}}}(e,t,n,o,s);break;case"DRAW_POINT":!function(e,t,n,o,s){if("mousedown"===e.type){if(0==e.button){let n=r(e,s);o((0,u.DE)({classID:t.selectedClassID,mousePosition:n})),o((0,u.Mu)())}else if(2==e.button){let e=n.keypoint,s=t.selectedClassID;o(e[s+1]?(0,u.v0)(s+1):(0,u.v0)(0)),o((0,u.Mu)())}}}(e,t,n,o,s);break;case"DRAW_POLY":!function(e,t,n,o,s){var a,i;switch(e.type){case"mousedown":if(0==e.button){let n=null===(a=t.annotations[t.selectedAnnotation])||void 0===a?void 0:a.object,i=r(e,s),l=!!t.isDrawing&&"polygon"==n.type&&p.A.isNearVertex(n,i.x,i.y,0);if(t.isDrawing&&l){if("polygon"==n.type){let e=[...n.shell].slice(0,-1),s={...n,shell:e};o((0,u.rJ)({updatedAnnotation:s,Index:t.selectedAnnotation})),o((0,u.Mu)()),o((0,u.Bj)(!1))}}else if(t.isDrawing){let t=r(e,s);o((0,u.kf)(t))}else{let n=r(e,s);o((0,u.Nz)({classID:t.selectedClassID,mousePosition:n})),o((0,u.Bj)(!0))}}else if(2==e.button){let e=n.polygon,s=t.selectedClassID;o(e[s+1]?(0,u.v0)(s+1):(0,u.v0)(0))}break;case"mouseup":break;case"mousemove":let l=r(e,s),c=null===(i=t.annotations[t.selectedAnnotation])||void 0===i?void 0:i.object,d=!!t.isDrawing&&!!c&&"polygon"==c.type&&p.A.isNearVertex(c,l.x,l.y,0);t.isDrawing&&o(d&&"polygon"==c.type&&c.shell.length>3?(0,u.yx)(c.shell[0]):(0,u.yx)(l)),o((0,u.cr)(l))}}(e,t,n,o,s);break;case"DRAW_OBB":!function(e,t,n,o,s){switch(e.type){case"mousedown":if(0==e.button){let n=r(e,s);o((0,u.sY)({classID:t.selectedClassID,mousePosition:n})),o((0,u.Bj)(!0))}else if(2==e.button){let e=n.obb,s=t.selectedClassID;o(e[s+1]?(0,u.v0)(s+1):(0,u.v0)(0))}break;case"mouseup":0==e.button&&(o((0,u.Mu)()),o((0,u.Bj)(!1)));break;case"mousemove":if(t.isDrawing){let t=r(e,s);o((0,u.pd)(t))}}}(e,t,n,o,s);break;case"DRAW_POSE":!function(e,t,n,o,s){switch(e.type){case"mousedown":if(0==e.button){let a=r(e,s);if(!1==t.isDrawing)o((0,u.Hw)({classID:t.selectedClassID,mousePosition:a})),o((0,u.Bj)(!0));else{let e=t.annotations[t.selectedAnnotation].object;if("pose"!=e.type)return;let s=Object.keys(n.pose[e.class_id].keypoints),i=!0;s.forEach(t=>{!e.keypoints[Number(t)]&&i&&(console.log("new id:",t),o((0,u.G6)(Number(t))),o((0,u.mV)({id:Number(t),mousePosition:a})),i=!1)}),i&&(console.log("end"),console.log(t.annotations[t.selectedAnnotation].object),o((0,u.Bj)(!1)),o((0,u.G6)(-1)),o((0,u.Mu)()))}}else if(2==e.button){let e=n.pose,s=t.selectedClassID;e[s+1]?o((0,u.v0)(s+1)):o((0,u.v0)(0))}break;case"mouseup":break;case"mousemove":var a;let i=r(e,s),l=null===(a=t.annotations[t.selectedAnnotation])||void 0===a?void 0:a.object;t.isDrawing&&"pose"==l.type&&(0==Object.keys(l.keypoints).length?(console.log("update bbox"),o((0,u.IR)(i))):(console.log("update keypoint"),o((0,u.A7)(i))))}}(e,t,n,o,s);break;case"EDIT_RECT":!function(e,t,n,o,s){switch(e.type){case"mousedown":if(0==e.button){if(-1!=t.hoveringVertex)o((0,u.fw)());else if(o((0,u.Bb)()),-1!=t.hoveringAnnotation){if(t.selectedAnnotation==t.hoveringAnnotation&&"bbox"==t.annotations[t.selectedAnnotation].object.type){o((0,u.vJ)(!0));let t=r(e,s);o((0,u.QA)(t))}else{let e=t.annotations[t.hoveringAnnotation].object;x(e.type,e.class_id,o),o((0,u.M)())}}else o((0,u._y)("SELECT")),o((0,u.aA)()),o((0,u.Bb)())}else if(2==e.button){let e=n.bbox,s=t.selectedAnnotation,a=t.annotations[s].object,i=a.class_id;if(e[i+1]){let e={...a,class_id:i+1};o((0,u.rJ)({updatedAnnotation:e,Index:s})),o((0,u.v0)(i+1))}else{let e={...a,class_id:0};o((0,u.rJ)({updatedAnnotation:e,Index:s})),o((0,u.v0)(0))}o((0,u.Mu)())}break;case"mouseup":0==e.button&&(-1!=t.selectedVertex&&(o((0,u.Mu)()),o((0,u.Bb)())),t.isEditing&&(o((0,u.vJ)(!1)),o((0,u.Rx)()),o((0,u.Mu)())));break;case"mousemove":let a=r(e,s);if(t.isEditing&&t.previousMousePosition){let e=a.x-t.previousMousePosition.x,n=a.y-t.previousMousePosition.y,s=t.annotations[t.selectedAnnotation].object,i=b.A.move(s,e,n);o((0,u.rJ)({updatedAnnotation:i,Index:t.selectedAnnotation})),o((0,u.QA)(a))}o((0,u.xJ)(a)),o((0,u.cr)(a)),-1!=t.selectedVertex&&o((0,u.cE)(a))}}(e,t,n,o,s);break;case"EDIT_POINT":!function(e,t,n,o,s){switch(e.type){case"mousedown":if(0==e.button){if(-1!=t.hoveringAnnotation){let e=t.annotations[t.hoveringAnnotation].object;t.selectedAnnotation==t.hoveringAnnotation?o((0,u.vJ)(!0)):(x(e.type,e.class_id,o),o((0,u.M)()))}else o((0,u._y)("SELECT")),o((0,u.vJ)(!1)),o((0,u.aA)()),o((0,u.Bb)())}else if(2==e.button){let e=n.keypoint,s=t.selectedAnnotation,a=t.annotations[s].object,i=a.class_id;if(e[i+1]){let e={...a,class_id:i+1};o((0,u.rJ)({updatedAnnotation:e,Index:s})),o((0,u.v0)(i+1))}else{let e={...a,class_id:0};o((0,u.rJ)({updatedAnnotation:e,Index:s})),o((0,u.v0)(0))}o((0,u.Mu)())}break;case"mouseup":0==e.button&&-1!=t.selectedAnnotation&&(o((0,u.Mu)()),o((0,u.vJ)(!1)));break;case"mousemove":let a=r(e,s);o((0,u.xJ)(a)),t.isEditing&&o((0,u.B)(a))}}(e,t,n,o,s);break;case"EDIT_OBB":!function(e,t,n,o,s){switch(e.type){case"mousedown":if(0==e.button){if(-1!=t.hoveringVertex)o((0,u.fw)());else if(t.isHoveringHandle)o((0,u.Hv)(!0)),o((0,u.vJ)(!0));else if(o((0,u.Bb)()),-1!=t.hoveringAnnotation){if(t.selectedAnnotation==t.hoveringAnnotation&&"obb"==t.annotations[t.selectedAnnotation].object.type){o((0,u.vJ)(!0));let t=r(e,s);o((0,u.QA)(t))}else{let e=t.annotations[t.hoveringAnnotation].object;x(e.type,e.class_id,o),o((0,u.M)())}}else o((0,u._y)("SELECT")),o((0,u.aA)()),o((0,u.Bb)())}else if(2==e.button){let e=n.obb,s=t.selectedAnnotation,a=t.annotations[s].object,i=a.class_id;if(e[i+1]){let e={...a,class_id:i+1};o((0,u.rJ)({updatedAnnotation:e,Index:s})),o((0,u.v0)(i+1))}else{let e={...a,class_id:0};o((0,u.rJ)({updatedAnnotation:e,Index:s})),o((0,u.v0)(0))}o((0,u.Mu)())}break;case"mouseup":0==e.button&&(-1!=t.selectedVertex&&(o((0,u.Mu)()),o((0,u.Bb)())),t.isEditing&&(o((0,u.vJ)(!1)),o((0,u.Rx)()),o((0,u.Mu)()),o((0,u.Hv)(!1))));break;case"mousemove":let a=r(e,s);if(t.isEditing&&t.previousMousePosition){let e=a.x-t.previousMousePosition.x,n=a.y-t.previousMousePosition.y,s=t.annotations[t.selectedAnnotation].object,i=m.A.move(s,e,n);o((0,u.rJ)({updatedAnnotation:i,Index:t.selectedAnnotation})),o((0,u.QA)(a))}if(t.isEditing&&t.isHandleSelected){let e=t.annotations[t.selectedAnnotation].object,n=a.x-e.xc,s=Math.atan2(a.y-e.yc,n)-e.alpha,i=m.A.rotate(e,s);o((0,u.rJ)({updatedAnnotation:i,Index:t.selectedAnnotation}))}o((0,u.xJ)(a)),o((0,u.cr)(a)),o((0,u.CO)(a)),-1!=t.selectedVertex&&o((0,u.cE)(a))}}(e,t,n,o,s);break;case"EDIT_POLY":!function(e,t,n,o,s){switch(e.type){case"mousedown":if(0==e.button){if(-1!=t.hoveringVertex)o((0,u.fw)());else if(o((0,u.Bb)()),-1!=t.hoveringAnnotation){if(t.selectedAnnotation==t.hoveringAnnotation&&"polygon"==t.annotations[t.selectedAnnotation].object.type){o((0,u.vJ)(!0));let t=r(e,s);o((0,u.QA)(t))}else{let e=t.annotations[t.hoveringAnnotation].object;x(e.type,e.class_id,o),o((0,u.M)())}}else o((0,u._y)("SELECT")),o((0,u.aA)()),o((0,u.Bb)())}else if(2==e.button){let e=n.polygon,s=t.selectedAnnotation,a=t.annotations[s].object,i=a.class_id;if(e[i+1]){let e={...a,class_id:i+1};o((0,u.rJ)({updatedAnnotation:e,Index:s})),o((0,u.v0)(i+1))}else{let e={...a,class_id:0};o((0,u.rJ)({updatedAnnotation:e,Index:s})),o((0,u.v0)(0))}o((0,u.Mu)())}break;case"mouseup":0==e.button&&(-1!=t.selectedVertex&&(o((0,u.Mu)()),o((0,u.Bb)())),t.isEditing&&(o((0,u.vJ)(!1)),o((0,u.Rx)()),o((0,u.Mu)()),o((0,u.Hv)(!1))));break;case"mousemove":let a=r(e,s);if(t.isEditing&&t.previousMousePosition){let e=a.x-t.previousMousePosition.x,n=a.y-t.previousMousePosition.y,s=t.annotations[t.selectedAnnotation].object,i=p.A.move(s,e,n);o((0,u.rJ)({updatedAnnotation:i,Index:t.selectedAnnotation})),o((0,u.QA)(a))}o((0,u.xJ)(a)),o((0,u.cr)(a)),o((0,u.CO)(a)),-1!=t.selectedVertex&&o((0,u.cE)(a))}}(e,t,n,o,s);break;case"EDIT_POSE":!function(e,t,n,o,s){switch(e.type){case"mousedown":if(0==e.button){if(-1!=t.hoveringVertex){o((0,u.fw)());return}if(o((0,u.Bb)()),-1!=t.hoveringPoseKeypoint){o((0,u.ie)());return}if(o((0,u.Cr)()),-1!=t.hoveringAnnotation){if(t.selectedAnnotation==t.hoveringAnnotation&&"pose"==t.annotations[t.selectedAnnotation].object.type){o((0,u.vJ)(!0));let t=r(e,s);o((0,u.QA)(t))}else{let e=t.annotations[t.hoveringAnnotation].object;x(e.type,e.class_id,o),o((0,u.M)())}}else o((0,u._y)("SELECT")),o((0,u.aA)()),o((0,u.Bb)())}else if(2==e.button){let e=n.pose,s=t.selectedAnnotation,a=t.annotations[s].object,i=a.class_id;if(e[i+1]){let e={...a,class_id:i+1};o((0,u.rJ)({updatedAnnotation:e,Index:s})),o((0,u.v0)(i+1))}else{let e={...a,class_id:0};o((0,u.rJ)({updatedAnnotation:e,Index:s})),o((0,u.v0)(0))}o((0,u.Mu)())}break;case"mouseup":0==e.button&&(-1!=t.selectedVertex&&(o((0,u.Mu)()),o((0,u.Bb)())),-1!=t.selectedPoseKeypoint&&(o((0,u.Mu)()),o((0,u.Cr)())),t.isEditing&&(o((0,u.vJ)(!1)),o((0,u.Rx)()),o((0,u.Mu)()),o((0,u.Hv)(!1))));break;case"mousemove":let a=r(e,s);if(t.isEditing&&t.previousMousePosition&&t.annotations[t.selectedAnnotation]){let e=a.x-t.previousMousePosition.x,n=a.y-t.previousMousePosition.y,s=t.annotations[t.selectedAnnotation].object,i=h.A.move(s,e,n);o((0,u.rJ)({updatedAnnotation:i,Index:t.selectedAnnotation})),o((0,u.QA)(a))}if(-1!=t.selectedVertex&&t.annotations[t.selectedAnnotation]&&o((0,u.cE)(a)),-1!=t.selectedPoseKeypoint&&t.annotations[t.selectedAnnotation]){let e=t.annotations[t.selectedAnnotation].object,n=h.A.moveKeypoint(e,a.x,a.y,t.selectedPoseKeypoint);o((0,u.rJ)({updatedAnnotation:n,Index:t.selectedAnnotation}))}o((0,u.xJ)(a)),o((0,u.cr)(a)),o((0,u.gR)(a))}}(e,t,n,o,s)}}var v=n(8108),g=n(9007),y=n(4540);function j(e){let{imageSrc:t}=e,n=(0,s.useRef)(null),a=(0,g.j)(),i=(0,y.d4)(e=>e.canvas),l=(0,y.d4)(e=>e.canvas.zoom),c=(0,y.d4)(e=>e.settings);(0,s.useEffect)(()=>{if(!t||!n.current)return;let e=new Image;e.src=t;let o=()=>{let t=Math.max(e.width,e.height)/l,n=e.width/t,o=e.height/t;a((0,u.C5)({width:n,height:o}))};return e.addEventListener("load",o),()=>{e.removeEventListener("load",o)}},[l,t]),(0,s.useEffect)(()=>{t&&n.current&&!function(e,t,n,o){let s=new Image;s.src=t,e.width=n.width,e.height=n.height;let a=e.getContext("2d");a.clearRect(0,0,e.width,e.height),a.drawImage(s,0,0,e.width,e.height);let i=null;for(let[t,s]of Object.entries(n.annotations)){let a=Number(t),l=s.object,c=null;if(l){i=a===n.selectedAnnotation?n.hoveringVertex:null;let t=a===n.selectedAnnotation?n.hoveringPoseKeypoint:null;switch(c=o[l.type][s.object.class_id].color,l.type){case"bbox":"DRAW_RECT"==n.selectedTool||"SELECT"==n.selectedTool?b.A.draw(l,e,a===n.selectedAnnotation,null,c):b.A.draw(l,e,a===n.hoveringAnnotation||a===n.selectedAnnotation,i,c);break;case"keypoint":"DRAW_POINT"==n.selectedTool||"SELECT"==n.selectedTool?v.A.draw(l,e,a===n.selectedAnnotation,c):v.A.draw(l,e,a===n.hoveringAnnotation||a===n.selectedAnnotation,c);break;case"obb":"DRAW_OBB"==n.selectedTool||"SELECT"==n.selectedTool?m.A.draw(l,e,a===n.selectedAnnotation,null,!1,c):m.A.draw(l,e,a===n.hoveringAnnotation||a===n.selectedAnnotation,i,a===n.selectedAnnotation&&(n.isHandleSelected||n.isHoveringHandle),c);break;case"polygon":if("DRAW_POLY"==n.selectedTool||"SELECT"==n.selectedTool){let t=l.shell.length;i=t>3&&l.shell[0].x==l.shell[t-1].x&&l.shell[0].y==l.shell[t-1].y?0:null,p.A.draw(l,e,a===n.selectedAnnotation,i,c)}else p.A.draw(l,e,a===n.hoveringAnnotation||a===n.selectedAnnotation,i,c);break;case"pose":let r=n.annotations[n.selectedAnnotation]?o.pose[n.annotations[n.selectedAnnotation].object.class_id].skeleton:[];"DRAW_POSE"==n.selectedTool||"SELECT"==n.selectedTool?h.A.draw(l,e,a===n.selectedAnnotation,null,null,r,c):h.A.draw(l,e,a===n.hoveringAnnotation||a===n.selectedAnnotation,i,t,r,c)}}}}(n.current,t,i,c)},[t,i]);let r=e=>{e.preventDefault()};return(0,o.jsx)("div",{className:"flex justify-center items-center w-full h-full bg-zinc-950",onMouseDown:e=>{n.current&&f(e,i,c,a,n.current)},onMouseMove:e=>{n.current&&f(e,i,c,a,n.current)},onMouseUp:e=>{n.current&&f(e,i,c,a,n.current)},onKeyDown:e=>{n.current&&f(e,i,c,a,n.current)},onWheel:e=>{n.current&&f(e,i,c,a,n.current)},onContextMenu:e=>r(e),children:(0,o.jsx)("canvas",{ref:n,tabIndex:0,className:"outline-none border border-zinc-700 shadow-md bg-zinc-900 focus:ring-1 focus:ring-blue-500 ",style:{transform:"translate(".concat(i.offsets.x,"px, ").concat(i.offsets.y,"px)")}})})}function w(){var e;let t=(0,g.j)(),n=(0,y.d4)(e=>e.canvas.selectedAnnotation,y.bN),a=(0,y.d4)(e=>e.canvas.selectedVertex,y.bN),i=(0,y.d4)(e=>e.canvas.annotationsHistory,y.bN),l=(0,y.d4)(e=>e.canvas.historyIndex,y.bN),c=(0,y.d4)(e=>e.settings,y.bN),r=i[l].annotations,d=(0,s.useMemo)(()=>Object.entries(r),[r]),x=-1!==n?null===(e=r[n])||void 0===e?void 0:e.object:null,[b,m]=(0,s.useState)(null),[p,h]=(0,s.useState)(-1),[f,v]=(0,s.useState)(x?{...x}:null);(0,s.useEffect)(()=>{x&&(v({...x}),"polygon"===x.type&&(-1!=a?(m(x.shell[a]),h(a)):-1!=p&&m(x.shell[p])))},[x,a]);let j=e=>{t((0,u.xh)(e)),x&&v({...x})},w=(e,t)=>{f&&v({...f,[e]:t})};return(0,o.jsxs)("div",{className:"w-full h-full bg-zinc-900 border-l border-zinc-700 text-zinc-100 flex flex-col",children:[(0,o.jsxs)("div",{className:"flex flex-col border-b border-zinc-700 flex-grow min-h-0",children:[(0,o.jsxs)("div",{className:"bg-zinc-800 px-4 py-2 text-sm font-medium text-zinc-200",children:["Annotations (",d.length,")"]}),(0,o.jsx)("div",{className:"overflow-y-auto flex-grow divide-y divide-zinc-700",children:0===d.length?(0,o.jsx)("p",{className:"p-3 text-sm text-zinc-500",children:"No annotations yet."}):d.map(e=>{let[s]=e,a=Number(s),i=a===n;return(0,o.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 text-sm cursor-pointer ".concat(i?"bg-zinc-800 border-l-4 border-blue-500":"hover:bg-zinc-800"),onClick:()=>j(a),children:[(0,o.jsxs)("span",{className:"text-zinc-300 font-medium",children:["#",a]}),(0,o.jsx)("button",{onClick:e=>{e.stopPropagation(),t((0,u.O8)(a)),t((0,u.Mu)()),a===n&&(t((0,u.xh)(-1)),v(null))},className:"text-red-400 hover:underline text-xs",children:"Remove"})]},s)})})]}),(0,o.jsxs)("div",{className:"border-t border-zinc-700 ",children:[(0,o.jsx)("div",{className:"bg-zinc-800 px-4 py-2 text-sm font-medium text-zinc-200",children:x?"Selected Annotation #".concat(n):"No annotation selected"}),x&&f&&(0,o.jsxs)("div",{className:"p-4 flex flex-col gap-2 text-xs bg-zinc-900",children:[Object.entries(f).map(e=>{let[t,n]=e;return"polygon"===f.type&&"shell"===t?null:(0,o.jsxs)("label",{className:"flex justify-between items-center gap-2",children:[(0,o.jsx)("span",{className:"text-zinc-400",children:t}),"type"==t?(0,o.jsx)("span",{className:"bg-zinc-800 text-zinc-100 px-2 py-1 text-left w-24 ",children:f.type}):(0,o.jsx)("input",{type:"number",value:n,onChange:e=>w(t,parseFloat(e.target.value)),className:"bg-zinc-800 text-zinc-100 px-2 py-1 text-left w-24 border border-zinc-600 focus:outline-none focus:ring focus:ring-blue-500"})]},t)}),"polygon"===f.type&&-1!==n&&b&&(0,o.jsxs)("div",{className:"flex flex-col gap-1 text-xs mt-2",children:[(0,o.jsx)("span",{className:"text-zinc-400",children:"Selected Vertex"}),(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-zinc-500",children:"x:"}),(0,o.jsx)("span",{className:"text-zinc-100",children:b.x.toFixed(2)})]}),(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-zinc-500",children:"y:"}),(0,o.jsx)("span",{className:"text-zinc-100",children:b.y.toFixed(2)})]})]}),(0,o.jsx)("button",{onClick:()=>{null!==n&&f&&"polygon"!=f.type&&c[f.type][f.class_id]&&(t((0,u.rJ)({updatedAnnotation:f,Index:n})),t((0,u.v0)(f.class_id)),t((0,u.Mu)()))},className:"mt-2 w-full py-1 bg-blue-600 text-white hover:bg-blue-700 transition",children:"Save Changes"})]})]})]})}var N=n(4616),A=n(2525);let z=e=>{let{color:t=[255,255,255]}=e;return(0,o.jsx)("div",{className:"w-8 h-4 rounded shadow-sm",style:{backgroundColor:"rgb(".concat(t[0],", ").concat(t[1],", ").concat(t[2],")")}})},k=e=>{let{text:t="test",color:n=[255,255,255]}=e;return(0,o.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,o.jsx)(z,{color:n}),(0,o.jsx)("span",{children:t})]})},D=e=>{let{color:t=[255,255,255],size:n=6}=e;return(0,o.jsx)("div",{className:"rounded-full shadow-sm",style:{backgroundColor:"rgb(".concat(t[0],", ").concat(t[1],", ").concat(t[2],")"),width:n,height:n}})},E=e=>{let{text:t="test",color:n=[255,255,255],size:s=6}=e;return(0,o.jsxs)("div",{className:"flex items-center gap-1.5 px-2.5",children:[(0,o.jsx)(D,{color:n,size:s}),(0,o.jsx)("span",{children:t})]})},C=()=>[Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random())];function _(e){let{setting:t,onAdd:n,onDelete:a}=e,[i,l]=(0,s.useState)(void 0),[c,r]=(0,s.useState)(""),[d,u]=(0,s.useState)([255,255,255]),x=(e,t)=>{l(e),r(t.name),u(t.color)};return(0,o.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,o.jsxs)("div",{className:"flex flex-col w-55 gap-3 p-2",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2 justify-between",children:[(0,o.jsx)("input",{className:"w-15 px-2 py-1 bg-zinc-800 border border-zinc-600 rounded",type:"number",min:0,value:null!=i?i:"",placeholder:"ID",onChange:e=>{l(""===e.target.value?void 0:Number(e.target.value)),u(C())}}),(0,o.jsx)("input",{className:"w-full px-2 py-1 bg-zinc-800 border border-zinc-600 rounded",type:"text",value:c,onChange:e=>r(e.target.value),placeholder:"Name"})]}),(0,o.jsx)("div",{className:"flex items-center justify-between",children:(0,o.jsx)("div",{className:"w-30",children:(0,o.jsx)("input",{type:"color",value:"#".concat(d.map(e=>e.toString(16).padStart(2,"0")).join("")),onChange:e=>{u(e.target.value.slice(1).match(/.{1,2}/g).map(e=>parseInt(e,16)))},className:"w-12 h-8 rounded border",onClick:()=>u(C())})})}),(0,o.jsxs)("button",{onClick:()=>{null!=i&&n(i,c,d)},className:"h-8 px-3 inline-flex items-center justify-center border rounded-md text-sm border-gray-500 bg-zinc-800 hover:border-zinc-100 w-35 mt-auto",children:[(0,o.jsx)(N.A,{className:"mr-2 h-4 w-4"})," Add Class"]})]}),(0,o.jsx)("div",{className:"flex-grow",children:(0,o.jsx)("div",{className:"space-y-2 px-3 border-gray-600 h-65 overflow-y-auto border-l",children:Object.entries(t).map(e=>{let[t,n]=e;return(0,o.jsxs)("div",{className:"flex justify-between w-107 items-center bg-gray-1000 px-2 rounded border ".concat(Number(t)===i?"border-green-400":"border-zinc-700"),onClick:()=>x(Number(t),n),children:[(0,o.jsx)(k,{text:t+": "+n.name,color:n.color}),(0,o.jsx)("button",{className:" text-zinc-400 hover:text-zinc-100 p-3",onClick:()=>a(Number(t)),children:(0,o.jsx)(A.A,{className:"w-4 h-4"})})]},t)})})})]})}function I(e){var t,n,a,i,l;let{settings:c,onAddPose:r,onDeletePose:d,onAddKeypoint:u,onDeleteKeypoint:x,onAddEdge:b,onDeleteEdge:m}=e,[p,h]=(0,s.useState)(null),[f,v]=(0,s.useState)({id:void 0,name:"",color:[255,255,255]}),[g,y]=(0,s.useState)({name:"",color:[255,255,255],id:void 0}),[j,w]=(0,s.useState)({from:void 0,to:void 0,name:""});(0,s.useEffect)(()=>{if(void 0!=f.id&&c.pose[f.id]){let e=c.pose[f.id];v({id:f.id,name:e.name,color:e.color})}else v({id:f.id,name:"",color:C()})},[f.id,c]),(0,s.useEffect)(()=>{if(null!=p&&void 0!=g.id&&c.pose[p].keypoints[g.id]){let e=c.pose[p].keypoints[g.id];y({id:g.id,name:e.name,color:e.color})}else y({id:g.id,name:"",color:C()})},[p,c,g.id]),(0,s.useEffect)(()=>{if(null!=p){let e=void 0!=j.from&&c.pose[p].keypoints[j.from]?c.pose[p].keypoints[j.from].name:"",t=void 0!=j.to&&c.pose[p].keypoints[j.to]?c.pose[p].keypoints[j.to].name:"";w({from:j.from,to:j.to,name:e+"-"+t})}else w({from:j.from,to:j.to,name:""})},[p,c,j.from,j.to]);let[N,z]=(0,s.useState)(null),D=(e,t)=>{v({id:Number(e),name:t.name,color:t.color}),h(Number(e))},_=(e,t)=>{y({name:t.name,color:t.color,id:e})},I=(e,t)=>{null!=p&&w({from:e,to:t,name:(void 0!=j.from&&c.pose[p].keypoints[j.from]?c.pose[p].keypoints[j.from].name:"")+"-"+(void 0!=j.to&&c.pose[p].keypoints[j.to]?c.pose[p].keypoints[j.to].name:"")})},T=()=>{null!=p&&void 0!=j.from&&void 0!=j.to&&b(p,j.from,j.to)};return(0,o.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 p-4 bg-zinc-900 text-white rounded shadow",children:[(0,o.jsxs)("div",{className:"flex flex-col max-w-45 min-w-45 gap-4  md:w-1/3",children:[(0,o.jsxs)("div",{className:"space-y-2 border-b pb-2",children:[(0,o.jsx)("h2",{className:"text-sm text-gray-400",children:"Add Pose"}),(0,o.jsxs)("div",{className:"flex justify-between gap-1",children:[(0,o.jsx)("input",{type:"number",className:"w-15 px-2 py-1 bg-zinc-800 border border-zinc-600 rounded",placeholder:"ID",value:null!==(t=f.id)&&void 0!==t?t:"",min:0,onChange:e=>v({...f,id:Number(e.target.value)})}),(0,o.jsx)("input",{className:"w-full px-2 py-1 bg-zinc-800 border border-zinc-600 rounded",placeholder:"Name",value:null!==(n=f.name)&&void 0!==n?n:"",onChange:e=>v({...f,name:e.target.value})})]}),(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("input",{type:"color",value:"#".concat(f.color.map(e=>e.toString(16).padStart(2,"0")).join("")),onChange:e=>v({...f,color:e.target.value.slice(1).match(/.{1,2}/g).map(e=>parseInt(e,16))}),className:"w-12 h-8 rounded border"}),(0,o.jsx)("button",{onClick:()=>{if(void 0!=f.id&&f.name&&f.color){let e={},t=[];c.pose[f.id]&&(e=c.pose[f.id].keypoints,t=c.pose[f.id].skeleton),r(f.id,{name:f.name,color:f.color,keypoints:e,skeleton:t})}},className:"h-8 px-3 inline-flex items-center justify-center border rounded-md text-sm border-gray-500 bg-zinc-800 hover:border-zinc-100 w-20 mt-auto",children:"Add"})]})]}),(0,o.jsxs)("div",{className:"space-y-2 border-b pb-2",children:[(0,o.jsx)("h2",{className:"text-sm text-gray-400",children:"Add Keypoint"}),(0,o.jsxs)("div",{className:"flex justify-between gap-1",children:[(0,o.jsx)("input",{type:"number",className:"w-15 px-2 py-1 bg-zinc-800 border border-zinc-600 rounded",placeholder:"ID",value:null!==(a=g.id)&&void 0!==a?a:"",min:0,onChange:e=>y({...g,id:Number(e.target.value)})}),(0,o.jsx)("input",{className:"w-full px-2 py-1 bg-zinc-800 border border-zinc-600 rounded",placeholder:"Name",value:g.name,onChange:e=>y({...g,name:e.target.value})})]}),(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("input",{type:"color",value:"#".concat(g.color.map(e=>e.toString(16).padStart(2,"0")).join("")),onChange:e=>y({...g,color:e.target.value.slice(1).match(/.{1,2}/g).map(e=>parseInt(e,16))}),className:"w-12 h-8 rounded border"}),(0,o.jsx)("button",{onClick:()=>{null!=p&&null!=g.id&&g.color&&g.name&&u(p,g.id,g.name,g.color)},disabled:null===p,className:"h-8 px-3 inline-flex items-center justify-center border rounded-md text-sm border-gray-500 bg-zinc-800 hover:border-zinc-100 w-20 mt-auto",children:"Add"})]})]}),(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsx)("h2",{className:"text-sm text-gray-400",children:"Add Skeleton Edge"}),(0,o.jsxs)("div",{className:"flex gap-2",children:[(0,o.jsx)("input",{type:"number",disabled:null===p,className:"w-1/2 px-2 py-1 bg-zinc-800 border rounded ".concat(null!=p&&void 0!=j.from&&c.pose[p].keypoints[j.from]?"border-zinc-600":"border-red-600"),placeholder:"From",min:0,value:null!==(i=j.from)&&void 0!==i?i:"",onChange:e=>w({...j,from:Number(e.target.value)})}),(0,o.jsx)("input",{type:"number",disabled:null===p,className:"w-1/2 px-2 py-1 bg-zinc-800 border rounded ".concat(null!=p&&void 0!=j.to&&c.pose[p].keypoints[j.to]?"border-zinc-600":"border-red-600"),placeholder:"To",min:0,value:null!==(l=j.to)&&void 0!==l?l:"",onChange:e=>w({...j,to:Number(e.target.value)})})]}),(0,o.jsxs)("div",{className:"flex gap-2 justify-between",children:[(0,o.jsx)("span",{children:j.name}),(0,o.jsx)("button",{onClick:()=>T(),disabled:null===p,className:"h-8 px-3 inline-flex items-center justify-center border rounded-md text-sm border-gray-500 bg-zinc-800 hover:border-zinc-100 w-20 mt-auto",children:"Add"})]})]})]}),(0,o.jsxs)("div",{className:"flex flex-col flex-grow gap-2 max-h-[40vh] overflow-y-auto px-2 border-l border-zinc-700",children:[Object.entries(c.pose).map(e=>{let[t,n]=e;return(0,o.jsxs)("div",{className:"rounded border p-2 cursor-pointer ".concat(Number(t)===p?"border-green-400":"border-zinc-700"),onClick:()=>D(t,{id:t,name:n.name,color:n.color}),children:[(0,o.jsxs)("div",{className:"flex justify-between items-center",children:[(0,o.jsx)(k,{text:"".concat(t,": ").concat(n.name),color:n.color}),(0,o.jsx)("div",{className:"flex gap-1",children:(0,o.jsx)("button",{className:"text-zinc-400 hover:text-zinc-100 p-3",onClick:e=>{e.stopPropagation(),d(Number(t))},children:(0,o.jsx)(A.A,{className:"w-4 h-4"})})})]}),(0,o.jsx)("div",{children:(0,o.jsx)("div",{className:"flex flex-wrap gap-1 mt-2 ml-2",children:Object.entries(n.keypoints).map(e=>{let[n,s]=e;return(0,o.jsx)("div",{className:"hover:bg-zinc-700 rounded px-1 flex items-center ",onClick:()=>_(Number(n),s),onContextMenu:e=>{e.preventDefault(),z({x:e.pageX,y:e.pageY,poseId:Number(t),index:Number(n),objType:"keypoint"})},children:(0,o.jsx)(E,{color:s.color,text:"".concat(n,": ").concat(s.name),size:8})},n)})})}),(0,o.jsx)("div",{className:"flex flex-wrap gap-1 mt-2 ml-2",children:n.skeleton.map((e,n)=>{let[s,a]=e;return(0,o.jsx)("div",{className:"hover:bg-zinc-700 rounded px-1 flex items-center ",onClick:()=>I(s,a),onContextMenu:e=>{e.preventDefault(),z({x:e.pageX,y:e.pageY,poseId:Number(t),index:Number(n),objType:"edge"})},children:(0,o.jsxs)("span",{children:[s,"-",a]})},n)})})]},t)}),N&&(0,o.jsx)(e=>{let{x:t,y:n,onClose:a,handleDeleteKeypoint:i,handleDeleteEdge:l}=e,c=(0,s.useRef)(null);return(0,o.jsx)("div",{ref:c,className:"absolute bg-black border rounded shadow-md text-sm",style:{top:n,left:t},onMouseLeave:()=>a(),children:(0,o.jsx)("div",{className:"p-2 hover:bg-gray-200 cursor-pointer",onClick:(null==N?void 0:N.objType)==="keypoint"?i:l,children:"Delete"})})},{x:N.x,y:N.y,onClose:()=>z(null),handleDeleteKeypoint:()=>x(N.poseId,N.index),handleDeleteEdge:()=>m(N.poseId,N.index)})]})]})}var T=n(2649);let S=T.bL,M=e=>{let{className:t,...n}=e;return(0,o.jsx)(T.B8,{className:c("inline-flex items-center border-b border-gray-200",t),...n})},P=e=>{let{className:t,...n}=e;return(0,o.jsx)(T.l9,{className:c("px-3 py-1.5 text-sm font-medium text-gray-400 data-[state=active]:text-blue-600 data-[state=active]:border-b-2 data-[state=active]:border-blue-600",t),...n})},O=e=>{let{className:t,...n}=e;return(0,o.jsx)(T.UC,{className:c("mt-2",t),...n})};var R=n(1006);function B(e){let{isOpen:t,onClose:n}=e,s=(0,g.j)(),a=(0,g.G)(e=>e.settings);return t?(0,o.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50",children:(0,o.jsxs)("div",{className:"bg-zinc-900 rounded-lg p-6 max-w-3xl w-full max-h-[90vh] overflow-auto",onClick:e=>e.stopPropagation(),children:[(0,o.jsxs)(S,{defaultValue:"bbox",className:"w-full",children:[(0,o.jsxs)(M,{className:"w-full grid grid-cols-6",children:[(0,o.jsx)(P,{value:"bbox",children:"BBOX"}),(0,o.jsx)(P,{value:"obb",children:"OBB"}),(0,o.jsx)(P,{value:"keypoint",children:"Keypoint"}),(0,o.jsx)(P,{value:"pose",children:"Pose"}),(0,o.jsx)(P,{value:"polygon",children:"Polygon"}),(0,o.jsx)(P,{value:"line",children:"Line"})]}),(0,o.jsx)(O,{value:"bbox",children:(0,o.jsx)(_,{setting:a.bbox,onAdd:(e,t,n)=>s((0,R.Q6)({id:e,attrs:{name:t,color:n}})),onDelete:e=>s((0,R.QH)(e))})}),(0,o.jsx)(O,{value:"obb",children:(0,o.jsx)(_,{setting:a.obb,onAdd:(e,t,n)=>s((0,R.Zv)({id:e,attrs:{name:t,color:n}})),onDelete:e=>s((0,R.LT)(e))})}),(0,o.jsx)(O,{value:"keypoint",children:(0,o.jsx)(_,{setting:a.keypoint,onAdd:(e,t,n)=>s((0,R.y5)({id:e,attrs:{name:t,color:n}})),onDelete:e=>s((0,R.Ih)(e))})}),(0,o.jsx)(O,{value:"pose",children:(0,o.jsx)(I,{settings:a,onAddPose:(e,t)=>s((0,R.To)({id:e,pose:t})),onDeletePose:e=>s((0,R.$L)(e)),onAddKeypoint:(e,t,n,o)=>s((0,R.h$)({poseId:e,keypointId:t,keypoint:{name:n,color:o}})),onDeleteKeypoint:(e,t)=>s((0,R.So)({poseId:e,keypointId:t})),onAddEdge:(e,t,n)=>{s((0,R.tk)({poseId:e,from:t,to:n}))},onDeleteEdge:(e,t)=>{s((0,R.Wv)({poseId:e,edgeIndex:t}))}})}),(0,o.jsx)(O,{value:"polygon",children:(0,o.jsx)(_,{setting:a.polygon,onAdd:(e,t,n)=>s((0,R._h)({id:e,attrs:{name:t,color:n}})),onDelete:e=>s((0,R.GI)(e))})}),(0,o.jsx)(O,{value:"line",children:(0,o.jsx)(_,{setting:a.line,onAdd:(e,t,n)=>s((0,R.K9)({id:e,attrs:{name:t,color:n}})),onDelete:e=>s((0,R.k5)(e))})})]}),(0,o.jsx)("button",{onClick:n,className:"mt-4 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded",children:"Save"})]})}):null}function J(e){let{onSync:t,onSettings:n,onExport:s,onDelete:a}=e;return(0,o.jsxs)("div",{className:"flex flex-wrap ",children:[(0,o.jsx)("button",{onClick:n,className:"bg-zinc-800 text-zinc-100 px-4 py-2 border border-zinc-600 hover:bg-zinc-700 hover:border-blue-500 transition",children:"⚙️ Settings"}),(0,o.jsx)("button",{onClick:t,className:"bg-zinc-800 text-zinc-100 px-4 py-2 border border-zinc-600 hover:bg-zinc-700 hover:border-blue-500 transition",children:"\uD83D\uDD04 Sync"}),(0,o.jsx)("button",{onClick:s,className:"bg-zinc-800 text-zinc-100 px-4 py-2 border border-zinc-600 hover:bg-zinc-700 hover:border-blue-500 transition",children:"\uD83D\uDCBE Export"}),(0,o.jsx)("button",{onClick:a,className:"bg-zinc-800 text-zinc-100 px-4 py-2 border border-zinc-600 hover:bg-zinc-700 hover:border-blue-500 transition",children:"\uD83D\uDDD1️ Delete"})]})}var L=n(4383),W=n(5373),H=n(2738),V=n(4065);async function K(e){let t=await e.getDirectoryHandle("yolo",{create:!0}),n=await e.getDirectoryHandle("annotations");if(n&&t)for await(let[e]of n.entries()){let o=await n.getFileHandle(e),s=await o.getFile(),a=JSON.parse(await s.text()).annotations,i={bbox:[],obb:[],polygon:[],keypoint:[],line:[]};for(let n of(a.forEach(e=>{let t=e.class_id;if("bbox"==e.type){let t=(e.x1+e.x2)*.5,n=(e.y1+e.y2)*.5,o=Math.abs(e.x2-e.x1),s=Math.abs(e.y2-e.y1);i.bbox.push("".concat(e.class_id," ").concat(t," ").concat(n," ").concat(o," ").concat(s))}if("obb"===e.type){let n=m.A.getVertices(e).map(e=>[e.x,e.y]).flat();console.log("obb",n),i.obb.push("".concat(t," ").concat(n.join(" ")))}if("polygon"===e.type){let n=e.shell.map(e=>[e.x,e.y]).flat();console.log("polygon",n),i.polygon.push("".concat(t," ").concat(n.join(" ")))}}),Object.keys(i))){if(0===i[n].length)continue;let o=await t.getDirectoryHandle(n,{create:!0}),s=await o.getFileHandle(function(e){let t=e.lastIndexOf(".");return -1===t?"".concat(e,".txt"):"".concat(e.substring(0,t),".txt")}(e),{create:!0}),a=await s.createWritable();await a.write(i[n].join("\n")+"\n"),await a.close()}}}var Y=n(8979),F=n(2998),Q=n(1436),G=n(2640),U=n(4012),X=n(2965),Z=n(3717),$=n(9917);let q=[{id:"DRAW_RECT",icon:(0,o.jsx)(Y.A,{size:16})},{id:"DRAW_POINT",icon:(0,o.jsx)(F.A,{size:16})},{id:"DRAW_OBB",icon:(0,o.jsx)(Q.A,{size:16})},{id:"DRAW_POLY",icon:(0,o.jsx)(G.A,{size:16})},{id:"DRAW_POSE",icon:(0,o.jsx)(U.A,{size:16})}];function ee(){var e;let t=(0,g.j)(),n=(0,y.d4)(e=>e.canvas.selectedTool),[a,i]=(0,s.useState)("DRAW_RECT"),[l,c]=(0,s.useState)(!1),r=e=>{t((0,u._y)(e)),t((0,u.aA)()),t((0,u.Bb)()),t((0,u.Bj)(!1)),t((0,u.vJ)(!1)),t((0,u._)())},d=e=>{i(e),r(e),c(!1)},x="EDIT_RECT"===n||"EDIT_POINT"===n||"EDIT_OBB"===n||"EDIT_POLY"===n||"EDIT_POSE"===n;return(0,o.jsxs)("div",{className:"absolute top-4 left-4 z-20 flex gap-2",children:[(0,o.jsx)("button",{title:"Select",onClick:()=>r("SELECT"),className:"w-10 h-10 flex items-center justify-center shadow border border-zinc-600 transition\n          ".concat("SELECT"===n?"bg-blue-600/80 text-white":"bg-zinc-800/80 text-zinc-300 hover:bg-zinc-700/80"),children:(0,o.jsx)(X.A,{size:18})},"SELECT"),(0,o.jsx)("button",{title:"Edit",onClick:()=>r("EDIT_RECT"),className:"w-10 h-10 flex items-center justify-center shadow border border-zinc-600 transition\n          ".concat(x?"bg-blue-600/80 text-white":"bg-zinc-800/80 text-zinc-300 hover:bg-zinc-700/80"),children:(0,o.jsx)(Z.A,{size:18})},"EDIT_RECT"),(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("button",{onClick:()=>{r(a),c(e=>!e)},title:"Draw Tool",className:"w-10 h-10 flex items-center justify-center shadow border border-zinc-600 transition\n            ".concat(n.startsWith("DRAW")?"bg-blue-600/80 text-white":"bg-zinc-800/80 text-zinc-300 hover:bg-zinc-700/80"),children:(null===(e=q.find(e=>e.id===a))||void 0===e?void 0:e.icon)||(0,o.jsx)($.A,{size:18})}),l&&(0,o.jsx)("div",{onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),className:"absolute top-12 left-0 w-10 bg-zinc-800 border border-zinc-600 shadow z-30",children:q.map(e=>{let{id:t,icon:n}=e;return(0,o.jsx)("button",{onClick:()=>d(t),className:"w-full h-9 flex items-center gap-2 px-3 py-2 text-sm text-zinc-300 hover:bg-zinc-700",children:n},t)})})]})]})}let et=e=>{let{name:t="default",color:n=[255,255,255]}=e;return(0,o.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,o.jsx)("div",{className:"w-10 h-4 shadow-sm rounded",style:{backgroundColor:"rgb(".concat(n[0],", ").concat(n[1],", ").concat(n[2],")")}}),(0,o.jsx)("span",{children:t})]})},en={DRAW_RECT:"bbox",DRAW_POINT:"keypoint",DRAW_OBB:"obb",DRAW_POLY:"polygon",DRAW_POSE:"pose",EDIT_RECT:"bbox",EDIT_POINT:"keypoint",EDIT_OBB:"obb",EDIT_POLY:"polygon",EDIT_POSE:"pose",SELECT:""};function eo(){var e,t;let n=(0,g.j)(),a=(0,y.d4)(e=>e.canvas.selectedClassID),i=(0,y.d4)(e=>e.canvas.selectedTool),l=(0,y.d4)(e=>e.settings),[c,r]=(0,s.useState)(!1),[d,x]=(0,s.useState)("bbox");(0,s.useEffect)(()=>{if("SELECT"!=i){let e=en[i];d!=e&&x(e),("DRAW_RECT"==i||"DRAW_POINT"==i||"DRAW_OBB"==i||"DRAW_POLY"==i||"DRAW_POSE"==i)&&n((0,u.v0)(0))}},[i]);let b=l[d],m=null===(e=b[a])||void 0===e?void 0:e.name,p=null===(t=b[a])||void 0===t?void 0:t.color;return(0,o.jsxs)("div",{className:"absolute top-18 left-4 z-20 flex gap-2",onClick:()=>r(!c),children:[(0,o.jsx)(et,{name:m,color:p}),(0,o.jsx)("div",{className:"absolute top-8 z-20 flex-col",children:c&&Object.values(b).map((e,t)=>(0,o.jsx)("button",{className:"gap-2 flex-col flex ".concat(t==a?"opacity-100":"opacity-50"),onClick:()=>n((0,u.v0)(t)),children:(0,o.jsx)(et,{name:e.name,color:e.color})},t))})]})}var es=n(7550),ea=n(2138);function ei(){var e;let t=(0,g.j)(),n=(0,y.d4)(e=>e.settings),{db:i,imagesDirHandle:l,rootDirHandle:c,annotationsDirHandle:r}=(0,W.B)(),d=[null,null,null],[x,b]=(0,s.useState)([d,d,d,d,d]),[m,p]=(0,s.useState)(0),[h,f]=(0,s.useState)(!1),[v,N]=(0,s.useState)(0),A=()=>{f(!1),c&&(0,V.D)(c,n)};function z(e){let t=e.lastIndexOf(".");return -1===t?"".concat(e,".json"):"".concat(e.substring(0,t),".json")}async function k(){if(!r||!x[2][1])return;let e=x[2][2];if(!e)return;let t=z(e.name),n=[],o=H.M.getState(),s=o.canvas.annotations,a=o.canvas.lastIndex;for(let e=0;e<a;e++){if(void 0==s[e])continue;let t=s[e].object;n.push(t)}try{let e=await r.getFileHandle(t,{create:!0}),o=await e.createWritable();await o.write(JSON.stringify({name:t,annotations:n,labels:[]},null,2)),await o.close()}catch(e){console.error("Error saving annotations:",e)}}async function D(e){let n=e[2];if(null==n||null==r)return;let o=z(n.name);try{let e=await r.getFileHandle(o),n=await e.getFile(),s=await n.text(),a=JSON.parse(s);t((0,u.HD)(a.annotations))}catch(e){console.warn('Annotation file "'.concat(o,'" could not load. error: "').concat(e,'"')),t((0,u.HD)([])),t((0,u.eU)())}}async function E(e){if(!i)return;let t=await (0,L.AK)(i);p(t),await T(e,t,i,l,0)}async function C(){l&&c&&i&&(await (0,L.kP)(l,i),await (0,L.wZ)(i,c),p(await (0,L.AK)(i)),E(v))}async function _(){try{c&&await K(c)}catch(e){console.log("Error in exporting annotation to yolo format, error: ",e)}}async function I(){console.log(x[2]),i&&l&&c&&x[2][2]&&(await (0,L.Wb)(i,l,x[2][2].name),await (0,L.wZ)(i,c),p(await (0,L.AK)(i)),E(v))}async function T(e,n,o,s,a){if(!o||!s)return;let i=a+e;if(i<0||i>=n)return;let l=Math.floor(2.5),c=Math.max(0,i-l),r=Math.min(n,i+l+1)-c,x=Math.max(0,l-i),m=await (0,L.kg)(s,o,c,r);if(!m)return;let p=[...Array(x).fill(d),...m,...Array(5-r-x).fill(d)];b(p),t((0,u.nj)()),await D(p[2]),N(i)}async function S(){await k(),await T(-1,m,i,l,v)}async function M(){await k(),await T(1,m,i,l,v)}async function P(e){let t=Math.floor(2.5);await k(),await T(e-t,m,i,l,v)}return(0,s.useEffect)(()=>{try{E(0)}catch(e){console.log("error in loading images. error:",e)}},[]),(0,o.jsxs)("div",{className:"flex flex-col h-screen bg-zinc-950 text-zinc-100 h-full",children:[(0,o.jsx)("header",{className:"bg-zinc-900 border-b border-zinc-700 shadow-md",children:(0,o.jsx)(J,{onSync:C,onSettings:()=>{f(!h)},onExport:_,onDelete:I})}),(0,o.jsxs)("div",{className:"flex flex-row flex-grow overflow-hidden h-full",children:[(0,o.jsxs)("aside",{className:"flex flex-col bg-zinc-900 border-r border-zinc-700 h-full md:w-64",children:[(0,o.jsx)(a,{cards:x,onSelect:P,imagesLen:m}),(0,o.jsxs)("div",{className:"flex flex-col border-t border-zinc-700",children:[(0,o.jsx)("div",{className:"bg-zinc-800 px-4 py-2 text-sm font-medium text-zinc-200",children:"Image Properties"}),x[2][2]&&(0,o.jsxs)("div",{className:"flex flex-col px-4 py-2 text-xs font-medium text-zinc-300 gap-2",children:[(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-zinc-400 ",children:"Name:"}),(0,o.jsx)("span",{className:"truncate max-w-[10rem] text-right",title:x[2][2].name,children:x[2][2].name})]}),(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-zinc-400",children:"Format:"}),(0,o.jsx)("span",{children:x[2][2].format})]}),(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-zinc-400",children:"Size:"}),(0,o.jsxs)("span",{children:[x[2][2].width," \xd7 ",x[2][2].height]})]}),(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-zinc-400",children:"aHash:"}),(0,o.jsx)("span",{children:parseInt(x[2][2].perceptualHash,2).toString(16).toUpperCase()})]}),(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-zinc-400",children:"Created:"}),(0,o.jsx)("span",{children:new Date(x[2][2].createdAt).toLocaleString()})]}),(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-zinc-400",children:"Modified:"}),(0,o.jsx)("span",{children:new Date(x[2][2].modifiedAt).toLocaleString()})]})]})]})]}),(0,o.jsxs)("main",{className:"flex flex-col flex-1 relative items-start h-full w-full bg-zinc-950 overflow-hidden",children:[(0,o.jsx)(ee,{}),(0,o.jsx)(eo,{}),(0,o.jsx)("div",{className:"flex-1 flex w-full items-center justify-center overflow-hidden",children:(0,o.jsx)(j,{imageSrc:x[2][1]})}),(0,o.jsxs)("div",{className:"flex w-full items-center justify-between px-4 h-7 bg-zinc-800 text-white border-t border-zinc-700 z-10",children:[(0,o.jsx)("button",{onClick:S,className:"".concat(0===v?"text-zinc-500 cursor-not-allowed":"hover:text-blue-400 text-zinc-200 "),children:(0,o.jsx)(es.A,{size:16})}),(0,o.jsx)("span",{className:"text-sm h-5",children:null===(e=x[2][2])||void 0===e?void 0:e.name})," ",(0,o.jsx)("button",{onClick:M,className:"".concat(v===m-1?"text-zinc-500 cursor-not-allowed":"hover:text-blue-400 text-zinc-200 "),children:(0,o.jsx)(ea.A,{size:16})})]})]}),(0,o.jsx)("aside",{className:"h-full w-full md:w-64 bg-zinc-900 border-l border-zinc-700",children:(0,o.jsx)(w,{})}),(0,o.jsx)(B,{isOpen:h,onClose:()=>A()})]})]})}},2933:(e,t,n)=>{Promise.resolve().then(n.bind(n,356))},4065:(e,t,n)=>{"use strict";async function o(e,t){let n=await e.getFileHandle("settings.json",{create:!0}),o=await n.createWritable();await o.write(JSON.stringify(t,null,2)),await o.close(),console.log("Saved ".concat(t," to settings.json file."))}async function s(e){try{let t=await e.getFileHandle("settings.json",{create:!1}),n=await t.getFile(),o=await n.text();return JSON.parse(o)}catch(e){return console.log("Error in loading the settings.json",e),null}}n.d(t,{D:()=>o,M:()=>s})},9007:(e,t,n)=>{"use strict";n.d(t,{G:()=>a,j:()=>s});var o=n(4540);let s=o.wA.withTypes(),a=o.d4.withTypes()}},e=>{var t=t=>e(e.s=t);e.O(0,[635,235,299,738,441,684,358],()=>t(2933)),_N_E=e.O()}]);