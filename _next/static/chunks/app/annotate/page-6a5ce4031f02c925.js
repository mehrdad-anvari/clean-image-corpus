(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[407],{1006:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>r,Q6:()=>o,QH:()=>s,oc:()=>i});let a=(0,n(1990).Z0)({name:"annotationSettings",initialState:{rectClasses:{0:{name:"default",color:[255,255,255]}},pointClasses:{0:{name:"default",color:[255,255,255]}},rectMinEdgeSize:.02},reducers:{addRectClass:(e,t)=>{e.rectClasses[t.payload.id]=t.payload.attrs},addPointClass:(e,t)=>{e.pointClasses[t.payload.id]=t.payload.attrs},deleteRectClass:(e,t)=>{delete e.rectClasses[t.payload]},deletePointClass:(e,t)=>{delete e.pointClasses[t.payload]},setSettings:(e,t)=>({...e,...t.payload})}}),{addRectClass:o,deleteRectClass:s,setSettings:i}=a.actions,r=a.reducer},1783:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>M,B:()=>T,Bb:()=>v,Bj:()=>E,C5:()=>j,DE:()=>S,HD:()=>N,I_:()=>I,Kg:()=>h,M:()=>b,Mu:()=>w,O8:()=>A,OE:()=>c,U_:()=>x,_y:()=>m,aA:()=>p,cE:()=>g,cr:()=>u,eU:()=>k,fw:()=>y,nj:()=>f,rY:()=>l,v0:()=>z,vJ:()=>D,xJ:()=>d,xh:()=>C});var a=n(1990),o=n(7355),s=n(8108);let i={selectedAnnotation:-1,selectedVertex:-1,hoveringAnnotation:-1,hoveringVertex:-1,annotations:{},annotationsHistory:{0:{annotations:{},length:0}},historyIndex:0,selectedTool:"SELECT",width:640,height:640,selectedClassID:0,lastIndex:0,historyLastIndex:0,zoom:800,isDrawing:!1,isEditing:!1},r=(0,a.Z0)({name:"canvas",initialState:i,reducers:{loadAnnotations:(e,t)=>{e.lastIndex=t.payload.length;let n={};t.payload.forEach((e,t)=>{n[t]={object:e}}),e.annotations=n,e.annotationsHistory={0:{annotations:n,length:t.payload.length}}},startDrawRect:(e,t)=>{let n=t.payload.classID,a=t.payload.mousePosition,o={type:"bbox",class_id:n,x1:a.x,y1:a.y,x2:a.x,y2:a.y};e.annotations[e.lastIndex]={object:o},e.lastIndex+=1},drawPoint:(e,t)=>{let n=t.payload.classID,a=t.payload.mousePosition,o={type:"keypoint",class_id:n,x:a.x,y:a.y};e.annotations[e.lastIndex]={object:o},e.lastIndex+=1},resetHistory:e=>{e.annotationsHistory={0:{annotations:{},length:0}},e.historyIndex=0},saveAnnotationsHistory:e=>{e.annotationsHistory[e.historyIndex+1]={annotations:e.annotations,length:e.lastIndex},e.historyLastIndex=e.historyIndex+1,e.historyIndex+=1,console.log("saving state")},goForwardHistory:e=>{e.historyIndex<e.historyLastIndex&&(e.historyIndex+=1,e.annotations=e.annotationsHistory[e.historyIndex].annotations,e.lastIndex=e.annotationsHistory[e.historyIndex].length)},goBackwardHistory:e=>{e.historyIndex>0&&(e.historyIndex-=1,e.annotations=e.annotationsHistory[e.historyIndex].annotations,e.lastIndex=e.annotationsHistory[e.historyIndex].length)},updateDrawRect:(e,t)=>{let n=e.annotations[e.lastIndex-1].object;if("bbox"!=n.type)return;let a=t.payload;e.annotations[e.lastIndex-1].object={type:"bbox",class_id:n.class_id,x1:n.x1,y1:n.y1,x2:a.x,y2:a.y}},updateRect:(e,t)=>{e.annotations[t.payload.Index].object=t.payload.updatedRect},updateHoveringAnnotation:(e,t)=>{e.hoveringAnnotation=-1;let n=t.payload;for(let[t,a]of Object.entries(e.annotations)){switch(a.object.type){case"polygon":case"obb":case"line":break;case"bbox":o.A.containPoint(a.object,n.x,n.y)&&(e.hoveringAnnotation=Number(t));break;case"keypoint":s.A.isNear(a.object,n.x,n.y)&&(e.hoveringAnnotation=Number(t))}if(-1!=e.hoveringAnnotation)break}},updateHoveringVertex:(e,t)=>{let n=t.payload;if(e.selectedAnnotation>-1){let t=e.annotations[e.selectedAnnotation].object;switch(t.type){case"polygon":case"obb":case"line":break;case"bbox":let a=o.A.findNearestVertex(t,n.x,n.y);null!=a?e.hoveringVertex=a:e.hoveringVertex=-1}}},selectAnnotationFromHover:e=>{e.selectedAnnotation=e.hoveringAnnotation},selectVertexFromHover:e=>{e.selectedVertex=e.hoveringVertex},resetSelectedAnnotation:e=>{e.selectedAnnotation=-1},setSelectedAnnotation:(e,t)=>{e.selectedAnnotation=t.payload},resetSelectedVertex:e=>{e.selectedVertex=-1},moveVertex:(e,t)=>{let n=t.payload;if(e.selectedAnnotation>-1&&e.selectedVertex>-1){let t=e.annotations[e.selectedAnnotation].object;switch(t.type){case"polygon":case"obb":case"line":break;case"bbox":let a=o.A.moveVertex(t,n.x,n.y,e.selectedVertex);void 0!=a&&(e.annotations[e.selectedAnnotation].object=a)}}},moveSelectedPoint:(e,t)=>{let n=t.payload,a=e.annotations[e.selectedAnnotation].object;if("keypoint"==a.type){let t=s.A.move(a,n.x,n.y);e.annotations[e.selectedAnnotation].object=t}},setSelectedTool:(e,t)=>{e.selectedTool=t.payload},setCanvasSize:(e,t)=>{e.width=t.payload.width,e.height=t.payload.height},setSelectedClassID:(e,t)=>{e.selectedClassID=t.payload},removeAnnotation:(e,t)=>{delete e.annotations[t.payload]},setIsDrawing:(e,t)=>{e.isDrawing=t.payload},setIsEditing:(e,t)=>{e.isEditing=t.payload},resetCanvasState:()=>i}}),{startDrawRect:l,updateDrawRect:c,updateHoveringAnnotation:d,updateHoveringVertex:u,goBackwardHistory:x,goForwardHistory:h,selectAnnotationFromHover:b,selectVertexFromHover:y,setSelectedTool:m,moveVertex:g,resetCanvasState:f,resetSelectedAnnotation:p,resetSelectedVertex:v,saveAnnotationsHistory:w,setCanvasSize:j,setSelectedClassID:z,loadAnnotations:N,resetHistory:k,setSelectedAnnotation:C,removeAnnotation:A,updateRect:I,setIsDrawing:E,setIsEditing:D,drawPoint:S,moveSelectedPoint:T}=r.actions,M=r.reducer},2738:(e,t,n)=>{"use strict";n.d(t,{M:()=>i});var a=n(1990),o=n(1783),s=n(1006);let i=(0,a.U1)({reducer:{canvas:o.Ay,settings:s.Ay}})},4065:(e,t,n)=>{"use strict";async function a(e,t){let n=await e.getFileHandle("settings.json",{create:!0}),a=await n.createWritable();await a.write(JSON.stringify(t,null,2)),await a.close(),console.log("Saved ".concat(t," to settings.json file."))}async function o(e){try{let t=await e.getFileHandle("settings.json",{create:!1}),n=await t.getFile(),a=await n.text();return JSON.parse(a)}catch(e){return console.log("Error in loading the settings.json",e),null}}n.d(t,{D:()=>a,M:()=>o})},6410:(e,t,n)=>{Promise.resolve().then(n.bind(n,6773))},6773:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>V});var a=n(5155),o=n(2115);function s(e){var t,n;let{cards:o,onSelect:s,handlePrevious:i,handleNext:r,imagesLen:l}=e,c=null!==(n=null===(t=o[2])||void 0===t?void 0:t[0])&&void 0!==n?n:0;return(0,a.jsxs)("aside",{className:"w-full md:w-64 p-4 bg-zinc-900 border-r border-zinc-700 overflow-y-auto h-[90vh] max-h-screen shadow-inner flex flex-col gap-4 text-zinc-100",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("button",{onClick:i,disabled:0===c,className:"px-3 py-1 text-sm font-medium rounded border transition duration-150 ".concat(0===c?"bg-zinc-700 text-zinc-500 border-zinc-600 cursor-not-allowed":"bg-zinc-800 hover:bg-zinc-700 text-blue-400 border-blue-500"),children:"← Previous"}),(0,a.jsx)("button",{onClick:r,disabled:c===l-1,className:"px-3 py-1 text-sm font-medium rounded border transition duration-150 ".concat(c===l-1?"bg-zinc-700 text-zinc-500 border-zinc-600 cursor-not-allowed":"bg-zinc-800 hover:bg-zinc-700 text-blue-400 border-blue-500"),children:"Next →"})]}),(0,a.jsxs)("div",{className:"text-center text-xs text-zinc-400",children:["Image ",(0,a.jsx)("span",{className:"font-semibold text-zinc-100",children:c+1})," of"," ",(0,a.jsx)("span",{className:"font-semibold text-zinc-100",children:l})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-3 justify-items-center",children:o.map((e,t)=>{let[n,o]=e;return o?(0,a.jsx)("img",{src:o,alt:"Image ".concat(n),onClick:()=>s(t),className:"object-cover cursor-pointer rounded-md border transition-all duration-200 ".concat(2===t?"w-48 h-32 border-blue-500 shadow-lg opacity-100":"w-40 h-28 border-zinc-600 opacity-60 hover:opacity-90 hover:border-blue-400")},t):(0,a.jsx)("div",{className:"w-40 h-28 bg-zinc-700 text-zinc-400 flex items-center justify-center rounded-md",children:"Empty"},t)})})]})}function i(e){let t=e.currentTarget.getBoundingClientRect(),n=e.currentTarget.width,a=e.currentTarget.height;return{x:(e.clientX-t.left)/n,y:(e.clientY-t.top)/a}}var r=n(1783);function l(e,t,n){if("keydown"===e.type||"keyup"===e.type){var a,o,s;a=e,o=0,s=n,"keydown"===a.type&&(a.ctrlKey&&"key"in a&&"z"===a.key&&s((0,r.U_)()),a.ctrlKey&&"key"in a&&"y"===a.key&&s((0,r.Kg)()));return}if("mousemove"===e.type||"mousedown"===e.type||"mouseup"===e.type)switch(t.selectedTool){case"SELECT":!function(e,t,n){switch(e.type){case"mousedown":if(-1!=t.hoveringAnnotation){switch(t.annotations[t.hoveringAnnotation].object.type){case"bbox":n((0,r._y)("EDIT_RECT")),n((0,r.vJ)(!0));break;case"keypoint":n((0,r._y)("EDIT_POINT")),n((0,r.vJ)(!0))}n((0,r.M)())}break;case"mouseup":break;case"mousemove":let a=i(e);n((0,r.xJ)(a)),n((0,r.cr)(a))}}(e,t,n);break;case"EDIT_RECT":!function(e,t,n){switch(e.type){case"mousedown":if(-1!=t.hoveringVertex)n((0,r.fw)());else if(n((0,r.Bb)()),-1!=t.hoveringAnnotation){switch(t.annotations[t.hoveringAnnotation].object.type){case"bbox":n((0,r._y)("EDIT_RECT"));break;case"keypoint":n((0,r._y)("EDIT_POINT"))}n((0,r.M)())}else n((0,r._y)("SELECT")),n((0,r.aA)()),n((0,r.Bb)());break;case"mouseup":-1!=t.selectedVertex&&(n((0,r.Mu)()),n((0,r.Bb)()));break;case"mousemove":let a=i(e);n((0,r.xJ)(a)),n((0,r.cr)(a)),-1!=t.selectedVertex&&n((0,r.cE)(a))}}(e,t,n);break;case"DRAW_RECT":!function(e,t,n){switch(e.type){case"mousedown":let a=i(e);n((0,r.rY)({classID:t.selectedClassID,mousePosition:a})),n((0,r.Bj)(!0));break;case"mouseup":n((0,r.Mu)()),n((0,r.Bj)(!1));break;case"mousemove":if(t.isDrawing){let t=i(e);n((0,r.OE)(t))}}}(e,t,n);break;case"DRAW_POINT":!function(e,t,n){if("mousedown"===e.type){let a=i(e);n((0,r.DE)({classID:t.selectedClassID,mousePosition:a})),n((0,r.Mu)())}}(e,t,n);break;case"EDIT_POINT":!function(e,t,n){switch(e.type){case"mousedown":if(-1!=t.hoveringAnnotation){switch(t.annotations[t.hoveringAnnotation].object.type){case"bbox":n((0,r._y)("EDIT_RECT")),n((0,r.vJ)(!0));break;case"keypoint":n((0,r._y)("EDIT_POINT")),n((0,r.vJ)(!0))}n((0,r.M)())}else n((0,r._y)("SELECT")),n((0,r.vJ)(!1)),n((0,r.aA)()),n((0,r.Bb)());break;case"mouseup":-1!=t.selectedAnnotation&&(n((0,r.Mu)()),n((0,r.vJ)(!1)));break;case"mousemove":let a=i(e);n((0,r.xJ)(a)),t.isEditing&&n((0,r.B)(a))}}(e,t,n)}}var c=n(8108),d=n(7355),u=n(9007),x=n(4540);function h(e){let{imageSrc:t}=e,n=(0,o.useRef)(null),s=(0,u.j)(),i=(0,x.d4)(e=>e.canvas),h=(0,x.d4)(e=>e.settings);return(0,o.useEffect)(()=>{if(!t||!n.current)return;let e=new Image;e.src=t;let a=()=>{let t=Math.max(e.width,e.height)/i.zoom,n=e.width/t,a=e.height/t;s((0,r.C5)({width:n,height:a}))};return e.addEventListener("load",a),()=>{e.removeEventListener("load",a)}},[i,t]),(0,o.useEffect)(()=>{t&&n.current&&!function(e,t,n,a){let o=new Image;o.src=t,e.width=n.width,e.height=n.height;let s=e.getContext("2d");s.clearRect(0,0,e.width,e.height),s.drawImage(o,0,0,e.width,e.height);let i=null;for(let[t,o]of Object.entries(n.annotations)){let s=Number(t),r=o.object,l=a.rectClasses[o.object.class_id].color;if(r)switch(i=s===n.selectedAnnotation?n.hoveringVertex:null,r.type){case"bbox":"DRAW_RECT"==n.selectedTool||"SELECT"==n.selectedTool?d.A.draw(r,e,s===n.selectedAnnotation,null,l):d.A.draw(r,e,s===n.hoveringAnnotation||s===n.selectedAnnotation,i,l);break;case"keypoint":"DRAW_POINT"==n.selectedTool||"SELECT"==n.selectedTool?c.A.draw(r,e,s===n.selectedAnnotation,l):c.A.draw(r,e,s===n.hoveringAnnotation||s===n.selectedAnnotation,l)}}}(n.current,t,i,h)},[t,i]),(0,a.jsx)("div",{className:"relative w-full h-full flex items-center justify-center bg-zinc-950",children:(0,a.jsx)("canvas",{ref:n,onMouseDown:e=>{l(e,i,s)},onMouseMove:e=>{l(e,i,s)},onMouseUp:e=>{l(e,i,s)},onKeyDown:e=>{l(e,i,s)},tabIndex:0,className:"outline-none border border-zinc-700  shadow-md bg-zinc-900 focus:ring-1 focus:ring-blue-500 transition duration-150"})})}function b(){var e;let t=(0,u.j)(),n=(0,x.d4)(e=>e.canvas.selectedAnnotation,x.bN),s=(0,x.d4)(e=>e.canvas.annotationsHistory,x.bN),i=(0,x.d4)(e=>e.canvas.historyIndex,x.bN),l=(0,x.d4)(e=>e.settings,x.bN),c=s[i].annotations,d=(0,o.useMemo)(()=>Object.entries(c),[c]),h=-1!==n?null===(e=c[n])||void 0===e?void 0:e.object:null,[b,y]=(0,o.useState)(h?{...h}:null);(0,o.useEffect)(()=>{h&&y({...h})},[h]);let m=e=>{t((0,r.xh)(e)),h&&y({...h})},g=(e,t)=>{b&&y({...b,[e]:t})};return(0,a.jsxs)("div",{className:"w-full h-full bg-zinc-900 border-l border-zinc-700 text-zinc-100 flex flex-col",children:[(0,a.jsxs)("div",{className:"flex flex-col border-b border-zinc-700 flex-grow min-h-0",children:[(0,a.jsxs)("div",{className:"bg-zinc-800 px-4 py-2 text-sm font-medium text-zinc-200",children:["Annotations (",d.length,")"]}),(0,a.jsx)("div",{className:"overflow-y-auto flex-grow divide-y divide-zinc-700",children:0===d.length?(0,a.jsx)("p",{className:"p-3 text-sm text-zinc-500",children:"No annotations yet."}):d.map(e=>{let[o]=e,s=Number(o),i=s===n;return(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 text-sm cursor-pointer ".concat(i?"bg-zinc-800 border-l-4 border-blue-500":"hover:bg-zinc-800"),onClick:()=>m(s),children:[(0,a.jsxs)("span",{className:"text-zinc-300 font-medium",children:["#",s]}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),t((0,r.O8)(s)),t((0,r.Mu)()),s===n&&(t((0,r.xh)(-1)),y(null))},className:"text-red-400 hover:underline text-xs",children:"Remove"})]},o)})})]}),(0,a.jsxs)("div",{className:"border-t border-zinc-700 ",children:[(0,a.jsx)("div",{className:"bg-zinc-800 px-4 py-2 text-sm font-medium text-zinc-200",children:h?"Selected Annotation #".concat(n):"No annotation selected"}),h&&b&&(0,a.jsxs)("div",{className:"p-4 flex flex-col gap-2 text-xs bg-zinc-900",children:[Object.keys(b).map(e=>(0,a.jsxs)("label",{className:"flex justify-between items-center gap-2",children:[(0,a.jsx)("span",{className:"text-zinc-400",children:e}),"type"==e?(0,a.jsx)("span",{className:"bg-zinc-800 text-zinc-100 px-2 py-1 text-left w-24 ",children:b.type}):(0,a.jsx)("input",{type:"number",value:b[e],onChange:t=>g(e,parseFloat(t.target.value)),className:"bg-zinc-800 text-zinc-100 px-2 py-1 text-left w-24 border border-zinc-600 focus:outline-none focus:ring focus:ring-blue-500"})]},e)),(0,a.jsx)("button",{onClick:()=>{null!==n&&b&&"bbox"===b.type&&l.rectClasses[b.class_id]&&(t((0,r.I_)({updatedRect:b,Index:n})),t((0,r.v0)(b.class_id)),t((0,r.Mu)()))},className:"mt-2 w-full py-1 bg-blue-600 text-white hover:bg-blue-700 transition",children:"Save Changes"})]})]})]})}function y(e){let{onLoadImages:t,onSync:n,onSettings:o,onExport:s}=e;return(0,a.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,a.jsx)("button",{onClick:o,className:"bg-zinc-800 text-zinc-100 px-4 py-2 rounded-md border border-zinc-600 hover:bg-zinc-700 hover:border-blue-500 transition",children:"⚙️ Settings"}),(0,a.jsx)("button",{onClick:t,className:"bg-zinc-800 text-zinc-100 px-4 py-2 rounded-md border border-zinc-600 hover:bg-zinc-700 hover:border-blue-500 transition",children:"\uD83D\uDCC1 Load Images"}),(0,a.jsx)("button",{onClick:n,className:"bg-zinc-800 text-zinc-100 px-4 py-2 rounded-md border border-zinc-600 hover:bg-zinc-700 hover:border-blue-500 transition",children:"\uD83D\uDD04 Sync Images"}),(0,a.jsx)("button",{onClick:s,className:"bg-zinc-800 text-zinc-100 px-4 py-2 rounded-md border border-zinc-600 hover:bg-zinc-700 hover:border-blue-500 transition",children:"\uD83D\uDCBE Export YOLO"})]})}var m=n(4383),g=n(5373),f=n(2738),p=n(1006),v=n(4065);async function w(e){let t=await e.getDirectoryHandle("yolo",{create:!0}),n=await e.getDirectoryHandle("annotations");if(n&&t)for await(let[e]of n.entries()){let a=await n.getFileHandle(e),o=await a.getFile(),s=JSON.parse(await o.text()).annotations,i=await t.getFileHandle(function(e){let t=e.lastIndexOf(".");return -1===t?"".concat(e,".txt"):"".concat(e.substring(0,t),".txt")}(e),{create:!0}),r=await i.createWritable(),l=[];s.forEach(e=>{if("bbox"==e.type){let t=(e.x1+e.x2)*.5,n=(e.y1+e.y2)*.5,a=Math.abs(e.x2-e.x1),o=Math.abs(e.y2-e.y1);l.push("".concat(e.class_id," ").concat(t," ").concat(n," ").concat(a," ").concat(o))}}),await r.write(l.join("\n")+"\n"),await r.close()}}let j=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),z=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),N=e=>{let t=z(e);return t.charAt(0).toUpperCase()+t.slice(1)},k=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>!!e&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()},C=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var A={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let I=(0,o.forwardRef)((e,t)=>{let{color:n="currentColor",size:a=24,strokeWidth:s=2,absoluteStrokeWidth:i,className:r="",children:l,iconNode:c,...d}=e;return(0,o.createElement)("svg",{ref:t,...A,width:a,height:a,stroke:n,strokeWidth:i?24*Number(s)/Number(a):s,className:k("lucide",r),...!l&&!C(d)&&{"aria-hidden":"true"},...d},[...c.map(e=>{let[t,n]=e;return(0,o.createElement)(t,n)}),...Array.isArray(l)?l:[l]])}),E=(e,t)=>{let n=(0,o.forwardRef)((n,a)=>{let{className:s,...i}=n;return(0,o.createElement)(I,{ref:a,iconNode:t,className:k("lucide-".concat(j(N(e))),"lucide-".concat(e),s),...i})});return n.displayName=N(e),n},D=E("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),S=E("circle-dot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]),T=E("move",[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]]),M=E("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),_=E("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),R=[{id:"DRAW_RECT",icon:(0,a.jsx)(D,{size:16})},{id:"DRAW_POINT",icon:(0,a.jsx)(S,{size:16})}];function O(){var e;let t=(0,u.j)(),n=(0,x.d4)(e=>e.canvas.selectedTool),[s,i]=(0,o.useState)("DRAW_RECT"),[l,c]=(0,o.useState)(!1),d=e=>{t((0,r._y)(e)),t((0,r.aA)()),t((0,r.Bb)())},h=e=>{i(e),d(e),c(!1)},b="EDIT_RECT"===n||"EDIT_POINT"===n;return(0,a.jsxs)("div",{className:"absolute top-4 left-4 z-20 flex gap-2",children:[(0,a.jsx)("button",{title:"Select",onClick:()=>d("SELECT"),className:"w-10 h-10 flex items-center justify-center shadow border border-zinc-600 transition\n          ".concat("SELECT"===n?"bg-blue-600/80 text-white":"bg-zinc-800/80 text-zinc-300 hover:bg-zinc-700/80"),children:(0,a.jsx)(T,{size:18})},"SELECT"),(0,a.jsx)("button",{title:"Edit",onClick:()=>d("EDIT_RECT"),className:"w-10 h-10 flex items-center justify-center shadow border border-zinc-600 transition\n          ".concat(b?"bg-blue-600/80 text-white":"bg-zinc-800/80 text-zinc-300 hover:bg-zinc-700/80"),children:(0,a.jsx)(M,{size:18})},"EDIT_RECT"),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{onClick:()=>{d(s),c(e=>!e)},title:"Draw Tool",className:"w-10 h-10 flex items-center justify-center shadow border border-zinc-600 transition\n            ".concat(n.startsWith("DRAW")?"bg-blue-600/80 text-white":"bg-zinc-800/80 text-zinc-300 hover:bg-zinc-700/80"),children:(null===(e=R.find(e=>e.id===s))||void 0===e?void 0:e.icon)||(0,a.jsx)(_,{size:18})}),l&&(0,a.jsx)("div",{onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),className:"absolute top-12 left-0 w-10 bg-zinc-800 border border-zinc-600 shadow z-30",children:R.map(e=>{let{id:t,icon:n}=e;return(0,a.jsx)("button",{onClick:()=>h(t),className:"w-full h-9 flex items-center gap-2 px-3 py-2 text-sm text-zinc-300 hover:bg-zinc-700",children:n},t)})})]})]})}let H=()=>[Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random())],P=e=>{let{color:t=[255,255,255]}=e;return(0,a.jsx)("div",{className:"w-5 h-5 rounded shadow-sm",style:{backgroundColor:"rgb(".concat(t[0],", ").concat(t[1],", ").concat(t[2],")")}})},L=e=>{let{isOpen:t,onClose:n,settings:s}=e,i=(0,u.j)(),[r,l]=(0,o.useState)(""),[c,d]=(0,o.useState)(H()),[x,h]=(0,o.useState)(Object.keys(s.rectClasses).length),[b,y]=(0,o.useState)("");if(!t)return null;let m=e=>{i((0,p.QH)(e))};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex justify-center items-center z-50",children:(0,a.jsx)("div",{className:"bg-zinc-900 p-6 rounded-xl shadow-2xl w-full max-w-xl border border-zinc-700",children:(0,a.jsxs)("div",{className:"p-2 sm:p-4 text-zinc-100",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Rectangle Classes"}),b&&(0,a.jsx)("p",{className:"text-red-400 mb-2",children:b}),(0,a.jsxs)("div",{className:"mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[(0,a.jsx)("input",{type:"text",value:r,onChange:e=>l(e.target.value),placeholder:"Class Name",className:"bg-zinc-800 text-white border border-zinc-600 p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,a.jsx)("input",{type:"color",value:"#".concat(c.map(e=>e.toString(16).padStart(2,"0")).join("")),onChange:e=>{d(e.target.value.slice(1).match(/.{1,2}/g).map(e=>parseInt(e,16)))},onClick:()=>{d(H())},className:"cursor-pointer border border-zinc-600 rounded-md w-10 h-10"})]}),(0,a.jsx)("button",{onClick:()=>{if(""===r.trim()){y("Class name cannot be empty.");return}let e=Object.values(s.rectClasses).some(e=>e.name===r),t=Object.values(s.rectClasses).some(e=>e.color[0]===c[0]&&e.color[1]===c[1]&&e.color[2]===c[2]);if(e){y("Class name already exists.");return}if(t){y("Class color already exists.");return}i((0,p.Q6)({id:x,attrs:{name:r,color:c}})),l(""),d(H()),h(x+1),y("")},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition",children:"Add Class"})]}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-72 border-t border-zinc-700 pt-4",children:(0,a.jsx)("ul",{className:"space-y-3",children:Object.entries(s.rectClasses).map(e=>{let[t,{name:n,color:o}]=e;return(0,a.jsxs)("li",{className:"flex items-center justify-between gap-3 text-sm bg-zinc-800 p-2 rounded-md shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(P,{color:o}),(0,a.jsxs)("span",{className:"text-zinc-400",children:["#",t]}),(0,a.jsx)("span",{className:"text-zinc-100",children:n})]}),(0,a.jsx)("button",{onClick:()=>m(Number(t)),className:"bg-red-600 hover:bg-red-700 text-white py-1 px-3 rounded-md transition",children:"Remove"})]},t)})})}),(0,a.jsx)("button",{className:"mt-6 w-full bg-zinc-700 hover:bg-zinc-600 text-white py-2 rounded-md transition",onClick:n,children:"Close"})]})})})};function V(){let e=(0,u.j)(),t=(0,x.d4)(e=>e.settings),{db:n,imagesDirHandle:i,rootDirHandle:l,annotationsDirHandle:c}=(0,g.B)(),d=[null,null,null],[p,j]=(0,o.useState)([d,d,d,d,d]),[z,N]=(0,o.useState)(0),[k,C]=(0,o.useState)(!1),[A,I]=(0,o.useState)(0),E=()=>{C(!k),l&&(0,v.D)(l,t)};function D(e){let t=e.lastIndexOf(".");return -1===t?"".concat(e,".json"):"".concat(e.substring(0,t),".json")}async function S(){if(!c||!p[2][1])return;let e=p[2][2];if(!e)return;let t=D(e.name),n=[],a=f.M.getState(),o=a.canvas.annotations,s=a.canvas.lastIndex;for(let e=0;e<s;e++){if(void 0==o[e])continue;let t=o[e].object;n.push(t)}try{let e=await c.getFileHandle(t,{create:!0}),a=await e.createWritable();await a.write(JSON.stringify({name:t,annotations:n,labels:[]},null,2)),await a.close()}catch(e){console.error("Error saving annotations:",e)}}async function T(t){let n=t[2];if(null==n||null==c)return;let a=D(n.name);try{let t=await c.getFileHandle(a),n=await t.getFile(),o=await n.text(),s=JSON.parse(o);e((0,r.HD)(s.annotations))}catch(t){console.warn('Annotation file "'.concat(a,'" could not load. error: "').concat(t,'"')),e((0,r.HD)([])),e((0,r.eU)())}}async function M(){if(!n)return;let e=await (0,m.AK)(n);N(e),await H(0,e,n,i,0)}async function _(){i&&l&&n&&(await (0,m.kP)(i,n),await (0,m.wZ)(n,l),N(await (0,m.AK)(n)))}async function R(){try{l&&await w(l)}catch(e){console.log("Error in exporting annotation to yolo format, error: ",e)}}async function H(t,n,a,o,s){if(!a||!o)return;let i=s+t;if(i<0||i>=n)return;let l=Math.floor(2.5),c=Math.max(0,i-l),u=Math.min(n,i+l+1)-c,x=Math.max(0,l-i),h=await (0,m.kg)(o,a,c,u);if(!h)return;let b=[...Array(x).fill(d),...h,...Array(5-u-x).fill(d)];j(b),e((0,r.nj)()),await T(b[2]),I(i)}async function P(){await S(),await H(-1,z,n,i,A)}async function V(){await S(),await H(1,z,n,i,A)}async function W(e){let t=Math.floor(2.5);await S(),await H(e-t,z,n,i,A)}return(0,o.useEffect)(()=>{try{console.log("run"),M()}catch(e){console.log("error in loading images. error:",e)}},[]),(0,a.jsxs)("div",{className:"flex flex-col h-screen bg-zinc-950 text-zinc-100 h-full",children:[(0,a.jsx)("header",{className:"bg-zinc-900 border-b border-zinc-700 px-4 py-3 shadow-md",children:(0,a.jsx)(y,{onLoadImages:M,onSync:_,onSettings:E,onExport:R})}),(0,a.jsxs)("div",{className:"flex flex-row flex-grow overflow-hidden h-full",children:[(0,a.jsx)("aside",{className:"bg-zinc-900 border-r border-zinc-700 w-full h-full md:w-64 overflow-y-auto",children:(0,a.jsx)(s,{cards:p,onSelect:W,handlePrevious:P,handleNext:V,imagesLen:z})}),(0,a.jsxs)("main",{className:"flex-1 relative flex justify-center items-start h-full bg-zinc-950 p-4 overflow-hidden",children:[(0,a.jsx)(O,{}),(0,a.jsx)("div",{className:"max-w-full max-h-full mt-12",children:(0,a.jsx)(h,{imageSrc:p[2][1]})})]}),(0,a.jsx)("aside",{className:"h-full w-full md:w-64 bg-zinc-900 border-l border-zinc-700",children:(0,a.jsx)(b,{})}),(0,a.jsx)(L,{isOpen:k,onClose:E,settings:t})]})]})}},7355:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});class a{static moveVertex(e,t,n,a){if(null==a)return;let o={...e};switch(a){case 1:o.x1=t,o.y1=n;break;case 2:o.x2=t,o.y1=n;break;case 3:o.x2=t,o.y2=n;break;case 4:o.x1=t,o.y2=n}return o}static findNearestVertex(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.02,o=new Map([[1,{x:e.x1,y:e.y1}],[2,{x:e.x2,y:e.y1}],[3,{x:e.x2,y:e.y2}],[4,{x:e.x1,y:e.y2}]]),s=null,i=1/0;return o.forEach((e,o)=>{let r=Math.hypot(e.x-t,e.y-n);r<a&&r<i&&(i=r,s=o)}),s}static draw(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[255,0,0],s=t.width,i=t.height,r=t.getContext("2d");if(null==r)return;r.strokeStyle="rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 1)");let l=e.x1*s,c=e.x2*s,d=e.y1*i,u=e.y2*i;if(r.beginPath(),r.lineWidth=1,r.fillStyle="rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 0.9)"),r.rect(l-2,d-2,4,4),r.rect(l-2,u-2,4,4),r.rect(c-2,d-2,4,4),r.rect(c-2,u-2,4,4),a){let t=this.giveVertex(e,a);t&&r.rect(t.x*s-5,t.y*i-5,10,10)}r.fill(),r.rect(l,d,c-l,u-d),n?(r.fillStyle="rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 0.2)"),r.fill()):r.stroke()}static containPoint(e,t,n){let a=Math.min(e.x1,e.x2),o=Math.max(e.x1,e.x2),s=Math.min(e.y1,e.y2),i=Math.max(e.y1,e.y2);return!!(a<t)&&!!(t<o)&&!!(s<n)&&!!(n<i)}static giveVertex(e,t){switch(t){case 1:return{x:e.x1,y:e.y1};case 2:return{x:e.x2,y:e.y1};case 3:return{x:e.x2,y:e.y2};case 4:return{x:e.x1,y:e.y2};default:return null}}static longestDimSize(e){return Math.max(Math.abs(e.y2-e.y1),Math.abs(e.x2-e.x1))}}let o=a},8108:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});class a{static move(e,t,n){return{...e,x:t,y:n}}static isNear(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.02;return Math.hypot(e.x-t,e.y-n)<a}static draw(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[255,0,0],o=t.width,s=t.height,i=e.x*o,r=e.y*s,l=t.getContext("2d");l&&(l.beginPath(),l.fillStyle="rgba(".concat(a[0],", ").concat(a[1],", ").concat(a[2],", 0.9)"),l.arc(i,r,3,0,2*Math.PI),l.fill(),n&&(l.beginPath(),l.strokeStyle="rgba(".concat(a[0],", ").concat(a[1],", ").concat(a[2],", 0.8)"),l.lineWidth=2,l.arc(i,r,6,0,2*Math.PI),l.stroke()))}}let o=a},9007:(e,t,n)=>{"use strict";n.d(t,{j:()=>o});var a=n(4540);let o=a.wA.withTypes();a.d4.withTypes()}},e=>{var t=t=>e(e.s=t);e.O(0,[635,299,441,684,358],()=>t(6410)),_N_E=e.O()}]);