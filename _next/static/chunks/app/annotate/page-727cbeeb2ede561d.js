(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[407],{1006:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>y,GI:()=>l,Ih:()=>c,K9:()=>d,LT:()=>b,Q6:()=>o,QH:()=>s,Zv:()=>x,_h:()=>i,k5:()=>u,oc:()=>h,y5:()=>r});let a=(0,n(1990).Z0)({name:"annotationSettings",initialState:{rectClasses:{0:{name:"default",color:[255,255,255]}},pointClasses:{0:{name:"default",color:[255,255,255]}},polygonClasses:{0:{name:"default",color:[255,255,255]}},lineClasses:{0:{name:"default",color:[255,255,255]}},obbClasses:{0:{name:"default",color:[255,255,255]}},rectMinEdgeSize:.02},reducers:{addRectClass:(e,t)=>{e.rectClasses[t.payload.id]=t.payload.attrs},addPointClass:(e,t)=>{e.pointClasses[t.payload.id]=t.payload.attrs},addPolygonClass:(e,t)=>{e.polygonClasses[t.payload.id]=t.payload.attrs},addLineClass:(e,t)=>{e.lineClasses[t.payload.id]=t.payload.attrs},addObbClass:(e,t)=>{e.obbClasses[t.payload.id]=t.payload.attrs},deleteRectClass:(e,t)=>{delete e.rectClasses[t.payload]},deletePointClass:(e,t)=>{delete e.pointClasses[t.payload]},deletePolygonClass:(e,t)=>{delete e.polygonClasses[t.payload]},deleteLineClass:(e,t)=>{delete e.lineClasses[t.payload]},deleteObbClass:(e,t)=>{delete e.obbClasses[t.payload]},setSettings:(e,t)=>({...e,...t.payload})}}),{addRectClass:o,deleteRectClass:s,addPolygonClass:i,deletePolygonClass:l,addPointClass:r,deletePointClass:c,addLineClass:d,deleteLineClass:u,addObbClass:x,deleteObbClass:b,setSettings:h}=a.actions,y=a.reducer},1783:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>_,B:()=>S,Bb:()=>v,Bj:()=>E,C5:()=>j,DE:()=>M,HD:()=>z,Kg:()=>b,M:()=>h,Mu:()=>w,O8:()=>A,OE:()=>c,U_:()=>x,_y:()=>m,aA:()=>f,cE:()=>g,cr:()=>u,eU:()=>N,fw:()=>y,nj:()=>p,rJ:()=>I,rY:()=>r,v0:()=>C,vJ:()=>D,xJ:()=>d,xh:()=>k});var a=n(1990),o=n(7355),s=n(8108);let i={selectedAnnotation:-1,selectedVertex:-1,hoveringAnnotation:-1,hoveringVertex:-1,annotations:{},annotationsHistory:{0:{annotations:{},length:0}},historyIndex:0,selectedTool:"SELECT",width:640,height:640,selectedClassID:0,lastIndex:0,historyLastIndex:0,zoom:800,isDrawing:!1,isEditing:!1},l=(0,a.Z0)({name:"canvas",initialState:i,reducers:{loadAnnotations:(e,t)=>{e.lastIndex=t.payload.length;let n={};t.payload.forEach((e,t)=>{n[t]={object:e}}),e.annotations=n,e.annotationsHistory={0:{annotations:n,length:t.payload.length}}},startDrawRect:(e,t)=>{let n=t.payload.classID,a=t.payload.mousePosition,o={type:"bbox",class_id:n,x1:a.x,y1:a.y,x2:a.x,y2:a.y};e.annotations[e.lastIndex]={object:o},e.lastIndex+=1},drawPoint:(e,t)=>{let n=t.payload.classID,a=t.payload.mousePosition,o={type:"keypoint",class_id:n,x:a.x,y:a.y};e.annotations[e.lastIndex]={object:o},e.lastIndex+=1},resetHistory:e=>{e.annotationsHistory={0:{annotations:{},length:0}},e.historyIndex=0},saveAnnotationsHistory:e=>{e.annotationsHistory[e.historyIndex+1]={annotations:e.annotations,length:e.lastIndex},e.historyLastIndex=e.historyIndex+1,e.historyIndex+=1,console.log("saving state")},goForwardHistory:e=>{e.historyIndex<e.historyLastIndex&&(e.historyIndex+=1,e.annotations=e.annotationsHistory[e.historyIndex].annotations,e.lastIndex=e.annotationsHistory[e.historyIndex].length)},goBackwardHistory:e=>{e.historyIndex>0&&(e.historyIndex-=1,e.annotations=e.annotationsHistory[e.historyIndex].annotations,e.lastIndex=e.annotationsHistory[e.historyIndex].length)},updateDrawRect:(e,t)=>{let n=e.annotations[e.lastIndex-1].object;if("bbox"!=n.type)return;let a=t.payload;e.annotations[e.lastIndex-1].object={type:"bbox",class_id:n.class_id,x1:n.x1,y1:n.y1,x2:a.x,y2:a.y}},updateAnnotation:(e,t)=>{e.annotations[t.payload.Index].object=t.payload.updatedAnnotation},updateHoveringAnnotation:(e,t)=>{e.hoveringAnnotation=-1;let n=t.payload;for(let[t,a]of Object.entries(e.annotations)){switch(a.object.type){case"polygon":case"obb":case"line":break;case"bbox":o.A.containPoint(a.object,n.x,n.y)&&(e.hoveringAnnotation=Number(t));break;case"keypoint":s.A.isNear(a.object,n.x,n.y)&&(e.hoveringAnnotation=Number(t))}if(-1!=e.hoveringAnnotation)break}},updateHoveringVertex:(e,t)=>{let n=t.payload;if(e.selectedAnnotation>-1){let t=e.annotations[e.selectedAnnotation].object;switch(t.type){case"polygon":case"obb":case"line":break;case"bbox":let a=o.A.findNearestVertex(t,n.x,n.y);null!=a?e.hoveringVertex=a:e.hoveringVertex=-1}}},selectAnnotationFromHover:e=>{e.selectedAnnotation=e.hoveringAnnotation},selectVertexFromHover:e=>{e.selectedVertex=e.hoveringVertex},resetSelectedAnnotation:e=>{e.selectedAnnotation=-1},setSelectedAnnotation:(e,t)=>{e.selectedAnnotation=t.payload},resetSelectedVertex:e=>{e.selectedVertex=-1},moveVertex:(e,t)=>{let n=t.payload;if(e.selectedAnnotation>-1&&e.selectedVertex>-1){let t=e.annotations[e.selectedAnnotation].object;switch(t.type){case"polygon":case"obb":case"line":break;case"bbox":let a=o.A.moveVertex(t,n.x,n.y,e.selectedVertex);void 0!=a&&(e.annotations[e.selectedAnnotation].object=a)}}},moveSelectedPoint:(e,t)=>{let n=t.payload,a=e.annotations[e.selectedAnnotation].object;if("keypoint"==a.type){let t=s.A.move(a,n.x,n.y);e.annotations[e.selectedAnnotation].object=t}},setSelectedTool:(e,t)=>{e.selectedTool=t.payload},setCanvasSize:(e,t)=>{e.width=t.payload.width,e.height=t.payload.height},setSelectedClassID:(e,t)=>{e.selectedClassID=t.payload},removeAnnotation:(e,t)=>{delete e.annotations[t.payload]},setIsDrawing:(e,t)=>{e.isDrawing=t.payload},setIsEditing:(e,t)=>{e.isEditing=t.payload},resetCanvasState:()=>i}}),{startDrawRect:r,updateDrawRect:c,updateHoveringAnnotation:d,updateHoveringVertex:u,goBackwardHistory:x,goForwardHistory:b,selectAnnotationFromHover:h,selectVertexFromHover:y,setSelectedTool:m,moveVertex:g,resetCanvasState:p,resetSelectedAnnotation:f,resetSelectedVertex:v,saveAnnotationsHistory:w,setCanvasSize:j,setSelectedClassID:C,loadAnnotations:z,resetHistory:N,setSelectedAnnotation:k,removeAnnotation:A,updateAnnotation:I,setIsDrawing:E,setIsEditing:D,drawPoint:M,moveSelectedPoint:S}=l.actions,_=l.reducer},2738:(e,t,n)=>{"use strict";n.d(t,{M:()=>i});var a=n(1990),o=n(1783),s=n(1006);let i=(0,a.U1)({reducer:{canvas:o.Ay,settings:s.Ay}})},4065:(e,t,n)=>{"use strict";async function a(e,t){let n=await e.getFileHandle("settings.json",{create:!0}),a=await n.createWritable();await a.write(JSON.stringify(t,null,2)),await a.close(),console.log("Saved ".concat(t," to settings.json file."))}async function o(e){try{let t=await e.getFileHandle("settings.json",{create:!1}),n=await t.getFile(),a=await n.text();return JSON.parse(a)}catch(e){return console.log("Error in loading the settings.json",e),null}}n.d(t,{D:()=>a,M:()=>o})},6410:(e,t,n)=>{Promise.resolve().then(n.bind(n,7748))},7355:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});class a{static moveVertex(e,t,n,a){if(null==a)return;let o={...e};switch(a){case 1:o.x1=t,o.y1=n;break;case 2:o.x2=t,o.y1=n;break;case 3:o.x2=t,o.y2=n;break;case 4:o.x1=t,o.y2=n}return o}static findNearestVertex(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.02,o=new Map([[1,{x:e.x1,y:e.y1}],[2,{x:e.x2,y:e.y1}],[3,{x:e.x2,y:e.y2}],[4,{x:e.x1,y:e.y2}]]),s=null,i=1/0;return o.forEach((e,o)=>{let l=Math.hypot(e.x-t,e.y-n);l<a&&l<i&&(i=l,s=o)}),s}static draw(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[255,0,0],s=t.width,i=t.height,l=t.getContext("2d");if(null==l)return;l.strokeStyle="rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 1)");let r=e.x1*s,c=e.x2*s,d=e.y1*i,u=e.y2*i;if(l.beginPath(),l.lineWidth=1,l.fillStyle="rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 0.9)"),l.rect(r-2,d-2,4,4),l.rect(r-2,u-2,4,4),l.rect(c-2,d-2,4,4),l.rect(c-2,u-2,4,4),a){let t=this.giveVertex(e,a);t&&l.rect(t.x*s-5,t.y*i-5,10,10)}l.fill(),l.rect(r,d,c-r,u-d),n?(l.fillStyle="rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 0.2)"),l.fill()):l.stroke()}static containPoint(e,t,n){let a=Math.min(e.x1,e.x2),o=Math.max(e.x1,e.x2),s=Math.min(e.y1,e.y2),i=Math.max(e.y1,e.y2);return!!(a<t)&&!!(t<o)&&!!(s<n)&&!!(n<i)}static giveVertex(e,t){switch(t){case 1:return{x:e.x1,y:e.y1};case 2:return{x:e.x2,y:e.y1};case 3:return{x:e.x2,y:e.y2};case 4:return{x:e.x1,y:e.y2};default:return null}}static longestDimSize(e){return Math.max(Math.abs(e.y2-e.y1),Math.abs(e.x2-e.x1))}}let o=a},7748:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>W});var a=n(5155),o=n(2115);function s(e){var t,n;let{cards:o,onSelect:s,handlePrevious:i,handleNext:l,imagesLen:r}=e,c=null!==(n=null===(t=o[2])||void 0===t?void 0:t[0])&&void 0!==n?n:0;return(0,a.jsxs)("aside",{className:"w-full md:w-64 p-4 bg-zinc-900 border-r border-zinc-700 overflow-y-auto h-[90vh] max-h-screen shadow-inner flex flex-col gap-4 text-zinc-100",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("button",{onClick:i,disabled:0===c,className:"px-3 py-1 text-sm font-medium rounded border transition duration-150 ".concat(0===c?"bg-zinc-700 text-zinc-500 border-zinc-600 cursor-not-allowed":"bg-zinc-800 hover:bg-zinc-700 text-blue-400 border-blue-500"),children:"← Previous"}),(0,a.jsx)("button",{onClick:l,disabled:c===r-1,className:"px-3 py-1 text-sm font-medium rounded border transition duration-150 ".concat(c===r-1?"bg-zinc-700 text-zinc-500 border-zinc-600 cursor-not-allowed":"bg-zinc-800 hover:bg-zinc-700 text-blue-400 border-blue-500"),children:"Next →"})]}),(0,a.jsxs)("div",{className:"text-center text-xs text-zinc-400",children:["Image ",(0,a.jsx)("span",{className:"font-semibold text-zinc-100",children:c+1})," of"," ",(0,a.jsx)("span",{className:"font-semibold text-zinc-100",children:r})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-3 justify-items-center",children:o.map((e,t)=>{let[n,o]=e;return o?(0,a.jsx)("img",{src:o,alt:"Image ".concat(n),onClick:()=>s(t),className:"object-cover cursor-pointer rounded-md border transition-all duration-200 ".concat(2===t?"w-48 h-32 border-blue-500 shadow-lg opacity-100":"w-40 h-28 border-zinc-600 opacity-60 hover:opacity-90 hover:border-blue-400")},t):(0,a.jsx)("div",{className:"w-40 h-28 bg-zinc-700 text-zinc-400 flex items-center justify-center rounded-md",children:"Empty"},t)})})]})}function i(e){let t=e.currentTarget.getBoundingClientRect(),n=e.currentTarget.width,a=e.currentTarget.height;return{x:(e.clientX-t.left)/n,y:(e.clientY-t.top)/a}}var l=n(1783);let r={bbox:"rectClasses",keypoint:"pointClasses",line:"lineClasses",obb:"obbClasses",polygon:"polygonClasses"};function c(e,t,n,a){if("keydown"===e.type||"keyup"===e.type){var o,s,c,d;o=e,s=0,c=0,d=a,"keydown"===o.type&&(o.ctrlKey&&"key"in o&&"z"===o.key&&d((0,l.U_)()),o.ctrlKey&&"key"in o&&"y"===o.key&&d((0,l.Kg)()));return}if("mousemove"===e.type||"mousedown"===e.type||"mouseup"===e.type)switch(t.selectedTool){case"SELECT":!function(e,t,n,a){switch(e.type){case"mousedown":if(0==e.button){if(-1!=t.hoveringAnnotation){switch(t.annotations[t.hoveringAnnotation].object.type){case"bbox":a((0,l._y)("EDIT_RECT")),a((0,l.vJ)(!0));break;case"keypoint":a((0,l._y)("EDIT_POINT")),a((0,l.vJ)(!0))}a((0,l.M)())}}else if(2==e.button){let e=t.selectedClassID,o=Math.max(...Object.keys(t.annotations).map(Number));a(n[r[t.annotations[o].object.type]][e+1]?(0,l.v0)(e+1):(0,l.v0)(0))}break;case"mouseup":break;case"mousemove":let o=i(e);a((0,l.xJ)(o)),a((0,l.cr)(o))}}(e,t,n,a);break;case"EDIT_RECT":!function(e,t,n,a){switch(e.type){case"mousedown":if(0==e.button){if(-1!=t.hoveringVertex)a((0,l.fw)());else if(a((0,l.Bb)()),-1!=t.hoveringAnnotation){switch(t.annotations[t.hoveringAnnotation].object.type){case"bbox":a((0,l._y)("EDIT_RECT"));break;case"keypoint":a((0,l._y)("EDIT_POINT"))}a((0,l.M)())}else a((0,l._y)("SELECT")),a((0,l.aA)()),a((0,l.Bb)())}else if(2==e.button){let e=n.rectClasses,o=t.selectedAnnotation,s=t.annotations[o].object,i=s.class_id;if(e[i+1]){let e={...s,class_id:i+1};a((0,l.rJ)({updatedAnnotation:e,Index:o})),a((0,l.v0)(i+1))}else{let e={...s,class_id:0};a((0,l.rJ)({updatedAnnotation:e,Index:o})),a((0,l.v0)(0))}a((0,l.Mu)())}break;case"mouseup":0==e.button&&-1!=t.selectedVertex&&(a((0,l.Mu)()),a((0,l.Bb)()));break;case"mousemove":let o=i(e);a((0,l.xJ)(o)),a((0,l.cr)(o)),-1!=t.selectedVertex&&a((0,l.cE)(o))}}(e,t,n,a);break;case"DRAW_RECT":!function(e,t,n,a){switch(e.type){case"mousedown":if(0==e.button){let n=i(e);a((0,l.rY)({classID:t.selectedClassID,mousePosition:n})),a((0,l.Bj)(!0))}else if(2==e.button){let e=n.rectClasses,o=t.selectedClassID;a(e[o+1]?(0,l.v0)(o+1):(0,l.v0)(0))}break;case"mouseup":0==e.button&&(a((0,l.Mu)()),a((0,l.Bj)(!1)));break;case"mousemove":if(t.isDrawing){let t=i(e);a((0,l.OE)(t))}}}(e,t,n,a);break;case"DRAW_POINT":!function(e,t,n,a){if("mousedown"===e.type){if(0==e.button){let n=i(e);a((0,l.DE)({classID:t.selectedClassID,mousePosition:n})),a((0,l.Mu)())}else if(2==e.button){let e=n.pointClasses,o=t.selectedClassID;a(e[o+1]?(0,l.v0)(o+1):(0,l.v0)(0)),a((0,l.Mu)())}}}(e,t,n,a);break;case"EDIT_POINT":!function(e,t,n,a){switch(e.type){case"mousedown":if(0==e.button){if(-1!=t.hoveringAnnotation){switch(t.annotations[t.hoveringAnnotation].object.type){case"bbox":a((0,l._y)("EDIT_RECT")),a((0,l.vJ)(!0));break;case"keypoint":a((0,l._y)("EDIT_POINT")),a((0,l.vJ)(!0))}a((0,l.M)())}else a((0,l._y)("SELECT")),a((0,l.vJ)(!1)),a((0,l.aA)()),a((0,l.Bb)())}else if(2==e.button){let e=n.pointClasses,o=t.selectedAnnotation,s=t.annotations[o].object,i=s.class_id;if(e[i+1]){let e={...s,class_id:i+1};a((0,l.rJ)({updatedAnnotation:e,Index:o})),a((0,l.v0)(i+1))}else{let e={...s,class_id:0};a((0,l.rJ)({updatedAnnotation:e,Index:o})),a((0,l.v0)(0))}a((0,l.Mu)())}break;case"mouseup":0==e.button&&-1!=t.selectedAnnotation&&(a((0,l.Mu)()),a((0,l.vJ)(!1)));break;case"mousemove":let o=i(e);a((0,l.xJ)(o)),t.isEditing&&a((0,l.B)(o))}}(e,t,n,a)}}var d=n(8108),u=n(7355),x=n(9007),b=n(4540);function h(e){let{imageSrc:t}=e,n=(0,o.useRef)(null),s=(0,x.j)(),i=(0,b.d4)(e=>e.canvas),r=(0,b.d4)(e=>e.settings);return(0,o.useEffect)(()=>{if(!t||!n.current)return;let e=new Image;e.src=t;let a=()=>{let t=Math.max(e.width,e.height)/i.zoom,n=e.width/t,a=e.height/t;s((0,l.C5)({width:n,height:a}))};return e.addEventListener("load",a),()=>{e.removeEventListener("load",a)}},[i,t]),(0,o.useEffect)(()=>{t&&n.current&&!function(e,t,n,a){let o=new Image;o.src=t,e.width=n.width,e.height=n.height;let s=e.getContext("2d");s.clearRect(0,0,e.width,e.height),s.drawImage(o,0,0,e.width,e.height);let i=null;for(let[t,o]of Object.entries(n.annotations)){let s=Number(t),l=o.object,r=null;if(l)switch(i=s===n.selectedAnnotation?n.hoveringVertex:null,l.type){case"bbox":r=a.rectClasses[o.object.class_id].color,"DRAW_RECT"==n.selectedTool||"SELECT"==n.selectedTool?u.A.draw(l,e,s===n.selectedAnnotation,null,a.rectClasses[o.object.class_id].color):u.A.draw(l,e,s===n.hoveringAnnotation||s===n.selectedAnnotation,i,r);break;case"keypoint":r=a.pointClasses[o.object.class_id].color,"DRAW_POINT"==n.selectedTool||"SELECT"==n.selectedTool?d.A.draw(l,e,s===n.selectedAnnotation,r):d.A.draw(l,e,s===n.hoveringAnnotation||s===n.selectedAnnotation,r)}}}(n.current,t,i,r)},[t,i]),(0,a.jsx)("div",{className:"relative w-full h-full flex items-center justify-center bg-zinc-950",children:(0,a.jsx)("canvas",{ref:n,onMouseDown:e=>{c(e,i,r,s)},onMouseMove:e=>{c(e,i,r,s)},onMouseUp:e=>{c(e,i,r,s)},onKeyDown:e=>{c(e,i,r,s)},onContextMenu:e=>{e.preventDefault()},tabIndex:0,className:"outline-none border border-zinc-700  shadow-md bg-zinc-900 focus:ring-1 focus:ring-blue-500 transition duration-150"})})}function y(){var e;let t=(0,x.j)(),n=(0,b.d4)(e=>e.canvas.selectedAnnotation,b.bN),s=(0,b.d4)(e=>e.canvas.annotationsHistory,b.bN),i=(0,b.d4)(e=>e.canvas.historyIndex,b.bN),r=(0,b.d4)(e=>e.settings,b.bN),c=s[i].annotations,d=(0,o.useMemo)(()=>Object.entries(c),[c]),u=-1!==n?null===(e=c[n])||void 0===e?void 0:e.object:null,[h,y]=(0,o.useState)(u?{...u}:null);(0,o.useEffect)(()=>{u&&y({...u})},[u]);let m=e=>{t((0,l.xh)(e)),u&&y({...u})},g=(e,t)=>{h&&y({...h,[e]:t})};return(0,a.jsxs)("div",{className:"w-full h-full bg-zinc-900 border-l border-zinc-700 text-zinc-100 flex flex-col",children:[(0,a.jsxs)("div",{className:"flex flex-col border-b border-zinc-700 flex-grow min-h-0",children:[(0,a.jsxs)("div",{className:"bg-zinc-800 px-4 py-2 text-sm font-medium text-zinc-200",children:["Annotations (",d.length,")"]}),(0,a.jsx)("div",{className:"overflow-y-auto flex-grow divide-y divide-zinc-700",children:0===d.length?(0,a.jsx)("p",{className:"p-3 text-sm text-zinc-500",children:"No annotations yet."}):d.map(e=>{let[o]=e,s=Number(o),i=s===n;return(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 text-sm cursor-pointer ".concat(i?"bg-zinc-800 border-l-4 border-blue-500":"hover:bg-zinc-800"),onClick:()=>m(s),children:[(0,a.jsxs)("span",{className:"text-zinc-300 font-medium",children:["#",s]}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),t((0,l.O8)(s)),t((0,l.Mu)()),s===n&&(t((0,l.xh)(-1)),y(null))},className:"text-red-400 hover:underline text-xs",children:"Remove"})]},o)})})]}),(0,a.jsxs)("div",{className:"border-t border-zinc-700 ",children:[(0,a.jsx)("div",{className:"bg-zinc-800 px-4 py-2 text-sm font-medium text-zinc-200",children:u?"Selected Annotation #".concat(n):"No annotation selected"}),u&&h&&(0,a.jsxs)("div",{className:"p-4 flex flex-col gap-2 text-xs bg-zinc-900",children:[Object.keys(h).map(e=>(0,a.jsxs)("label",{className:"flex justify-between items-center gap-2",children:[(0,a.jsx)("span",{className:"text-zinc-400",children:e}),"type"==e?(0,a.jsx)("span",{className:"bg-zinc-800 text-zinc-100 px-2 py-1 text-left w-24 ",children:h.type}):(0,a.jsx)("input",{type:"number",value:h[e],onChange:t=>g(e,parseFloat(t.target.value)),className:"bg-zinc-800 text-zinc-100 px-2 py-1 text-left w-24 border border-zinc-600 focus:outline-none focus:ring focus:ring-blue-500"})]},e)),(0,a.jsx)("button",{onClick:()=>{if(null!==n&&h)switch(h.type){case"bbox":r.rectClasses[h.class_id]&&(t((0,l.rJ)({updatedAnnotation:h,Index:n})),t((0,l.v0)(h.class_id)),t((0,l.Mu)()));break;case"keypoint":r.pointClasses[h.class_id]&&(t((0,l.rJ)({updatedAnnotation:h,Index:n})),t((0,l.v0)(h.class_id)),t((0,l.Mu)()))}},className:"mt-2 w-full py-1 bg-blue-600 text-white hover:bg-blue-700 transition",children:"Save Changes"})]})]})]})}var m=n(1006);let g=["rect","point","polygon","line","obb"],p=()=>[Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random())],f=e=>{let{color:t=[255,255,255]}=e;return(0,a.jsx)("div",{className:"w-5 h-5 rounded shadow-sm",style:{backgroundColor:"rgb(".concat(t[0],", ").concat(t[1],", ").concat(t[2],")")}})},v=e=>{let{isOpen:t,onClose:n,settings:s}=e,i=(0,x.j)(),[l,r]=(0,o.useState)("rect"),[c,d]=(0,o.useState)(""),[u,b]=(0,o.useState)(p()),[h,y]=(0,o.useState)(Object.keys(s.rectClasses).length),[v,w]=(0,o.useState)("");if(!t)return null;let j=()=>s["".concat(l,"Classes")]||{},C=e=>{i(({rect:m.QH,point:m.Ih,polygon:m.GI,line:m.k5,obb:m.LT})[l](e))},z=j();return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex justify-center items-center z-50",children:(0,a.jsx)("div",{className:"bg-zinc-900 p-6 rounded-xl shadow-2xl w-full max-w-xl border border-zinc-700",children:(0,a.jsxs)("div",{className:"text-zinc-100",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Annotation Class Settings"}),(0,a.jsx)("div",{className:"flex space-x-2 mb-4",children:g.map(e=>(0,a.jsx)("button",{onClick:()=>{r(e),y(Object.keys(s["".concat(e,"Classes")]).length),w("")},className:"px-3 py-1 rounded-md transition ".concat(l===e?"bg-blue-600 text-white":"bg-zinc-700 text-zinc-300"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),v&&(0,a.jsx)("p",{className:"text-red-400 mb-2",children:v}),(0,a.jsxs)("div",{className:"mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[(0,a.jsx)("input",{type:"text",value:c,onChange:e=>d(e.target.value),placeholder:"Class Name",className:"bg-zinc-800 text-white border border-zinc-600 p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,a.jsx)("input",{type:"color",value:"#".concat(u.map(e=>e.toString(16).padStart(2,"0")).join("")),onChange:e=>{b(e.target.value.slice(1).match(/.{1,2}/g).map(e=>parseInt(e,16)))},onClick:()=>b(p()),className:"cursor-pointer border border-zinc-600 rounded-md w-10 h-10"})]}),(0,a.jsx)("button",{onClick:()=>{if(""===c.trim()){w("Class name cannot be empty.");return}let e=j(),t=Object.values(e).some(e=>e.name===c),n=Object.values(e).some(e=>e.color[0]===u[0]&&e.color[1]===u[1]&&e.color[2]===u[2]);if(t){w("Class name already exists.");return}if(n){w("Class color already exists.");return}i(({rect:m.Q6,point:m.y5,polygon:m._h,line:m.K9,obb:m.Zv})[l]({id:h,attrs:{name:c,color:u}})),d(""),b(p()),y(h+1),w("")},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition",children:"Add Class"})]}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-72 border-t border-zinc-700 pt-4",children:(0,a.jsx)("ul",{className:"space-y-3",children:Object.entries(z).map(e=>{let[t,{name:n,color:o}]=e;return(0,a.jsxs)("li",{className:"flex items-center justify-between gap-3 text-sm bg-zinc-800 p-2 rounded-md shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(f,{color:o}),(0,a.jsxs)("span",{className:"text-zinc-400",children:["#",t]}),(0,a.jsx)("span",{className:"text-zinc-100",children:n})]}),(0,a.jsx)("button",{onClick:()=>C(Number(t)),className:"bg-red-600 hover:bg-red-700 text-white py-1 px-3 rounded-md transition",children:"Remove"})]},t)})})}),(0,a.jsx)("button",{className:"mt-6 w-full bg-zinc-700 hover:bg-zinc-600 text-white py-2 rounded-md transition",onClick:n,children:"Close"})]})})})};function w(e){let{onLoadImages:t,onSync:n,onSettings:o,onExport:s}=e;return(0,a.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,a.jsx)("button",{onClick:o,className:"bg-zinc-800 text-zinc-100 px-4 py-2 rounded-md border border-zinc-600 hover:bg-zinc-700 hover:border-blue-500 transition",children:"⚙️ Settings"}),(0,a.jsx)("button",{onClick:t,className:"bg-zinc-800 text-zinc-100 px-4 py-2 rounded-md border border-zinc-600 hover:bg-zinc-700 hover:border-blue-500 transition",children:"\uD83D\uDCC1 Load Images"}),(0,a.jsx)("button",{onClick:n,className:"bg-zinc-800 text-zinc-100 px-4 py-2 rounded-md border border-zinc-600 hover:bg-zinc-700 hover:border-blue-500 transition",children:"\uD83D\uDD04 Sync Images"}),(0,a.jsx)("button",{onClick:s,className:"bg-zinc-800 text-zinc-100 px-4 py-2 rounded-md border border-zinc-600 hover:bg-zinc-700 hover:border-blue-500 transition",children:"\uD83D\uDCBE Export YOLO"})]})}var j=n(4383),C=n(5373),z=n(2738),N=n(4065);async function k(e){let t=await e.getDirectoryHandle("yolo",{create:!0}),n=await e.getDirectoryHandle("annotations");if(n&&t)for await(let[e]of n.entries()){let a=await n.getFileHandle(e),o=await a.getFile(),s=JSON.parse(await o.text()).annotations,i=await t.getFileHandle(function(e){let t=e.lastIndexOf(".");return -1===t?"".concat(e,".txt"):"".concat(e.substring(0,t),".txt")}(e),{create:!0}),l=await i.createWritable(),r=[];s.forEach(e=>{if("bbox"==e.type){let t=(e.x1+e.x2)*.5,n=(e.y1+e.y2)*.5,a=Math.abs(e.x2-e.x1),o=Math.abs(e.y2-e.y1);r.push("".concat(e.class_id," ").concat(t," ").concat(n," ").concat(a," ").concat(o))}}),await l.write(r.join("\n")+"\n"),await l.close()}}let A=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),I=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),E=e=>{let t=I(e);return t.charAt(0).toUpperCase()+t.slice(1)},D=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>!!e&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()},M=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var S={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let _=(0,o.forwardRef)((e,t)=>{let{color:n="currentColor",size:a=24,strokeWidth:s=2,absoluteStrokeWidth:i,className:l="",children:r,iconNode:c,...d}=e;return(0,o.createElement)("svg",{ref:t,...S,width:a,height:a,stroke:n,strokeWidth:i?24*Number(s)/Number(a):s,className:D("lucide",l),...!r&&!M(d)&&{"aria-hidden":"true"},...d},[...c.map(e=>{let[t,n]=e;return(0,o.createElement)(t,n)}),...Array.isArray(r)?r:[r]])}),T=(e,t)=>{let n=(0,o.forwardRef)((n,a)=>{let{className:s,...i}=n;return(0,o.createElement)(_,{ref:a,iconNode:t,className:D("lucide-".concat(A(E(e))),"lucide-".concat(e),s),...i})});return n.displayName=E(e),n},O=T("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),H=T("circle-dot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]),P=T("move",[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]]),R=T("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),L=T("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),J=[{id:"DRAW_RECT",icon:(0,a.jsx)(O,{size:16})},{id:"DRAW_POINT",icon:(0,a.jsx)(H,{size:16})}];function V(){var e;let t=(0,x.j)(),n=(0,b.d4)(e=>e.canvas.selectedTool),[s,i]=(0,o.useState)("DRAW_RECT"),[r,c]=(0,o.useState)(!1),d=e=>{t((0,l._y)(e)),t((0,l.aA)()),t((0,l.Bb)())},u=e=>{i(e),d(e),c(!1)},h="EDIT_RECT"===n||"EDIT_POINT"===n;return(0,a.jsxs)("div",{className:"absolute top-4 left-4 z-20 flex gap-2",children:[(0,a.jsx)("button",{title:"Select",onClick:()=>d("SELECT"),className:"w-10 h-10 flex items-center justify-center shadow border border-zinc-600 transition\n          ".concat("SELECT"===n?"bg-blue-600/80 text-white":"bg-zinc-800/80 text-zinc-300 hover:bg-zinc-700/80"),children:(0,a.jsx)(P,{size:18})},"SELECT"),(0,a.jsx)("button",{title:"Edit",onClick:()=>d("EDIT_RECT"),className:"w-10 h-10 flex items-center justify-center shadow border border-zinc-600 transition\n          ".concat(h?"bg-blue-600/80 text-white":"bg-zinc-800/80 text-zinc-300 hover:bg-zinc-700/80"),children:(0,a.jsx)(R,{size:18})},"EDIT_RECT"),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{onClick:()=>{d(s),c(e=>!e)},title:"Draw Tool",className:"w-10 h-10 flex items-center justify-center shadow border border-zinc-600 transition\n            ".concat(n.startsWith("DRAW")?"bg-blue-600/80 text-white":"bg-zinc-800/80 text-zinc-300 hover:bg-zinc-700/80"),children:(null===(e=J.find(e=>e.id===s))||void 0===e?void 0:e.icon)||(0,a.jsx)(L,{size:18})}),r&&(0,a.jsx)("div",{onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),className:"absolute top-12 left-0 w-10 bg-zinc-800 border border-zinc-600 shadow z-30",children:J.map(e=>{let{id:t,icon:n}=e;return(0,a.jsx)("button",{onClick:()=>u(t),className:"w-full h-9 flex items-center gap-2 px-3 py-2 text-sm text-zinc-300 hover:bg-zinc-700",children:n},t)})})]})]})}function W(){let e=(0,x.j)(),t=(0,b.d4)(e=>e.settings),{db:n,imagesDirHandle:i,rootDirHandle:r,annotationsDirHandle:c}=(0,C.B)(),d=[null,null,null],[u,m]=(0,o.useState)([d,d,d,d,d]),[g,p]=(0,o.useState)(0),[f,A]=(0,o.useState)(!1),[I,E]=(0,o.useState)(0),D=()=>{A(!f),r&&(0,N.D)(r,t)};function M(e){let t=e.lastIndexOf(".");return -1===t?"".concat(e,".json"):"".concat(e.substring(0,t),".json")}async function S(){if(!c||!u[2][1])return;let e=u[2][2];if(!e)return;let t=M(e.name),n=[],a=z.M.getState(),o=a.canvas.annotations,s=a.canvas.lastIndex;for(let e=0;e<s;e++){if(void 0==o[e])continue;let t=o[e].object;n.push(t)}try{let e=await c.getFileHandle(t,{create:!0}),a=await e.createWritable();await a.write(JSON.stringify({name:t,annotations:n,labels:[]},null,2)),await a.close()}catch(e){console.error("Error saving annotations:",e)}}async function _(t){let n=t[2];if(null==n||null==c)return;let a=M(n.name);try{let t=await c.getFileHandle(a),n=await t.getFile(),o=await n.text(),s=JSON.parse(o);e((0,l.HD)(s.annotations))}catch(t){console.warn('Annotation file "'.concat(a,'" could not load. error: "').concat(t,'"')),e((0,l.HD)([])),e((0,l.eU)())}}async function T(){if(!n)return;let e=await (0,j.AK)(n);p(e),await P(0,e,n,i,0)}async function O(){i&&r&&n&&(await (0,j.kP)(i,n),await (0,j.wZ)(n,r),p(await (0,j.AK)(n)))}async function H(){try{r&&await k(r)}catch(e){console.log("Error in exporting annotation to yolo format, error: ",e)}}async function P(t,n,a,o,s){if(!a||!o)return;let i=s+t;if(i<0||i>=n)return;let r=Math.floor(2.5),c=Math.max(0,i-r),u=Math.min(n,i+r+1)-c,x=Math.max(0,r-i),b=await (0,j.kg)(o,a,c,u);if(!b)return;let h=[...Array(x).fill(d),...b,...Array(5-u-x).fill(d)];m(h),e((0,l.nj)()),await _(h[2]),E(i)}async function R(){await S(),await P(-1,g,n,i,I)}async function L(){await S(),await P(1,g,n,i,I)}async function J(e){let t=Math.floor(2.5);await S(),await P(e-t,g,n,i,I)}return(0,o.useEffect)(()=>{try{T()}catch(e){console.log("error in loading images. error:",e)}},[]),(0,a.jsxs)("div",{className:"flex flex-col h-screen bg-zinc-950 text-zinc-100 h-full",children:[(0,a.jsx)("header",{className:"bg-zinc-900 border-b border-zinc-700 px-4 py-3 shadow-md",children:(0,a.jsx)(w,{onLoadImages:T,onSync:O,onSettings:D,onExport:H})}),(0,a.jsxs)("div",{className:"flex flex-row flex-grow overflow-hidden h-full",children:[(0,a.jsx)("aside",{className:"bg-zinc-900 border-r border-zinc-700 w-full h-full md:w-64 overflow-y-auto",children:(0,a.jsx)(s,{cards:u,onSelect:J,handlePrevious:R,handleNext:L,imagesLen:g})}),(0,a.jsxs)("main",{className:"flex-1 relative flex justify-center items-start h-full bg-zinc-950 p-4 overflow-hidden",children:[(0,a.jsx)(V,{}),(0,a.jsx)("div",{className:"max-w-full max-h-full mt-12",children:(0,a.jsx)(h,{imageSrc:u[2][1]})})]}),(0,a.jsx)("aside",{className:"h-full w-full md:w-64 bg-zinc-900 border-l border-zinc-700",children:(0,a.jsx)(y,{})}),(0,a.jsx)(v,{isOpen:f,onClose:D,settings:t})]})]})}},8108:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});class a{static move(e,t,n){return{...e,x:t,y:n}}static isNear(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.02;return Math.hypot(e.x-t,e.y-n)<a}static draw(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[255,0,0],o=t.width,s=t.height,i=e.x*o,l=e.y*s,r=t.getContext("2d");r&&(r.beginPath(),r.fillStyle="rgba(".concat(a[0],", ").concat(a[1],", ").concat(a[2],", 0.9)"),r.arc(i,l,3,0,2*Math.PI),r.fill(),n&&(r.beginPath(),r.strokeStyle="rgba(".concat(a[0],", ").concat(a[1],", ").concat(a[2],", 0.8)"),r.lineWidth=2,r.arc(i,l,6,0,2*Math.PI),r.stroke()))}}let o=a},9007:(e,t,n)=>{"use strict";n.d(t,{j:()=>o});var a=n(4540);let o=a.wA.withTypes();a.d4.withTypes()}},e=>{var t=t=>e(e.s=t);e.O(0,[635,299,441,684,358],()=>t(6410)),_N_E=e.O()}]);