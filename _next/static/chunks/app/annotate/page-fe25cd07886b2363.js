(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[407],{345:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Q});var o=n(5155),a=n(2115);function s(e){var t,n;let{cards:a,onSelect:s,handlePrevious:i,handleNext:l,imagesLen:r}=e,c=null!==(n=null===(t=a[2])||void 0===t?void 0:t[0])&&void 0!==n?n:0;return(0,o.jsxs)("aside",{className:"w-full md:w-64 p-4 bg-zinc-900 border-r border-zinc-700 overflow-y-auto h-[90vh] max-h-screen shadow-inner flex flex-col gap-4 text-zinc-100",children:[(0,o.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,o.jsxs)("div",{className:"flex justify-between items-center",children:[(0,o.jsx)("button",{onClick:i,disabled:0===c,className:"px-3 py-1 text-sm font-medium rounded border transition duration-150 ".concat(0===c?"bg-zinc-700 text-zinc-500 border-zinc-600 cursor-not-allowed":"bg-zinc-800 hover:bg-zinc-700 text-blue-400 border-blue-500"),children:"← Previous"}),(0,o.jsx)("button",{onClick:l,disabled:c===r-1,className:"px-3 py-1 text-sm font-medium rounded border transition duration-150 ".concat(c===r-1?"bg-zinc-700 text-zinc-500 border-zinc-600 cursor-not-allowed":"bg-zinc-800 hover:bg-zinc-700 text-blue-400 border-blue-500"),children:"Next →"})]}),(0,o.jsxs)("div",{className:"text-center text-xs text-zinc-400",children:["Image ",(0,o.jsx)("span",{className:"font-semibold text-zinc-100",children:c+1})," of"," ",(0,o.jsx)("span",{className:"font-semibold text-zinc-100",children:r})]})]}),(0,o.jsx)("div",{className:"grid grid-cols-1 gap-3 justify-items-center",children:a.map((e,t)=>{let[n,a]=e;return a?(0,o.jsx)("img",{src:a,alt:"Image ".concat(n),onClick:()=>s(t),className:"object-cover cursor-pointer rounded-md border transition-all duration-200 ".concat(2===t?"w-48 h-32 border-blue-500 shadow-lg opacity-100":"w-40 h-28 border-zinc-600 opacity-60 hover:opacity-90 hover:border-blue-400")},t):(0,o.jsx)("div",{className:"w-40 h-28 bg-zinc-700 text-zinc-400 flex items-center justify-center rounded-md",children:"Empty"},t)})})]})}function i(e){let t=e.currentTarget.getBoundingClientRect(),n=e.currentTarget.width,o=e.currentTarget.height;return{x:(e.clientX-t.left)/n,y:(e.clientY-t.top)/o}}function l(e){return{x:e.clientX,y:e.clientY}}var r=n(1783);let c={bbox:"rectClasses",keypoint:"pointClasses",line:"lineClasses",obb:"obbClasses",polygon:"polygonClasses"};var d=n(7355);function u(e,t,n,o){if("wheel"===e.type&&(e.deltaY>0?o((0,r.nF)()):e.deltaY<0&&o((0,r.ke)())),"keydown"===e.type||"keyup"===e.type){var a,s,u,x;a=e,s=0,u=0,x=o,"keydown"===a.type&&(a.ctrlKey&&"key"in a&&"z"===a.key&&x((0,r.U_)()),a.ctrlKey&&"key"in a&&"y"===a.key&&x((0,r.Kg)()));return}if("mousemove"===e.type||"mousedown"===e.type||"mouseup"===e.type)switch(t.selectedTool){case"SELECT":!function(e,t,n,o){switch(e.type){case"mousedown":if(0==e.button){if(-1!=t.hoveringAnnotation){let e=t.annotations[t.hoveringAnnotation].object.class_id;switch(t.annotations[t.hoveringAnnotation].object.type){case"bbox":o((0,r._y)("EDIT_RECT")),o((0,r.v0)(e)),o((0,r.vJ)(!0));break;case"keypoint":o((0,r._y)("EDIT_POINT")),o((0,r.v0)(e)),o((0,r.vJ)(!0))}o((0,r.M)())}else{let t=l(e);o((0,r.QA)(t))}}else if(2==e.button){let e=t.selectedClassID,a=Math.max(...Object.keys(t.annotations).map(Number));o(n[c[t.annotations[a].object.type]][e+1]?(0,r.v0)(e+1):(0,r.v0)(0))}break;case"mouseup":t.previousMousePosition&&o((0,r.Rx)());break;case"mousemove":let a=i(e),s=t.previousMousePosition;if(s){let n=l(e),a={...t.offsets};a.x=a.x+(n.x-s.x),a.y=a.y+(n.y-s.y),o((0,r.nT)(a)),o((0,r.QA)(n))}o((0,r.xJ)(a)),o((0,r.cr)(a))}}(e,t,n,o);break;case"EDIT_RECT":!function(e,t,n,o){switch(e.type){case"mousedown":if(0==e.button){if(-1!=t.hoveringVertex)o((0,r.fw)());else if(o((0,r.Bb)()),-1!=t.hoveringAnnotation){if(t.selectedAnnotation==t.hoveringAnnotation&&"bbox"==t.annotations[t.selectedAnnotation].object.type){o((0,r.vJ)(!0));let t=i(e);o((0,r.QA)(t))}else{let e=t.annotations[t.hoveringAnnotation].object.class_id;switch(t.annotations[t.hoveringAnnotation].object.type){case"bbox":o((0,r._y)("EDIT_RECT")),o((0,r.v0)(e));break;case"keypoint":o((0,r._y)("EDIT_POINT")),o((0,r.v0)(e))}o((0,r.M)())}}else o((0,r._y)("SELECT")),o((0,r.aA)()),o((0,r.Bb)())}else if(2==e.button){let e=n.bbox,a=t.selectedAnnotation,s=t.annotations[a].object,i=s.class_id;if(e[i+1]){let e={...s,class_id:i+1};o((0,r.rJ)({updatedAnnotation:e,Index:a})),o((0,r.v0)(i+1))}else{let e={...s,class_id:0};o((0,r.rJ)({updatedAnnotation:e,Index:a})),o((0,r.v0)(0))}o((0,r.Mu)())}break;case"mouseup":0==e.button&&(-1!=t.selectedVertex&&(o((0,r.Mu)()),o((0,r.Bb)())),t.isEditing&&(o((0,r.vJ)(!1)),o(r.Rx),o((0,r.Mu)())));break;case"mousemove":let a=i(e);if(t.isEditing&&t.previousMousePosition){let e=a.x-t.previousMousePosition.x,n=a.y-t.previousMousePosition.y,s=t.annotations[t.selectedAnnotation].object,i=d.A.move(s,e,n);o((0,r.rJ)({updatedAnnotation:i,Index:t.selectedAnnotation})),o((0,r.QA)(a))}o((0,r.xJ)(a)),o((0,r.cr)(a)),-1!=t.selectedVertex&&o((0,r.cE)(a))}}(e,t,n,o);break;case"DRAW_RECT":!function(e,t,n,o){switch(e.type){case"mousedown":if(0==e.button){let n=i(e);o((0,r.rY)({classID:t.selectedClassID,mousePosition:n})),o((0,r.Bj)(!0))}else if(2==e.button){let e=n.bbox,a=t.selectedClassID;o(e[a+1]?(0,r.v0)(a+1):(0,r.v0)(0))}break;case"mouseup":0==e.button&&(o((0,r.Mu)()),o((0,r.Bj)(!1)));break;case"mousemove":if(t.isDrawing){let t=i(e);o((0,r.OE)(t))}}}(e,t,n,o);break;case"DRAW_POINT":!function(e,t,n,o){if("mousedown"===e.type){if(0==e.button){let n=i(e);o((0,r.DE)({classID:t.selectedClassID,mousePosition:n})),o((0,r.Mu)())}else if(2==e.button){let e=n.keypoint,a=t.selectedClassID;o(e[a+1]?(0,r.v0)(a+1):(0,r.v0)(0)),o((0,r.Mu)())}}}(e,t,n,o);break;case"EDIT_POINT":!function(e,t,n,o){switch(e.type){case"mousedown":if(0==e.button){if(-1!=t.hoveringAnnotation){let e=t.annotations[t.hoveringAnnotation].object.class_id;switch(t.annotations[t.hoveringAnnotation].object.type){case"bbox":o((0,r._y)("EDIT_RECT")),o((0,r.v0)(e)),o((0,r.vJ)(!0));break;case"keypoint":o((0,r._y)("EDIT_POINT")),o((0,r.v0)(e)),o((0,r.vJ)(!0))}o((0,r.M)())}else o((0,r._y)("SELECT")),o((0,r.vJ)(!1)),o((0,r.aA)()),o((0,r.Bb)())}else if(2==e.button){let e=n.keypoint,a=t.selectedAnnotation,s=t.annotations[a].object,i=s.class_id;if(e[i+1]){let e={...s,class_id:i+1};o((0,r.rJ)({updatedAnnotation:e,Index:a})),o((0,r.v0)(i+1))}else{let e={...s,class_id:0};o((0,r.rJ)({updatedAnnotation:e,Index:a})),o((0,r.v0)(0))}o((0,r.Mu)())}break;case"mouseup":0==e.button&&-1!=t.selectedAnnotation&&(o((0,r.Mu)()),o((0,r.vJ)(!1)));break;case"mousemove":let a=i(e);o((0,r.xJ)(a)),t.isEditing&&o((0,r.B)(a))}}(e,t,n,o)}}var x=n(8108),b=n(9007),h=n(4540);function y(e){let{imageSrc:t}=e,n=(0,a.useRef)(null),s=(0,b.j)(),i=(0,h.d4)(e=>e.canvas),l=(0,h.d4)(e=>e.canvas.zoom),c=(0,h.d4)(e=>e.settings);return(0,a.useEffect)(()=>{if(!t||!n.current)return;let e=new Image;e.src=t;let o=()=>{let t=Math.max(e.width,e.height)/l,n=e.width/t,o=e.height/t;s((0,r.C5)({width:n,height:o}))};return e.addEventListener("load",o),()=>{e.removeEventListener("load",o)}},[l,t]),(0,a.useEffect)(()=>{t&&n.current&&!function(e,t,n,o){let a=new Image;a.src=t,e.width=n.width,e.height=n.height;let s=e.getContext("2d");s.clearRect(0,0,e.width,e.height),s.drawImage(a,0,0,e.width,e.height);let i=null;for(let[t,a]of Object.entries(n.annotations)){let s=Number(t),l=a.object,r=null;if(l)switch(i=s===n.selectedAnnotation?n.hoveringVertex:null,r=o[l.type][a.object.class_id].color,l.type){case"bbox":"DRAW_RECT"==n.selectedTool||"SELECT"==n.selectedTool?d.A.draw(l,e,s===n.selectedAnnotation,null,r):d.A.draw(l,e,s===n.hoveringAnnotation||s===n.selectedAnnotation,i,r);break;case"keypoint":"DRAW_POINT"==n.selectedTool||"SELECT"==n.selectedTool?x.A.draw(l,e,s===n.selectedAnnotation,r):x.A.draw(l,e,s===n.hoveringAnnotation||s===n.selectedAnnotation,r)}}}(n.current,t,i,c)},[t,i]),(0,o.jsx)("div",{className:"flex justify-center items-center w-full h-full bg-zinc-950",children:(0,o.jsx)("canvas",{ref:n,onMouseDown:e=>{u(e,i,c,s)},onMouseMove:e=>{u(e,i,c,s)},onMouseUp:e=>{u(e,i,c,s)},onKeyDown:e=>{u(e,i,c,s)},onContextMenu:e=>{e.preventDefault()},onWheel:e=>{e.preventDefault(),u(e,i,c,s)},tabIndex:0,className:"outline-none border border-zinc-700 shadow-md bg-zinc-900 focus:ring-1 focus:ring-blue-500 ",style:{transform:"translate(".concat(i.offsets.x,"px, ").concat(i.offsets.y,"px)")}})})}function m(){var e;let t=(0,b.j)(),n=(0,h.d4)(e=>e.canvas.selectedAnnotation,h.bN),s=(0,h.d4)(e=>e.canvas.annotationsHistory,h.bN),i=(0,h.d4)(e=>e.canvas.historyIndex,h.bN),l=(0,h.d4)(e=>e.settings,h.bN),c=s[i].annotations,d=(0,a.useMemo)(()=>Object.entries(c),[c]),u=-1!==n?null===(e=c[n])||void 0===e?void 0:e.object:null,[x,y]=(0,a.useState)(u?{...u}:null);(0,a.useEffect)(()=>{u&&y({...u})},[u]);let m=e=>{t((0,r.xh)(e)),u&&y({...u})},p=(e,t)=>{x&&y({...x,[e]:t})};return(0,o.jsxs)("div",{className:"w-full h-full bg-zinc-900 border-l border-zinc-700 text-zinc-100 flex flex-col",children:[(0,o.jsxs)("div",{className:"flex flex-col border-b border-zinc-700 flex-grow min-h-0",children:[(0,o.jsxs)("div",{className:"bg-zinc-800 px-4 py-2 text-sm font-medium text-zinc-200",children:["Annotations (",d.length,")"]}),(0,o.jsx)("div",{className:"overflow-y-auto flex-grow divide-y divide-zinc-700",children:0===d.length?(0,o.jsx)("p",{className:"p-3 text-sm text-zinc-500",children:"No annotations yet."}):d.map(e=>{let[a]=e,s=Number(a),i=s===n;return(0,o.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 text-sm cursor-pointer ".concat(i?"bg-zinc-800 border-l-4 border-blue-500":"hover:bg-zinc-800"),onClick:()=>m(s),children:[(0,o.jsxs)("span",{className:"text-zinc-300 font-medium",children:["#",s]}),(0,o.jsx)("button",{onClick:e=>{e.stopPropagation(),t((0,r.O8)(s)),t((0,r.Mu)()),s===n&&(t((0,r.xh)(-1)),y(null))},className:"text-red-400 hover:underline text-xs",children:"Remove"})]},a)})})]}),(0,o.jsxs)("div",{className:"border-t border-zinc-700 ",children:[(0,o.jsx)("div",{className:"bg-zinc-800 px-4 py-2 text-sm font-medium text-zinc-200",children:u?"Selected Annotation #".concat(n):"No annotation selected"}),u&&x&&(0,o.jsxs)("div",{className:"p-4 flex flex-col gap-2 text-xs bg-zinc-900",children:[Object.keys(x).map(e=>(0,o.jsxs)("label",{className:"flex justify-between items-center gap-2",children:[(0,o.jsx)("span",{className:"text-zinc-400",children:e}),"type"==e?(0,o.jsx)("span",{className:"bg-zinc-800 text-zinc-100 px-2 py-1 text-left w-24 ",children:x.type}):(0,o.jsx)("input",{type:"number",value:x[e],onChange:t=>p(e,parseFloat(t.target.value)),className:"bg-zinc-800 text-zinc-100 px-2 py-1 text-left w-24 border border-zinc-600 focus:outline-none focus:ring focus:ring-blue-500"})]},e)),(0,o.jsx)("button",{onClick:()=>{null!==n&&x&&l[x.type][x.class_id]&&(t((0,r.rJ)({updatedAnnotation:x,Index:n})),t((0,r.v0)(x.class_id)),t((0,r.Mu)()))},className:"mt-2 w-full py-1 bg-blue-600 text-white hover:bg-blue-700 transition",children:"Save Changes"})]})]})]})}var p=n(1006);let f=["bbox","keypoint","polygon","line","obb"],g=()=>[Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random())],v=e=>{let{color:t=[255,255,255]}=e;return(0,o.jsx)("div",{className:"w-5 h-5 rounded shadow-sm",style:{backgroundColor:"rgb(".concat(t[0],", ").concat(t[1],", ").concat(t[2],")")}})},w=e=>{let{isOpen:t,onClose:n,settings:s}=e,i=(0,b.j)(),[l,r]=(0,a.useState)("bbox"),[c,d]=(0,a.useState)(""),[u,x]=(0,a.useState)(g()),[h,y]=(0,a.useState)(Object.keys(s.bbox).length),[m,w]=(0,a.useState)("");if(!t)return null;let j=()=>s["".concat(l)]||{},z=e=>{i(({bbox:p.QH,keypoint:p.Ih,polygon:p.GI,line:p.k5,obb:p.LT})[l](e))},N=j();return(0,o.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex justify-center items-center z-50",children:(0,o.jsx)("div",{className:"bg-zinc-900 p-6 rounded-xl shadow-2xl w-full max-w-xl border border-zinc-700",children:(0,o.jsxs)("div",{className:"text-zinc-100",children:[(0,o.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Annotation Class Settings"}),(0,o.jsx)("div",{className:"flex space-x-2 mb-4",children:f.map(e=>(0,o.jsx)("button",{onClick:()=>{r(e),y(Object.keys(s["".concat(e)]).length),w("")},className:"px-3 py-1 rounded-md transition ".concat(l===e?"bg-blue-600 text-white":"bg-zinc-700 text-zinc-300"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),m&&(0,o.jsx)("p",{className:"text-red-400 mb-2",children:m}),(0,o.jsxs)("div",{className:"mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[(0,o.jsxs)("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[(0,o.jsx)("input",{type:"text",value:c,onChange:e=>d(e.target.value),placeholder:"Class Name",className:"bg-zinc-800 text-white border border-zinc-600 p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,o.jsx)("input",{type:"color",value:"#".concat(u.map(e=>e.toString(16).padStart(2,"0")).join("")),onChange:e=>{x(e.target.value.slice(1).match(/.{1,2}/g).map(e=>parseInt(e,16)))},onClick:()=>x(g()),className:"cursor-pointer border border-zinc-600 rounded-md w-10 h-10"})]}),(0,o.jsx)("button",{onClick:()=>{if(""===c.trim()){w("Class name cannot be empty.");return}let e=j(),t=Object.values(e).some(e=>e.name===c),n=Object.values(e).some(e=>e.color[0]===u[0]&&e.color[1]===u[1]&&e.color[2]===u[2]);if(t){w("Class name already exists.");return}if(n){w("Class color already exists.");return}i(({bbox:p.Q6,keypoint:p.y5,polygon:p._h,line:p.K9,obb:p.Zv})[l]({id:h,attrs:{name:c,color:u}})),d(""),x(g()),y(h+1),w("")},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition",children:"Add Class"})]}),(0,o.jsx)("div",{className:"overflow-y-auto max-h-72 border-t border-zinc-700 pt-4",children:(0,o.jsx)("ul",{className:"space-y-3",children:Object.entries(N).map(e=>{let[t,{name:n,color:a}]=e;return(0,o.jsxs)("li",{className:"flex items-center justify-between gap-3 text-sm bg-zinc-800 p-2 rounded-md shadow-sm",children:[(0,o.jsxs)("div",{className:"flex items-center gap-3",children:[(0,o.jsx)(v,{color:a}),(0,o.jsxs)("span",{className:"text-zinc-400",children:["#",t]}),(0,o.jsx)("span",{className:"text-zinc-100",children:n})]}),(0,o.jsx)("button",{onClick:()=>z(Number(t)),className:"bg-red-600 hover:bg-red-700 text-white py-1 px-3 rounded-md transition",children:"Remove"})]},t)})})}),(0,o.jsx)("button",{className:"mt-6 w-full bg-zinc-700 hover:bg-zinc-600 text-white py-2 rounded-md transition",onClick:n,children:"Close"})]})})})};function j(e){let{onLoadImages:t,onSync:n,onSettings:a,onExport:s}=e;return(0,o.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,o.jsx)("button",{onClick:a,className:"bg-zinc-800 text-zinc-100 px-4 py-2 rounded-md border border-zinc-600 hover:bg-zinc-700 hover:border-blue-500 transition",children:"⚙️ Settings"}),(0,o.jsx)("button",{onClick:t,className:"bg-zinc-800 text-zinc-100 px-4 py-2 rounded-md border border-zinc-600 hover:bg-zinc-700 hover:border-blue-500 transition",children:"\uD83D\uDCC1 Load Images"}),(0,o.jsx)("button",{onClick:n,className:"bg-zinc-800 text-zinc-100 px-4 py-2 rounded-md border border-zinc-600 hover:bg-zinc-700 hover:border-blue-500 transition",children:"\uD83D\uDD04 Sync Images"}),(0,o.jsx)("button",{onClick:s,className:"bg-zinc-800 text-zinc-100 px-4 py-2 rounded-md border border-zinc-600 hover:bg-zinc-700 hover:border-blue-500 transition",children:"\uD83D\uDCBE Export YOLO"})]})}var z=n(4383),N=n(5373),k=n(2738),A=n(4065);async function C(e){let t=await e.getDirectoryHandle("yolo",{create:!0}),n=await e.getDirectoryHandle("annotations");if(n&&t)for await(let[e]of n.entries()){let o=await n.getFileHandle(e),a=await o.getFile(),s=JSON.parse(await a.text()).annotations,i=await t.getFileHandle(function(e){let t=e.lastIndexOf(".");return -1===t?"".concat(e,".txt"):"".concat(e.substring(0,t),".txt")}(e),{create:!0}),l=await i.createWritable(),r=[];s.forEach(e=>{if("bbox"==e.type){let t=(e.x1+e.x2)*.5,n=(e.y1+e.y2)*.5,o=Math.abs(e.x2-e.x1),a=Math.abs(e.y2-e.y1);r.push("".concat(e.class_id," ").concat(t," ").concat(n," ").concat(o," ").concat(a))}}),await l.write(r.join("\n")+"\n"),await l.close()}}let I=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),E=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),D=e=>{let t=E(e);return t.charAt(0).toUpperCase()+t.slice(1)},M=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>!!e&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()},T=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var _={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let S=(0,a.forwardRef)((e,t)=>{let{color:n="currentColor",size:o=24,strokeWidth:s=2,absoluteStrokeWidth:i,className:l="",children:r,iconNode:c,...d}=e;return(0,a.createElement)("svg",{ref:t,..._,width:o,height:o,stroke:n,strokeWidth:i?24*Number(s)/Number(o):s,className:M("lucide",l),...!r&&!T(d)&&{"aria-hidden":"true"},...d},[...c.map(e=>{let[t,n]=e;return(0,a.createElement)(t,n)}),...Array.isArray(r)?r:[r]])}),P=(e,t)=>{let n=(0,a.forwardRef)((n,o)=>{let{className:s,...i}=n;return(0,a.createElement)(S,{ref:o,iconNode:t,className:M("lucide-".concat(I(D(e))),"lucide-".concat(e),s),...i})});return n.displayName=D(e),n},O=P("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),R=P("circle-dot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]),H=P("move",[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]]),L=P("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),J=P("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),V=[{id:"DRAW_RECT",icon:(0,o.jsx)(O,{size:16})},{id:"DRAW_POINT",icon:(0,o.jsx)(R,{size:16})}];function W(){var e;let t=(0,b.j)(),n=(0,h.d4)(e=>e.canvas.selectedTool),[s,i]=(0,a.useState)("DRAW_RECT"),[l,c]=(0,a.useState)(!1),d=e=>{t((0,r._y)(e)),t((0,r.aA)()),t((0,r.Bb)())},u=e=>{i(e),d(e),c(!1)},x="EDIT_RECT"===n||"EDIT_POINT"===n;return(0,o.jsxs)("div",{className:"absolute top-4 left-4 z-20 flex gap-2",children:[(0,o.jsx)("button",{title:"Select",onClick:()=>d("SELECT"),className:"w-10 h-10 flex items-center justify-center shadow border border-zinc-600 transition\n          ".concat("SELECT"===n?"bg-blue-600/80 text-white":"bg-zinc-800/80 text-zinc-300 hover:bg-zinc-700/80"),children:(0,o.jsx)(H,{size:18})},"SELECT"),(0,o.jsx)("button",{title:"Edit",onClick:()=>d("EDIT_RECT"),className:"w-10 h-10 flex items-center justify-center shadow border border-zinc-600 transition\n          ".concat(x?"bg-blue-600/80 text-white":"bg-zinc-800/80 text-zinc-300 hover:bg-zinc-700/80"),children:(0,o.jsx)(L,{size:18})},"EDIT_RECT"),(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("button",{onClick:()=>{d(s),c(e=>!e)},title:"Draw Tool",className:"w-10 h-10 flex items-center justify-center shadow border border-zinc-600 transition\n            ".concat(n.startsWith("DRAW")?"bg-blue-600/80 text-white":"bg-zinc-800/80 text-zinc-300 hover:bg-zinc-700/80"),children:(null===(e=V.find(e=>e.id===s))||void 0===e?void 0:e.icon)||(0,o.jsx)(J,{size:18})}),l&&(0,o.jsx)("div",{onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),className:"absolute top-12 left-0 w-10 bg-zinc-800 border border-zinc-600 shadow z-30",children:V.map(e=>{let{id:t,icon:n}=e;return(0,o.jsx)("button",{onClick:()=>u(t),className:"w-full h-9 flex items-center gap-2 px-3 py-2 text-sm text-zinc-300 hover:bg-zinc-700",children:n},t)})})]})]})}let B=e=>{let{name:t="default",color:n=[255,255,255]}=e;return(0,o.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,o.jsx)("div",{className:"w-10 h-4 shadow-sm rounded",style:{backgroundColor:"rgb(".concat(n[0],", ").concat(n[1],", ").concat(n[2],")")}}),(0,o.jsx)("span",{children:t})]})},F={DRAW_RECT:"bbox",DRAW_POINT:"keypoint",EDIT_RECT:"bbox",EDIT_POINT:"keypoint",SELECT:""};function K(){var e,t;let n=(0,b.j)(),s=(0,h.d4)(e=>e.canvas.selectedClassID),i=(0,h.d4)(e=>e.canvas.selectedTool),l=(0,h.d4)(e=>e.settings),[c,d]=(0,a.useState)(!1),[u,x]=(0,a.useState)("bbox");(0,a.useEffect)(()=>{if("SELECT"!=i){let e=F[i];u!=e&&x(e),("DRAW_RECT"==i||"DRAW_POINT"==i)&&n((0,r.v0)(0))}},[i]);let y=l[u],m=null===(e=y[s])||void 0===e?void 0:e.name,p=null===(t=y[s])||void 0===t?void 0:t.color;return(0,o.jsxs)("div",{className:"absolute top-18 left-4 z-20 flex gap-2",onClick:()=>d(!c),children:[(0,o.jsx)(B,{name:m,color:p}),(0,o.jsx)("div",{className:"absolute top-8 z-20 flex-col",children:c&&Object.values(y).map((e,t)=>(0,o.jsx)("button",{className:"gap-2 flex-col flex ".concat(t==s?"opacity-100":"opacity-50"),onClick:()=>n((0,r.v0)(t)),children:(0,o.jsx)(B,{name:e.name,color:e.color})},t))})]})}function Q(){let e=(0,b.j)(),t=(0,h.d4)(e=>e.settings),{db:n,imagesDirHandle:i,rootDirHandle:l,annotationsDirHandle:c}=(0,N.B)(),d=[null,null,null],[u,x]=(0,a.useState)([d,d,d,d,d]),[p,f]=(0,a.useState)(0),[g,v]=(0,a.useState)(!1),[I,E]=(0,a.useState)(0),D=()=>{v(!g),l&&(0,A.D)(l,t)};function M(e){let t=e.lastIndexOf(".");return -1===t?"".concat(e,".json"):"".concat(e.substring(0,t),".json")}async function T(){if(!c||!u[2][1])return;let e=u[2][2];if(!e)return;let t=M(e.name),n=[],o=k.M.getState(),a=o.canvas.annotations,s=o.canvas.lastIndex;for(let e=0;e<s;e++){if(void 0==a[e])continue;let t=a[e].object;n.push(t)}try{let e=await c.getFileHandle(t,{create:!0}),o=await e.createWritable();await o.write(JSON.stringify({name:t,annotations:n,labels:[]},null,2)),await o.close()}catch(e){console.error("Error saving annotations:",e)}}async function _(t){let n=t[2];if(null==n||null==c)return;let o=M(n.name);try{let t=await c.getFileHandle(o),n=await t.getFile(),a=await n.text(),s=JSON.parse(a);e((0,r.HD)(s.annotations))}catch(t){console.warn('Annotation file "'.concat(o,'" could not load. error: "').concat(t,'"')),e((0,r.HD)([])),e((0,r.eU)())}}async function S(){if(!n)return;let e=await (0,z.AK)(n);f(e),await R(0,e,n,i,0)}async function P(){i&&l&&n&&(await (0,z.kP)(i,n),await (0,z.wZ)(n,l),f(await (0,z.AK)(n)))}async function O(){try{l&&await C(l)}catch(e){console.log("Error in exporting annotation to yolo format, error: ",e)}}async function R(t,n,o,a,s){if(!o||!a)return;let i=s+t;if(i<0||i>=n)return;let l=Math.floor(2.5),c=Math.max(0,i-l),u=Math.min(n,i+l+1)-c,b=Math.max(0,l-i),h=await (0,z.kg)(a,o,c,u);if(!h)return;let y=[...Array(b).fill(d),...h,...Array(5-u-b).fill(d)];x(y),e((0,r.nj)()),await _(y[2]),E(i)}async function H(){await T(),await R(-1,p,n,i,I)}async function L(){await T(),await R(1,p,n,i,I)}async function J(e){let t=Math.floor(2.5);await T(),await R(e-t,p,n,i,I)}return(0,a.useEffect)(()=>{try{S()}catch(e){console.log("error in loading images. error:",e)}},[]),(0,o.jsxs)("div",{className:"flex flex-col h-screen bg-zinc-950 text-zinc-100 h-full",children:[(0,o.jsx)("header",{className:"bg-zinc-900 border-b border-zinc-700 px-4 py-3 shadow-md",children:(0,o.jsx)(j,{onLoadImages:S,onSync:P,onSettings:D,onExport:O})}),(0,o.jsxs)("div",{className:"flex flex-row flex-grow overflow-hidden h-full",children:[(0,o.jsx)("aside",{className:"bg-zinc-900 border-r border-zinc-700 w-full h-full md:w-64 overflow-y-auto",children:(0,o.jsx)(s,{cards:u,onSelect:J,handlePrevious:H,handleNext:L,imagesLen:p})}),(0,o.jsxs)("main",{className:"flex-1 relative items-start h-full w-full bg-zinc-950 overflow-hidden",children:[(0,o.jsx)(W,{}),(0,o.jsx)(K,{}),(0,o.jsx)("div",{className:"flex w-full h-full items-center justify-center",children:(0,o.jsx)(y,{imageSrc:u[2][1]})})]}),(0,o.jsx)("aside",{className:"h-full w-full md:w-64 bg-zinc-900 border-l border-zinc-700",children:(0,o.jsx)(m,{})}),(0,o.jsx)(w,{isOpen:g,onClose:D,settings:t})]})]})}},1006:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>y,GI:()=>l,Ih:()=>c,K9:()=>d,LT:()=>b,Q6:()=>a,QH:()=>s,Zv:()=>x,_h:()=>i,k5:()=>u,oc:()=>h,y5:()=>r});let o=(0,n(1990).Z0)({name:"annotationSettings",initialState:{bbox:{0:{name:"default",color:[255,255,255]}},keypoint:{0:{name:"default",color:[255,255,255]}},polygon:{0:{name:"default",color:[255,255,255]}},line:{0:{name:"default",color:[255,255,255]}},obb:{0:{name:"default",color:[255,255,255]}},rectMinEdgeSize:.02},reducers:{addRectClass:(e,t)=>{e.bbox[t.payload.id]=t.payload.attrs},addPointClass:(e,t)=>{e.keypoint[t.payload.id]=t.payload.attrs},addPolygonClass:(e,t)=>{e.polygon[t.payload.id]=t.payload.attrs},addLineClass:(e,t)=>{e.line[t.payload.id]=t.payload.attrs},addObbClass:(e,t)=>{e.obb[t.payload.id]=t.payload.attrs},deleteRectClass:(e,t)=>{delete e.bbox[t.payload]},deletePointClass:(e,t)=>{delete e.keypoint[t.payload]},deletePolygonClass:(e,t)=>{delete e.polygon[t.payload]},deleteLineClass:(e,t)=>{delete e.line[t.payload]},deleteObbClass:(e,t)=>{delete e.obb[t.payload]},setSettings:(e,t)=>({...e,...t.payload})}}),{addRectClass:a,deleteRectClass:s,addPolygonClass:i,deletePolygonClass:l,addPointClass:r,deletePointClass:c,addLineClass:d,deleteLineClass:u,addObbClass:x,deleteObbClass:b,setSettings:h}=o.actions,y=o.reducer},1783:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>H,B:()=>T,Bb:()=>v,Bj:()=>E,C5:()=>j,DE:()=>M,HD:()=>N,Kg:()=>b,M:()=>h,Mu:()=>w,O8:()=>C,OE:()=>c,QA:()=>_,Rx:()=>S,U_:()=>x,_y:()=>m,aA:()=>g,cE:()=>p,cr:()=>u,eU:()=>k,fw:()=>y,ke:()=>O,nF:()=>P,nT:()=>R,nj:()=>f,rJ:()=>I,rY:()=>r,v0:()=>z,vJ:()=>D,xJ:()=>d,xh:()=>A});var o=n(1990),a=n(7355),s=n(8108);let i={selectedAnnotation:-1,selectedVertex:-1,hoveringAnnotation:-1,hoveringVertex:-1,annotations:{},annotationsHistory:{0:{annotations:{},length:0}},historyIndex:0,selectedTool:"SELECT",width:640,height:640,selectedClassID:0,lastIndex:0,historyLastIndex:0,zoom:800,offsets:{x:0,y:0},isDrawing:!1,isEditing:!1,previousMousePosition:null},l=(0,o.Z0)({name:"canvas",initialState:i,reducers:{loadAnnotations:(e,t)=>{e.lastIndex=t.payload.length;let n={};t.payload.forEach((e,t)=>{n[t]={object:e}}),e.annotations=n,e.annotationsHistory={0:{annotations:n,length:t.payload.length}}},startDrawRect:(e,t)=>{let n=t.payload.classID,o=t.payload.mousePosition,a={type:"bbox",class_id:n,x1:o.x,y1:o.y,x2:o.x,y2:o.y};e.annotations[e.lastIndex]={object:a},e.lastIndex+=1},drawPoint:(e,t)=>{let n=t.payload.classID,o=t.payload.mousePosition,a={type:"keypoint",class_id:n,x:o.x,y:o.y};e.annotations[e.lastIndex]={object:a},e.lastIndex+=1},resetHistory:e=>{e.annotationsHistory={0:{annotations:{},length:0}},e.historyIndex=0},saveAnnotationsHistory:e=>{e.annotationsHistory[e.historyIndex+1]={annotations:e.annotations,length:e.lastIndex},e.historyLastIndex=e.historyIndex+1,e.historyIndex+=1,console.log("saving state")},goForwardHistory:e=>{e.historyIndex<e.historyLastIndex&&(e.historyIndex+=1,e.annotations=e.annotationsHistory[e.historyIndex].annotations,e.lastIndex=e.annotationsHistory[e.historyIndex].length)},goBackwardHistory:e=>{e.historyIndex>0&&(e.historyIndex-=1,e.annotations=e.annotationsHistory[e.historyIndex].annotations,e.lastIndex=e.annotationsHistory[e.historyIndex].length)},updateDrawRect:(e,t)=>{let n=e.annotations[e.lastIndex-1].object;if("bbox"!=n.type)return;let o=t.payload;e.annotations[e.lastIndex-1].object={type:"bbox",class_id:n.class_id,x1:n.x1,y1:n.y1,x2:o.x,y2:o.y}},updateAnnotation:(e,t)=>{e.annotations[t.payload.Index].object=t.payload.updatedAnnotation},updateHoveringAnnotation:(e,t)=>{e.hoveringAnnotation=-1;let n=t.payload;for(let[t,o]of Object.entries(e.annotations)){switch(o.object.type){case"polygon":case"obb":case"line":break;case"bbox":a.A.containPoint(o.object,n.x,n.y)&&(e.hoveringAnnotation=Number(t));break;case"keypoint":s.A.isNear(o.object,n.x,n.y)&&(e.hoveringAnnotation=Number(t))}if(-1!=e.hoveringAnnotation)break}},updateHoveringVertex:(e,t)=>{let n=t.payload;if(e.selectedAnnotation>-1){let t=e.annotations[e.selectedAnnotation].object;switch(t.type){case"polygon":case"obb":case"line":break;case"bbox":let o=a.A.findNearestVertex(t,n.x,n.y);null!=o?e.hoveringVertex=o:e.hoveringVertex=-1}}},selectAnnotationFromHover:e=>{e.selectedAnnotation=e.hoveringAnnotation},selectVertexFromHover:e=>{e.selectedVertex=e.hoveringVertex},resetSelectedAnnotation:e=>{e.selectedAnnotation=-1},setSelectedAnnotation:(e,t)=>{e.selectedAnnotation=t.payload},resetSelectedVertex:e=>{e.selectedVertex=-1},moveVertex:(e,t)=>{let n=t.payload;if(e.selectedAnnotation>-1&&e.selectedVertex>-1){let t=e.annotations[e.selectedAnnotation].object;switch(t.type){case"polygon":case"obb":case"line":break;case"bbox":let o=a.A.moveVertex(t,n.x,n.y,e.selectedVertex);void 0!=o&&(e.annotations[e.selectedAnnotation].object=o)}}},moveSelectedPoint:(e,t)=>{let n=t.payload,o=e.annotations[e.selectedAnnotation].object;if("keypoint"==o.type){let t=s.A.move(o,n.x,n.y);e.annotations[e.selectedAnnotation].object=t}},setPreviousMousePosition:(e,t)=>{let n=t.payload;e.previousMousePosition={x:n.x,y:n.y}},resetPreviousMousePosition:e=>{e.previousMousePosition=null},setSelectedTool:(e,t)=>{e.selectedTool=t.payload},setCanvasSize:(e,t)=>{e.width=t.payload.width,e.height=t.payload.height},setSelectedClassID:(e,t)=>{e.selectedClassID=t.payload},removeAnnotation:(e,t)=>{delete e.annotations[t.payload]},setIsDrawing:(e,t)=>{e.isDrawing=t.payload},setIsEditing:(e,t)=>{e.isEditing=t.payload},zoomIn:e=>{e.zoom=e.zoom+50},zoomOut:e=>{e.zoom=Math.max(e.zoom-50,400)},setOffsets:(e,t)=>{e.offsets=t.payload},resetCanvasState:()=>i}}),{startDrawRect:r,updateDrawRect:c,updateHoveringAnnotation:d,updateHoveringVertex:u,goBackwardHistory:x,goForwardHistory:b,selectAnnotationFromHover:h,selectVertexFromHover:y,setSelectedTool:m,moveVertex:p,resetCanvasState:f,resetSelectedAnnotation:g,resetSelectedVertex:v,saveAnnotationsHistory:w,setCanvasSize:j,setSelectedClassID:z,loadAnnotations:N,resetHistory:k,setSelectedAnnotation:A,removeAnnotation:C,updateAnnotation:I,setIsDrawing:E,setIsEditing:D,drawPoint:M,moveSelectedPoint:T,setPreviousMousePosition:_,resetPreviousMousePosition:S,zoomIn:P,zoomOut:O,setOffsets:R}=l.actions,H=l.reducer},2738:(e,t,n)=>{"use strict";n.d(t,{M:()=>i});var o=n(1990),a=n(1783),s=n(1006);let i=(0,o.U1)({reducer:{canvas:a.Ay,settings:s.Ay}})},4065:(e,t,n)=>{"use strict";async function o(e,t){let n=await e.getFileHandle("settings.json",{create:!0}),o=await n.createWritable();await o.write(JSON.stringify(t,null,2)),await o.close(),console.log("Saved ".concat(t," to settings.json file."))}async function a(e){try{let t=await e.getFileHandle("settings.json",{create:!1}),n=await t.getFile(),o=await n.text();return JSON.parse(o)}catch(e){return console.log("Error in loading the settings.json",e),null}}n.d(t,{D:()=>o,M:()=>a})},6410:(e,t,n)=>{Promise.resolve().then(n.bind(n,345))},7355:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});class o{static move(e,t,n){let o=!0;if([1,2,3,4].forEach(a=>{var s,i;let l=this.giveVertex(e,a);l&&(s=l.x,i=l.y,s+t<0||s+t>1||i+n<0||i+n>1)&&(o=!1)}),o){let o={...e};return o.x1=o.x1+t,o.x2=o.x2+t,o.y1=o.y1+n,o.y2=o.y2+n,o}return e}static moveVertex(e,t,n,o){if(null==o)return;let a={...e};switch(o){case 1:a.x1=t,a.y1=n;break;case 2:a.x2=t,a.y1=n;break;case 3:a.x2=t,a.y2=n;break;case 4:a.x1=t,a.y2=n}return a}static findNearestVertex(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.02,a=new Map([[1,{x:e.x1,y:e.y1}],[2,{x:e.x2,y:e.y1}],[3,{x:e.x2,y:e.y2}],[4,{x:e.x1,y:e.y2}]]),s=null,i=1/0;return a.forEach((e,a)=>{let l=Math.hypot(e.x-t,e.y-n);l<o&&l<i&&(i=l,s=a)}),s}static draw(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[255,0,0],s=t.width,i=t.height,l=t.getContext("2d");if(null==l)return;l.strokeStyle="rgba(".concat(a[0],", ").concat(a[1],", ").concat(a[2],", 1)");let r=e.x1*s,c=e.x2*s,d=e.y1*i,u=e.y2*i;if(l.beginPath(),l.lineWidth=1,l.fillStyle="rgba(".concat(a[0],", ").concat(a[1],", ").concat(a[2],", 0.9)"),l.rect(r-2,d-2,4,4),l.rect(r-2,u-2,4,4),l.rect(c-2,d-2,4,4),l.rect(c-2,u-2,4,4),o){let t=this.giveVertex(e,o);t&&l.rect(t.x*s-5,t.y*i-5,10,10)}l.fill(),l.rect(r,d,c-r,u-d),n?(l.fillStyle="rgba(".concat(a[0],", ").concat(a[1],", ").concat(a[2],", 0.2)"),l.fill()):l.stroke()}static containPoint(e,t,n){let o=Math.min(e.x1,e.x2),a=Math.max(e.x1,e.x2),s=Math.min(e.y1,e.y2),i=Math.max(e.y1,e.y2);return!!(o<t)&&!!(t<a)&&!!(s<n)&&!!(n<i)}static giveVertex(e,t){switch(t){case 1:return{x:e.x1,y:e.y1};case 2:return{x:e.x2,y:e.y1};case 3:return{x:e.x2,y:e.y2};case 4:return{x:e.x1,y:e.y2};default:return null}}static longestDimSize(e){return Math.max(Math.abs(e.y2-e.y1),Math.abs(e.x2-e.x1))}}let a=o},8108:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});class o{static move(e,t,n){return{...e,x:t,y:n}}static isNear(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.02;return Math.hypot(e.x-t,e.y-n)<o}static draw(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[255,0,0],a=t.width,s=t.height,i=e.x*a,l=e.y*s,r=t.getContext("2d");r&&(r.beginPath(),r.fillStyle="rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 0.9)"),r.arc(i,l,3,0,2*Math.PI),r.fill(),n&&(r.beginPath(),r.strokeStyle="rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 0.8)"),r.lineWidth=2,r.arc(i,l,6,0,2*Math.PI),r.stroke()))}}let a=o},9007:(e,t,n)=>{"use strict";n.d(t,{j:()=>a});var o=n(4540);let a=o.wA.withTypes();o.d4.withTypes()}},e=>{var t=t=>e(e.s=t);e.O(0,[635,299,441,684,358],()=>t(6410)),_N_E=e.O()}]);