(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[407],{4065:(e,t,n)=>{"use strict";async function o(e,t){let n=await e.getFileHandle("settings.json",{create:!0}),o=await n.createWritable();await o.write(JSON.stringify(t,null,2)),await o.close(),console.log("Saved ".concat(t," to settings.json file."))}async function a(e){try{let t=await e.getFileHandle("settings.json",{create:!1}),n=await t.getFile(),o=await n.text();return JSON.parse(o)}catch(e){return console.log("Error in loading the settings.json",e),null}}n.d(t,{D:()=>o,M:()=>a})},5031:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>U});var o=n(5155),a=n(2115);function s(e){var t,n;let{cards:a,onSelect:s,handlePrevious:i,handleNext:l,imagesLen:c}=e,r=null!==(n=null===(t=a[2])||void 0===t?void 0:t[0])&&void 0!==n?n:0;return(0,o.jsxs)("aside",{className:"w-full md:w-64 p-4 bg-zinc-900 border-r border-zinc-700 overflow-y-auto h-[90vh] max-h-screen shadow-inner flex flex-col gap-4 text-zinc-100",children:[(0,o.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,o.jsxs)("div",{className:"flex justify-between items-center",children:[(0,o.jsx)("button",{onClick:i,disabled:0===r,className:"px-3 py-1 text-sm font-medium rounded border transition duration-150 ".concat(0===r?"bg-zinc-700 text-zinc-500 border-zinc-600 cursor-not-allowed":"bg-zinc-800 hover:bg-zinc-700 text-blue-400 border-blue-500"),children:"← Previous"}),(0,o.jsx)("button",{onClick:l,disabled:r===c-1,className:"px-3 py-1 text-sm font-medium rounded border transition duration-150 ".concat(r===c-1?"bg-zinc-700 text-zinc-500 border-zinc-600 cursor-not-allowed":"bg-zinc-800 hover:bg-zinc-700 text-blue-400 border-blue-500"),children:"Next →"})]}),(0,o.jsxs)("div",{className:"text-center text-xs text-zinc-400",children:["Image ",(0,o.jsx)("span",{className:"font-semibold text-zinc-100",children:r+1})," of"," ",(0,o.jsx)("span",{className:"font-semibold text-zinc-100",children:c})]})]}),(0,o.jsx)("div",{className:"grid grid-cols-1 gap-3 justify-items-center",children:a.map((e,t)=>{let[n,a]=e;return a?(0,o.jsx)("img",{src:a,alt:"Image ".concat(n),onClick:()=>s(t),className:"object-cover cursor-pointer rounded-md border transition-all duration-200 ".concat(2===t?"w-48 h-32 border-blue-500 shadow-lg opacity-100":"w-40 h-28 border-zinc-600 opacity-60 hover:opacity-90 hover:border-blue-400")},t):(0,o.jsx)("div",{className:"w-40 h-28 bg-zinc-700 text-zinc-400 flex items-center justify-center rounded-md",children:"Empty"},t)})})]})}function i(e){let t=e.currentTarget.getBoundingClientRect(),n=e.currentTarget.width,o=e.currentTarget.height;return{x:(e.clientX-t.left)/n,y:(e.clientY-t.top)/o}}function l(e){return{x:e.clientX,y:e.clientY}}var c=n(1783);let r={bbox:"rectClasses",keypoint:"pointClasses",line:"lineClasses",obb:"obbClasses",polygon:"polygonClasses"};var d=n(7355),u=n(2335);function b(e,t,n,o){if("wheel"===e.type&&(e.deltaY>0?o((0,c.nF)()):e.deltaY<0&&o((0,c.ke)())),"keydown"===e.type||"keyup"===e.type){var a,s,b,x;a=e,s=0,b=0,x=o,"keydown"===a.type&&(a.ctrlKey&&"key"in a&&"z"===a.key&&x((0,c.U_)()),a.ctrlKey&&"key"in a&&"y"===a.key&&x((0,c.Kg)()));return}if("mousemove"===e.type||"mousedown"===e.type||"mouseup"===e.type)switch(t.selectedTool){case"SELECT":!function(e,t,n,o){switch(e.type){case"mousedown":if(0==e.button){if(-1!=t.hoveringAnnotation){let e=t.annotations[t.hoveringAnnotation].object.class_id;switch(t.annotations[t.hoveringAnnotation].object.type){case"bbox":o((0,c._y)("EDIT_RECT")),o((0,c.v0)(e)),o((0,c.vJ)(!0));break;case"keypoint":o((0,c._y)("EDIT_POINT")),o((0,c.v0)(e)),o((0,c.vJ)(!0));break;case"obb":o((0,c._y)("EDIT_OBB")),o((0,c.v0)(e)),o((0,c.vJ)(!0))}o((0,c.M)())}else{let t=l(e);o((0,c.QA)(t))}}else if(2==e.button){let e=t.selectedClassID,a=Math.max(...Object.keys(t.annotations).map(Number));o(n[r[t.annotations[a].object.type]][e+1]?(0,c.v0)(e+1):(0,c.v0)(0))}break;case"mouseup":t.previousMousePosition&&o((0,c.Rx)());break;case"mousemove":let a=i(e),s=t.previousMousePosition;if(s){let n=l(e),a={...t.offsets};a.x=a.x+(n.x-s.x),a.y=a.y+(n.y-s.y),o((0,c.nT)(a)),o((0,c.QA)(n))}o((0,c.xJ)(a)),o((0,c.cr)(a))}}(e,t,n,o);break;case"DRAW_RECT":!function(e,t,n,o){switch(e.type){case"mousedown":if(0==e.button){let n=i(e);o((0,c.rY)({classID:t.selectedClassID,mousePosition:n})),o((0,c.Bj)(!0))}else if(2==e.button){let e=n.bbox,a=t.selectedClassID;o(e[a+1]?(0,c.v0)(a+1):(0,c.v0)(0))}break;case"mouseup":0==e.button&&(o((0,c.Mu)()),o((0,c.Bj)(!1)));break;case"mousemove":if(t.isDrawing){let t=i(e);o((0,c.OE)(t))}}}(e,t,n,o);break;case"DRAW_POINT":!function(e,t,n,o){if("mousedown"===e.type){if(0==e.button){let n=i(e);o((0,c.DE)({classID:t.selectedClassID,mousePosition:n})),o((0,c.Mu)())}else if(2==e.button){let e=n.keypoint,a=t.selectedClassID;o(e[a+1]?(0,c.v0)(a+1):(0,c.v0)(0)),o((0,c.Mu)())}}}(e,t,n,o);break;case"DRAW_OBB":!function(e,t,n,o){switch(e.type){case"mousedown":if(0==e.button){let n=i(e);o((0,c.sY)({classID:t.selectedClassID,mousePosition:n})),o((0,c.Bj)(!0))}else if(2==e.button){let e=n.obb,a=t.selectedClassID;o(e[a+1]?(0,c.v0)(a+1):(0,c.v0)(0))}break;case"mouseup":0==e.button&&(o((0,c.Mu)()),o((0,c.Bj)(!1)));break;case"mousemove":if(t.isDrawing){let t=i(e);o((0,c.pd)(t))}}}(e,t,n,o);break;case"EDIT_RECT":!function(e,t,n,o){switch(e.type){case"mousedown":if(0==e.button){if(-1!=t.hoveringVertex)o((0,c.fw)());else if(o((0,c.Bb)()),-1!=t.hoveringAnnotation){if(t.selectedAnnotation==t.hoveringAnnotation&&"bbox"==t.annotations[t.selectedAnnotation].object.type){o((0,c.vJ)(!0));let t=i(e);o((0,c.QA)(t))}else{let e=t.annotations[t.hoveringAnnotation].object.class_id;switch(t.annotations[t.hoveringAnnotation].object.type){case"bbox":o((0,c._y)("EDIT_RECT")),o((0,c.v0)(e));break;case"keypoint":o((0,c._y)("EDIT_POINT")),o((0,c.v0)(e));break;case"obb":o((0,c._y)("EDIT_OBB")),o((0,c.v0)(e))}o((0,c.M)())}}else o((0,c._y)("SELECT")),o((0,c.aA)()),o((0,c.Bb)())}else if(2==e.button){let e=n.bbox,a=t.selectedAnnotation,s=t.annotations[a].object,i=s.class_id;if(e[i+1]){let e={...s,class_id:i+1};o((0,c.rJ)({updatedAnnotation:e,Index:a})),o((0,c.v0)(i+1))}else{let e={...s,class_id:0};o((0,c.rJ)({updatedAnnotation:e,Index:a})),o((0,c.v0)(0))}o((0,c.Mu)())}break;case"mouseup":0==e.button&&(-1!=t.selectedVertex&&(o((0,c.Mu)()),o((0,c.Bb)())),t.isEditing&&(o((0,c.vJ)(!1)),o((0,c.Rx)()),o((0,c.Mu)())));break;case"mousemove":let a=i(e);if(t.isEditing&&t.previousMousePosition){let e=a.x-t.previousMousePosition.x,n=a.y-t.previousMousePosition.y,s=t.annotations[t.selectedAnnotation].object,i=d.A.move(s,e,n);o((0,c.rJ)({updatedAnnotation:i,Index:t.selectedAnnotation})),o((0,c.QA)(a))}o((0,c.xJ)(a)),o((0,c.cr)(a)),-1!=t.selectedVertex&&o((0,c.cE)(a))}}(e,t,n,o);break;case"EDIT_POINT":!function(e,t,n,o){switch(e.type){case"mousedown":if(0==e.button){if(-1!=t.hoveringAnnotation){let e=t.annotations[t.hoveringAnnotation].object.class_id;switch(t.annotations[t.hoveringAnnotation].object.type){case"bbox":o((0,c._y)("EDIT_RECT")),o((0,c.v0)(e)),o((0,c.vJ)(!0));break;case"keypoint":o((0,c._y)("EDIT_POINT")),o((0,c.v0)(e)),o((0,c.vJ)(!0));break;case"obb":o((0,c._y)("EDIT_OBB")),o((0,c.v0)(e)),o((0,c.vJ)(!0))}o((0,c.M)())}else o((0,c._y)("SELECT")),o((0,c.vJ)(!1)),o((0,c.aA)()),o((0,c.Bb)())}else if(2==e.button){let e=n.keypoint,a=t.selectedAnnotation,s=t.annotations[a].object,i=s.class_id;if(e[i+1]){let e={...s,class_id:i+1};o((0,c.rJ)({updatedAnnotation:e,Index:a})),o((0,c.v0)(i+1))}else{let e={...s,class_id:0};o((0,c.rJ)({updatedAnnotation:e,Index:a})),o((0,c.v0)(0))}o((0,c.Mu)())}break;case"mouseup":0==e.button&&-1!=t.selectedAnnotation&&(o((0,c.Mu)()),o((0,c.vJ)(!1)));break;case"mousemove":let a=i(e);o((0,c.xJ)(a)),t.isEditing&&o((0,c.B)(a))}}(e,t,n,o);break;case"EDIT_OBB":!function(e,t,n,o){switch(e.type){case"mousedown":if(0==e.button){if(-1!=t.hoveringVertex)o((0,c.fw)());else if(t.isHoveringHandle)o((0,c.Hv)(!0)),o((0,c.vJ)(!0));else if(o((0,c.Bb)()),-1!=t.hoveringAnnotation){if(t.selectedAnnotation==t.hoveringAnnotation&&"obb"==t.annotations[t.selectedAnnotation].object.type){o((0,c.vJ)(!0));let t=i(e);o((0,c.QA)(t)),console.log("start moving")}else{let e=t.annotations[t.hoveringAnnotation].object.class_id;switch(t.annotations[t.hoveringAnnotation].object.type){case"bbox":o((0,c._y)("EDIT_RECT")),o((0,c.v0)(e));break;case"keypoint":o((0,c._y)("EDIT_POINT")),o((0,c.v0)(e));break;case"obb":o((0,c._y)("EDIT_OBB")),o((0,c.v0)(e))}o((0,c.M)())}}else o((0,c._y)("SELECT")),o((0,c.aA)()),o((0,c.Bb)())}else if(2==e.button){let e=n.obb,a=t.selectedAnnotation,s=t.annotations[a].object,i=s.class_id;if(e[i+1]){let e={...s,class_id:i+1};o((0,c.rJ)({updatedAnnotation:e,Index:a})),o((0,c.v0)(i+1))}else{let e={...s,class_id:0};o((0,c.rJ)({updatedAnnotation:e,Index:a})),o((0,c.v0)(0))}o((0,c.Mu)())}break;case"mouseup":0==e.button&&(-1!=t.selectedVertex&&(o((0,c.Mu)()),o((0,c.Bb)())),t.isEditing&&(o((0,c.vJ)(!1)),o((0,c.Rx)()),o((0,c.Mu)()),o((0,c.Hv)(!1))));break;case"mousemove":let a=i(e);if(t.isEditing&&t.previousMousePosition){let e=a.x-t.previousMousePosition.x,n=a.y-t.previousMousePosition.y,s=t.annotations[t.selectedAnnotation].object,i=u.A.move(s,e,n);o((0,c.rJ)({updatedAnnotation:i,Index:t.selectedAnnotation})),o((0,c.QA)(a))}if(t.isEditing&&t.isHandleSelected){let e=t.annotations[t.selectedAnnotation].object,n=a.x-e.xc,s=Math.atan2(a.y-e.yc,n),i={...e,alpha:s};o((0,c.rJ)({updatedAnnotation:i,Index:t.selectedAnnotation}))}o((0,c.xJ)(a)),o((0,c.cr)(a)),o((0,c.CO)(a)),-1!=t.selectedVertex&&o((0,c.cE)(a))}}(e,t,n,o)}}var x=n(8108),h=n(9007),m=n(4540);function f(e){let{imageSrc:t}=e,n=(0,a.useRef)(null),s=(0,h.j)(),i=(0,m.d4)(e=>e.canvas),l=(0,m.d4)(e=>e.canvas.zoom),r=(0,m.d4)(e=>e.settings);return(0,a.useEffect)(()=>{if(!t||!n.current)return;let e=new Image;e.src=t;let o=()=>{let t=Math.max(e.width,e.height)/l,n=e.width/t,o=e.height/t;s((0,c.C5)({width:n,height:o}))};return e.addEventListener("load",o),()=>{e.removeEventListener("load",o)}},[l,t]),(0,a.useEffect)(()=>{t&&n.current&&!function(e,t,n,o){let a=new Image;a.src=t,e.width=n.width,e.height=n.height;let s=e.getContext("2d");s.clearRect(0,0,e.width,e.height),s.drawImage(a,0,0,e.width,e.height);let i=null;for(let[t,a]of Object.entries(n.annotations)){let s=Number(t),l=a.object,c=null;if(l)switch(i=s===n.selectedAnnotation?n.hoveringVertex:null,c=o[l.type][a.object.class_id].color,l.type){case"bbox":"DRAW_RECT"==n.selectedTool||"SELECT"==n.selectedTool?d.A.draw(l,e,s===n.selectedAnnotation,null,c):d.A.draw(l,e,s===n.hoveringAnnotation||s===n.selectedAnnotation,i,c);break;case"keypoint":"DRAW_POINT"==n.selectedTool||"SELECT"==n.selectedTool?x.A.draw(l,e,s===n.selectedAnnotation,c):x.A.draw(l,e,s===n.hoveringAnnotation||s===n.selectedAnnotation,c);break;case"obb":"DRAW_OBB"==n.selectedTool||"SELECT"==n.selectedTool?u.A.draw(l,e,s===n.selectedAnnotation,null,!1,c):u.A.draw(l,e,s===n.hoveringAnnotation||s===n.selectedAnnotation,i,s===n.selectedAnnotation&&(n.isHandleSelected||n.isHoveringHandle),c)}}}(n.current,t,i,r)},[t,i]),(0,o.jsx)("div",{className:"flex justify-center items-center w-full h-full bg-zinc-950",children:(0,o.jsx)("canvas",{ref:n,onMouseDown:e=>{b(e,i,r,s)},onMouseMove:e=>{b(e,i,r,s)},onMouseUp:e=>{b(e,i,r,s)},onKeyDown:e=>{b(e,i,r,s)},onContextMenu:e=>{e.preventDefault()},onWheel:e=>{b(e,i,r,s)},tabIndex:0,className:"outline-none border border-zinc-700 shadow-md bg-zinc-900 focus:ring-1 focus:ring-blue-500 ",style:{transform:"translate(".concat(i.offsets.x,"px, ").concat(i.offsets.y,"px)")}})})}function p(){var e;let t=(0,h.j)(),n=(0,m.d4)(e=>e.canvas.selectedAnnotation,m.bN),s=(0,m.d4)(e=>e.canvas.annotationsHistory,m.bN),i=(0,m.d4)(e=>e.canvas.historyIndex,m.bN),l=(0,m.d4)(e=>e.settings,m.bN),r=s[i].annotations,d=(0,a.useMemo)(()=>Object.entries(r),[r]),u=-1!==n?null===(e=r[n])||void 0===e?void 0:e.object:null,[b,x]=(0,a.useState)(u?{...u}:null);(0,a.useEffect)(()=>{u&&x({...u})},[u]);let f=e=>{t((0,c.xh)(e)),u&&x({...u})},p=(e,t)=>{b&&x({...b,[e]:t})};return(0,o.jsxs)("div",{className:"w-full h-full bg-zinc-900 border-l border-zinc-700 text-zinc-100 flex flex-col",children:[(0,o.jsxs)("div",{className:"flex flex-col border-b border-zinc-700 flex-grow min-h-0",children:[(0,o.jsxs)("div",{className:"bg-zinc-800 px-4 py-2 text-sm font-medium text-zinc-200",children:["Annotations (",d.length,")"]}),(0,o.jsx)("div",{className:"overflow-y-auto flex-grow divide-y divide-zinc-700",children:0===d.length?(0,o.jsx)("p",{className:"p-3 text-sm text-zinc-500",children:"No annotations yet."}):d.map(e=>{let[a]=e,s=Number(a),i=s===n;return(0,o.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 text-sm cursor-pointer ".concat(i?"bg-zinc-800 border-l-4 border-blue-500":"hover:bg-zinc-800"),onClick:()=>f(s),children:[(0,o.jsxs)("span",{className:"text-zinc-300 font-medium",children:["#",s]}),(0,o.jsx)("button",{onClick:e=>{e.stopPropagation(),t((0,c.O8)(s)),t((0,c.Mu)()),s===n&&(t((0,c.xh)(-1)),x(null))},className:"text-red-400 hover:underline text-xs",children:"Remove"})]},a)})})]}),(0,o.jsxs)("div",{className:"border-t border-zinc-700 ",children:[(0,o.jsx)("div",{className:"bg-zinc-800 px-4 py-2 text-sm font-medium text-zinc-200",children:u?"Selected Annotation #".concat(n):"No annotation selected"}),u&&b&&(0,o.jsxs)("div",{className:"p-4 flex flex-col gap-2 text-xs bg-zinc-900",children:[Object.keys(b).map(e=>(0,o.jsxs)("label",{className:"flex justify-between items-center gap-2",children:[(0,o.jsx)("span",{className:"text-zinc-400",children:e}),"type"==e?(0,o.jsx)("span",{className:"bg-zinc-800 text-zinc-100 px-2 py-1 text-left w-24 ",children:b.type}):(0,o.jsx)("input",{type:"number",value:b[e],onChange:t=>p(e,parseFloat(t.target.value)),className:"bg-zinc-800 text-zinc-100 px-2 py-1 text-left w-24 border border-zinc-600 focus:outline-none focus:ring focus:ring-blue-500"})]},e)),(0,o.jsx)("button",{onClick:()=>{null!==n&&b&&l[b.type][b.class_id]&&(t((0,c.rJ)({updatedAnnotation:b,Index:n})),t((0,c.v0)(b.class_id)),t((0,c.Mu)()))},className:"mt-2 w-full py-1 bg-blue-600 text-white hover:bg-blue-700 transition",children:"Save Changes"})]})]})]})}var v=n(1006);let g=["bbox","keypoint","polygon","line","obb"],y=()=>[Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random())],w=e=>{let{color:t=[255,255,255]}=e;return(0,o.jsx)("div",{className:"w-5 h-5 rounded shadow-sm",style:{backgroundColor:"rgb(".concat(t[0],", ").concat(t[1],", ").concat(t[2],")")}})},j=e=>{let{isOpen:t,onClose:n,settings:s}=e,i=(0,h.j)(),[l,c]=(0,a.useState)("bbox"),[r,d]=(0,a.useState)(""),[u,b]=(0,a.useState)(y()),[x,m]=(0,a.useState)(Object.keys(s.bbox).length),[f,p]=(0,a.useState)("");if(!t)return null;let j=()=>s["".concat(l)]||{},z=e=>{i(({bbox:v.QH,keypoint:v.Ih,polygon:v.GI,line:v.k5,obb:v.LT})[l](e))},N=j();return(0,o.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex justify-center items-center z-50",children:(0,o.jsx)("div",{className:"bg-zinc-900 p-6 rounded-xl shadow-2xl w-full max-w-xl border border-zinc-700",children:(0,o.jsxs)("div",{className:"text-zinc-100",children:[(0,o.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Annotation Class Settings"}),(0,o.jsx)("div",{className:"flex space-x-2 mb-4",children:g.map(e=>(0,o.jsx)("button",{onClick:()=>{c(e),m(Object.keys(s["".concat(e)]).length),p("")},className:"px-3 py-1 rounded-md transition ".concat(l===e?"bg-blue-600 text-white":"bg-zinc-700 text-zinc-300"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),f&&(0,o.jsx)("p",{className:"text-red-400 mb-2",children:f}),(0,o.jsxs)("div",{className:"mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[(0,o.jsxs)("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[(0,o.jsx)("input",{type:"text",value:r,onChange:e=>d(e.target.value),placeholder:"Class Name",className:"bg-zinc-800 text-white border border-zinc-600 p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,o.jsx)("input",{type:"color",value:"#".concat(u.map(e=>e.toString(16).padStart(2,"0")).join("")),onChange:e=>{b(e.target.value.slice(1).match(/.{1,2}/g).map(e=>parseInt(e,16)))},onClick:()=>b(y()),className:"cursor-pointer border border-zinc-600 rounded-md w-10 h-10"})]}),(0,o.jsx)("button",{onClick:()=>{if(""===r.trim()){p("Class name cannot be empty.");return}let e=j(),t=Object.values(e).some(e=>e.name===r),n=Object.values(e).some(e=>e.color[0]===u[0]&&e.color[1]===u[1]&&e.color[2]===u[2]);if(t){p("Class name already exists.");return}if(n){p("Class color already exists.");return}i(({bbox:v.Q6,keypoint:v.y5,polygon:v._h,line:v.K9,obb:v.Zv})[l]({id:x,attrs:{name:r,color:u}})),d(""),b(y()),m(x+1),p("")},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition",children:"Add Class"})]}),(0,o.jsx)("div",{className:"overflow-y-auto max-h-72 border-t border-zinc-700 pt-4",children:(0,o.jsx)("ul",{className:"space-y-3",children:Object.entries(N).map(e=>{let[t,{name:n,color:a}]=e;return(0,o.jsxs)("li",{className:"flex items-center justify-between gap-3 text-sm bg-zinc-800 p-2 rounded-md shadow-sm",children:[(0,o.jsxs)("div",{className:"flex items-center gap-3",children:[(0,o.jsx)(w,{color:a}),(0,o.jsxs)("span",{className:"text-zinc-400",children:["#",t]}),(0,o.jsx)("span",{className:"text-zinc-100",children:n})]}),(0,o.jsx)("button",{onClick:()=>z(Number(t)),className:"bg-red-600 hover:bg-red-700 text-white py-1 px-3 rounded-md transition",children:"Remove"})]},t)})})}),(0,o.jsx)("button",{className:"mt-6 w-full bg-zinc-700 hover:bg-zinc-600 text-white py-2 rounded-md transition",onClick:n,children:"Close"})]})})})};function z(e){let{onLoadImages:t,onSync:n,onSettings:a,onExport:s}=e;return(0,o.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,o.jsx)("button",{onClick:a,className:"bg-zinc-800 text-zinc-100 px-4 py-2 rounded-md border border-zinc-600 hover:bg-zinc-700 hover:border-blue-500 transition",children:"⚙️ Settings"}),(0,o.jsx)("button",{onClick:t,className:"bg-zinc-800 text-zinc-100 px-4 py-2 rounded-md border border-zinc-600 hover:bg-zinc-700 hover:border-blue-500 transition",children:"\uD83D\uDCC1 Load Images"}),(0,o.jsx)("button",{onClick:n,className:"bg-zinc-800 text-zinc-100 px-4 py-2 rounded-md border border-zinc-600 hover:bg-zinc-700 hover:border-blue-500 transition",children:"\uD83D\uDD04 Sync Images"}),(0,o.jsx)("button",{onClick:s,className:"bg-zinc-800 text-zinc-100 px-4 py-2 rounded-md border border-zinc-600 hover:bg-zinc-700 hover:border-blue-500 transition",children:"\uD83D\uDCBE Export YOLO"})]})}var N=n(4383),k=n(5373),A=n(2738),E=n(4065);async function C(e){let t=await e.getDirectoryHandle("yolo",{create:!0}),n=await e.getDirectoryHandle("annotations");if(n&&t)for await(let[e]of n.entries()){let o=await n.getFileHandle(e),a=await o.getFile(),s=JSON.parse(await a.text()).annotations,i=await t.getFileHandle(function(e){let t=e.lastIndexOf(".");return -1===t?"".concat(e,".txt"):"".concat(e.substring(0,t),".txt")}(e),{create:!0}),l=await i.createWritable(),c=[];s.forEach(e=>{if("bbox"==e.type){let t=(e.x1+e.x2)*.5,n=(e.y1+e.y2)*.5,o=Math.abs(e.x2-e.x1),a=Math.abs(e.y2-e.y1);c.push("".concat(e.class_id," ").concat(t," ").concat(n," ").concat(o," ").concat(a))}}),await l.write(c.join("\n")+"\n"),await l.close()}}let _=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),T=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),D=e=>{let t=T(e);return t.charAt(0).toUpperCase()+t.slice(1)},I=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>!!e&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()},M=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var O={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let S=(0,a.forwardRef)((e,t)=>{let{color:n="currentColor",size:o=24,strokeWidth:s=2,absoluteStrokeWidth:i,className:l="",children:c,iconNode:r,...d}=e;return(0,a.createElement)("svg",{ref:t,...O,width:o,height:o,stroke:n,strokeWidth:i?24*Number(s)/Number(o):s,className:I("lucide",l),...!c&&!M(d)&&{"aria-hidden":"true"},...d},[...r.map(e=>{let[t,n]=e;return(0,a.createElement)(t,n)}),...Array.isArray(c)?c:[c]])}),R=(e,t)=>{let n=(0,a.forwardRef)((n,o)=>{let{className:s,...i}=n;return(0,a.createElement)(S,{ref:o,iconNode:t,className:I("lucide-".concat(_(D(e))),"lucide-".concat(e),s),...i})});return n.displayName=D(e),n},B=R("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),J=R("circle-dot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]),P=R("diamond",[["path",{d:"M2.7 10.3a2.41 2.41 0 0 0 0 3.41l7.59 7.59a2.41 2.41 0 0 0 3.41 0l7.59-7.59a2.41 2.41 0 0 0 0-3.41l-7.59-7.59a2.41 2.41 0 0 0-3.41 0Z",key:"1f1r0c"}]]),L=R("move",[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]]),W=R("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),H=R("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),F=[{id:"DRAW_RECT",icon:(0,o.jsx)(B,{size:16})},{id:"DRAW_POINT",icon:(0,o.jsx)(J,{size:16})},{id:"DRAW_OBB",icon:(0,o.jsx)(P,{size:16})}];function Q(){var e;let t=(0,h.j)(),n=(0,m.d4)(e=>e.canvas.selectedTool),[s,i]=(0,a.useState)("DRAW_RECT"),[l,r]=(0,a.useState)(!1),d=e=>{t((0,c._y)(e)),t((0,c.aA)()),t((0,c.Bb)())},u=e=>{i(e),d(e),r(!1)},b="EDIT_RECT"===n||"EDIT_POINT"===n||"EDIT_OBB"===n;return(0,o.jsxs)("div",{className:"absolute top-4 left-4 z-20 flex gap-2",children:[(0,o.jsx)("button",{title:"Select",onClick:()=>d("SELECT"),className:"w-10 h-10 flex items-center justify-center shadow border border-zinc-600 transition\n          ".concat("SELECT"===n?"bg-blue-600/80 text-white":"bg-zinc-800/80 text-zinc-300 hover:bg-zinc-700/80"),children:(0,o.jsx)(L,{size:18})},"SELECT"),(0,o.jsx)("button",{title:"Edit",onClick:()=>d("EDIT_RECT"),className:"w-10 h-10 flex items-center justify-center shadow border border-zinc-600 transition\n          ".concat(b?"bg-blue-600/80 text-white":"bg-zinc-800/80 text-zinc-300 hover:bg-zinc-700/80"),children:(0,o.jsx)(W,{size:18})},"EDIT_RECT"),(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("button",{onClick:()=>{d(s),r(e=>!e)},title:"Draw Tool",className:"w-10 h-10 flex items-center justify-center shadow border border-zinc-600 transition\n            ".concat(n.startsWith("DRAW")?"bg-blue-600/80 text-white":"bg-zinc-800/80 text-zinc-300 hover:bg-zinc-700/80"),children:(null===(e=F.find(e=>e.id===s))||void 0===e?void 0:e.icon)||(0,o.jsx)(H,{size:18})}),l&&(0,o.jsx)("div",{onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),className:"absolute top-12 left-0 w-10 bg-zinc-800 border border-zinc-600 shadow z-30",children:F.map(e=>{let{id:t,icon:n}=e;return(0,o.jsx)("button",{onClick:()=>u(t),className:"w-full h-9 flex items-center gap-2 px-3 py-2 text-sm text-zinc-300 hover:bg-zinc-700",children:n},t)})})]})]})}let K=e=>{let{name:t="default",color:n=[255,255,255]}=e;return(0,o.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,o.jsx)("div",{className:"w-10 h-4 shadow-sm rounded",style:{backgroundColor:"rgb(".concat(n[0],", ").concat(n[1],", ").concat(n[2],")")}}),(0,o.jsx)("span",{children:t})]})},V={DRAW_RECT:"bbox",DRAW_POINT:"keypoint",DRAW_OBB:"obb",EDIT_RECT:"bbox",EDIT_POINT:"keypoint",EDIT_OBB:"obb",SELECT:""};function Y(){var e,t;let n=(0,h.j)(),s=(0,m.d4)(e=>e.canvas.selectedClassID),i=(0,m.d4)(e=>e.canvas.selectedTool),l=(0,m.d4)(e=>e.settings),[r,d]=(0,a.useState)(!1),[u,b]=(0,a.useState)("bbox");(0,a.useEffect)(()=>{if("SELECT"!=i){let e=V[i];u!=e&&b(e),("DRAW_RECT"==i||"DRAW_POINT"==i||"DRAW_OBB"==i)&&n((0,c.v0)(0))}},[i]);let x=l[u],f=null===(e=x[s])||void 0===e?void 0:e.name,p=null===(t=x[s])||void 0===t?void 0:t.color;return(0,o.jsxs)("div",{className:"absolute top-18 left-4 z-20 flex gap-2",onClick:()=>d(!r),children:[(0,o.jsx)(K,{name:f,color:p}),(0,o.jsx)("div",{className:"absolute top-8 z-20 flex-col",children:r&&Object.values(x).map((e,t)=>(0,o.jsx)("button",{className:"gap-2 flex-col flex ".concat(t==s?"opacity-100":"opacity-50"),onClick:()=>n((0,c.v0)(t)),children:(0,o.jsx)(K,{name:e.name,color:e.color})},t))})]})}function U(){let e=(0,h.j)(),t=(0,m.d4)(e=>e.settings),{db:n,imagesDirHandle:i,rootDirHandle:l,annotationsDirHandle:r}=(0,k.B)(),d=[null,null,null],[u,b]=(0,a.useState)([d,d,d,d,d]),[x,v]=(0,a.useState)(0),[g,y]=(0,a.useState)(!1),[w,_]=(0,a.useState)(0),T=()=>{y(!g),l&&(0,E.D)(l,t)};function D(e){let t=e.lastIndexOf(".");return -1===t?"".concat(e,".json"):"".concat(e.substring(0,t),".json")}async function I(){if(!r||!u[2][1])return;let e=u[2][2];if(!e)return;let t=D(e.name),n=[],o=A.M.getState(),a=o.canvas.annotations,s=o.canvas.lastIndex;for(let e=0;e<s;e++){if(void 0==a[e])continue;let t=a[e].object;n.push(t)}try{let e=await r.getFileHandle(t,{create:!0}),o=await e.createWritable();await o.write(JSON.stringify({name:t,annotations:n,labels:[]},null,2)),await o.close()}catch(e){console.error("Error saving annotations:",e)}}async function M(t){let n=t[2];if(null==n||null==r)return;let o=D(n.name);try{let t=await r.getFileHandle(o),n=await t.getFile(),a=await n.text(),s=JSON.parse(a);e((0,c.HD)(s.annotations))}catch(t){console.warn('Annotation file "'.concat(o,'" could not load. error: "').concat(t,'"')),e((0,c.HD)([])),e((0,c.eU)())}}async function O(){if(!n)return;let e=await (0,N.AK)(n);v(e),await B(0,e,n,i,0)}async function S(){i&&l&&n&&(await (0,N.kP)(i,n),await (0,N.wZ)(n,l),v(await (0,N.AK)(n)))}async function R(){try{l&&await C(l)}catch(e){console.log("Error in exporting annotation to yolo format, error: ",e)}}async function B(t,n,o,a,s){if(!o||!a)return;let i=s+t;if(i<0||i>=n)return;let l=Math.floor(2.5),r=Math.max(0,i-l),u=Math.min(n,i+l+1)-r,x=Math.max(0,l-i),h=await (0,N.kg)(a,o,r,u);if(!h)return;let m=[...Array(x).fill(d),...h,...Array(5-u-x).fill(d)];b(m),e((0,c.nj)()),await M(m[2]),_(i)}async function J(){await I(),await B(-1,x,n,i,w)}async function P(){await I(),await B(1,x,n,i,w)}async function L(e){let t=Math.floor(2.5);await I(),await B(e-t,x,n,i,w)}return(0,a.useEffect)(()=>{try{O()}catch(e){console.log("error in loading images. error:",e)}},[]),(0,o.jsxs)("div",{className:"flex flex-col h-screen bg-zinc-950 text-zinc-100 h-full",children:[(0,o.jsx)("header",{className:"bg-zinc-900 border-b border-zinc-700 px-4 py-3 shadow-md",children:(0,o.jsx)(z,{onLoadImages:O,onSync:S,onSettings:T,onExport:R})}),(0,o.jsxs)("div",{className:"flex flex-row flex-grow overflow-hidden h-full",children:[(0,o.jsx)("aside",{className:"bg-zinc-900 border-r border-zinc-700 w-full h-full md:w-64 overflow-y-auto",children:(0,o.jsx)(s,{cards:u,onSelect:L,handlePrevious:J,handleNext:P,imagesLen:x})}),(0,o.jsxs)("main",{className:"flex-1 relative items-start h-full w-full bg-zinc-950 overflow-hidden",children:[(0,o.jsx)(Q,{}),(0,o.jsx)(Y,{}),(0,o.jsx)("div",{className:"flex w-full h-full items-center justify-center",children:(0,o.jsx)(f,{imageSrc:u[2][1]})})]}),(0,o.jsx)("aside",{className:"h-full w-full md:w-64 bg-zinc-900 border-l border-zinc-700",children:(0,o.jsx)(p,{})}),(0,o.jsx)(j,{isOpen:g,onClose:T,settings:t})]})]})}},6410:(e,t,n)=>{Promise.resolve().then(n.bind(n,5031))},9007:(e,t,n)=>{"use strict";n.d(t,{j:()=>a});var o=n(4540);let a=o.wA.withTypes();o.d4.withTypes()}},e=>{var t=t=>e(e.s=t);e.O(0,[635,299,738,441,684,358],()=>t(6410)),_N_E=e.O()}]);