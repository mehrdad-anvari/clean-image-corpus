(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{347:()=>{},881:(e,t,a)=>{"use strict";a.d(t,{Providers:()=>l});var n=a(5155),o=a(4540),s=a(2738);function l(e){let{children:t}=e;return(0,n.jsxs)(o.Kq,{store:s.M,children:[" ",t," "]})}},1006:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>p,GI:()=>i,Ih:()=>d,K9:()=>c,LT:()=>h,Q6:()=>o,QH:()=>s,Zv:()=>x,_h:()=>l,k5:()=>y,oc:()=>b,y5:()=>r});let n=(0,a(1990).Z0)({name:"annotationSettings",initialState:{rectClasses:{0:{name:"default",color:[255,255,255]}},pointClasses:{0:{name:"default",color:[255,255,255]}},polygonClasses:{0:{name:"default",color:[255,255,255]}},lineClasses:{0:{name:"default",color:[255,255,255]}},obbClasses:{0:{name:"default",color:[255,255,255]}},rectMinEdgeSize:.02},reducers:{addRectClass:(e,t)=>{e.rectClasses[t.payload.id]=t.payload.attrs},addPointClass:(e,t)=>{e.pointClasses[t.payload.id]=t.payload.attrs},addPolygonClass:(e,t)=>{e.polygonClasses[t.payload.id]=t.payload.attrs},addLineClass:(e,t)=>{e.lineClasses[t.payload.id]=t.payload.attrs},addObbClass:(e,t)=>{e.obbClasses[t.payload.id]=t.payload.attrs},deleteRectClass:(e,t)=>{delete e.rectClasses[t.payload]},deletePointClass:(e,t)=>{delete e.pointClasses[t.payload]},deletePolygonClass:(e,t)=>{delete e.polygonClasses[t.payload]},deleteLineClass:(e,t)=>{delete e.lineClasses[t.payload]},deleteObbClass:(e,t)=>{delete e.obbClasses[t.payload]},setSettings:(e,t)=>({...e,...t.payload})}}),{addRectClass:o,deleteRectClass:s,addPolygonClass:l,deletePolygonClass:i,addPointClass:r,deletePointClass:d,addLineClass:c,deleteLineClass:y,addObbClass:x,deleteObbClass:h,setSettings:b}=n.actions,p=n.reducer},1783:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>E,B:()=>H,Bb:()=>I,Bj:()=>j,C5:()=>C,DE:()=>V,HD:()=>P,Kg:()=>h,M:()=>b,Mu:()=>A,O8:()=>_,OE:()=>d,U_:()=>x,_y:()=>u,aA:()=>m,cE:()=>g,cr:()=>y,eU:()=>w,fw:()=>p,nj:()=>v,rJ:()=>k,rY:()=>r,v0:()=>f,vJ:()=>M,xJ:()=>c,xh:()=>S});var n=a(1990),o=a(7355),s=a(8108);let l={selectedAnnotation:-1,selectedVertex:-1,hoveringAnnotation:-1,hoveringVertex:-1,annotations:{},annotationsHistory:{0:{annotations:{},length:0}},historyIndex:0,selectedTool:"SELECT",width:640,height:640,selectedClassID:0,lastIndex:0,historyLastIndex:0,zoom:800,isDrawing:!1,isEditing:!1},i=(0,n.Z0)({name:"canvas",initialState:l,reducers:{loadAnnotations:(e,t)=>{e.lastIndex=t.payload.length;let a={};t.payload.forEach((e,t)=>{a[t]={object:e}}),e.annotations=a,e.annotationsHistory={0:{annotations:a,length:t.payload.length}}},startDrawRect:(e,t)=>{let a=t.payload.classID,n=t.payload.mousePosition,o={type:"bbox",class_id:a,x1:n.x,y1:n.y,x2:n.x,y2:n.y};e.annotations[e.lastIndex]={object:o},e.lastIndex+=1},drawPoint:(e,t)=>{let a=t.payload.classID,n=t.payload.mousePosition,o={type:"keypoint",class_id:a,x:n.x,y:n.y};e.annotations[e.lastIndex]={object:o},e.lastIndex+=1},resetHistory:e=>{e.annotationsHistory={0:{annotations:{},length:0}},e.historyIndex=0},saveAnnotationsHistory:e=>{e.annotationsHistory[e.historyIndex+1]={annotations:e.annotations,length:e.lastIndex},e.historyLastIndex=e.historyIndex+1,e.historyIndex+=1,console.log("saving state")},goForwardHistory:e=>{e.historyIndex<e.historyLastIndex&&(e.historyIndex+=1,e.annotations=e.annotationsHistory[e.historyIndex].annotations,e.lastIndex=e.annotationsHistory[e.historyIndex].length)},goBackwardHistory:e=>{e.historyIndex>0&&(e.historyIndex-=1,e.annotations=e.annotationsHistory[e.historyIndex].annotations,e.lastIndex=e.annotationsHistory[e.historyIndex].length)},updateDrawRect:(e,t)=>{let a=e.annotations[e.lastIndex-1].object;if("bbox"!=a.type)return;let n=t.payload;e.annotations[e.lastIndex-1].object={type:"bbox",class_id:a.class_id,x1:a.x1,y1:a.y1,x2:n.x,y2:n.y}},updateAnnotation:(e,t)=>{e.annotations[t.payload.Index].object=t.payload.updatedAnnotation},updateHoveringAnnotation:(e,t)=>{e.hoveringAnnotation=-1;let a=t.payload;for(let[t,n]of Object.entries(e.annotations)){switch(n.object.type){case"polygon":case"obb":case"line":break;case"bbox":o.A.containPoint(n.object,a.x,a.y)&&(e.hoveringAnnotation=Number(t));break;case"keypoint":s.A.isNear(n.object,a.x,a.y)&&(e.hoveringAnnotation=Number(t))}if(-1!=e.hoveringAnnotation)break}},updateHoveringVertex:(e,t)=>{let a=t.payload;if(e.selectedAnnotation>-1){let t=e.annotations[e.selectedAnnotation].object;switch(t.type){case"polygon":case"obb":case"line":break;case"bbox":let n=o.A.findNearestVertex(t,a.x,a.y);null!=n?e.hoveringVertex=n:e.hoveringVertex=-1}}},selectAnnotationFromHover:e=>{e.selectedAnnotation=e.hoveringAnnotation},selectVertexFromHover:e=>{e.selectedVertex=e.hoveringVertex},resetSelectedAnnotation:e=>{e.selectedAnnotation=-1},setSelectedAnnotation:(e,t)=>{e.selectedAnnotation=t.payload},resetSelectedVertex:e=>{e.selectedVertex=-1},moveVertex:(e,t)=>{let a=t.payload;if(e.selectedAnnotation>-1&&e.selectedVertex>-1){let t=e.annotations[e.selectedAnnotation].object;switch(t.type){case"polygon":case"obb":case"line":break;case"bbox":let n=o.A.moveVertex(t,a.x,a.y,e.selectedVertex);void 0!=n&&(e.annotations[e.selectedAnnotation].object=n)}}},moveSelectedPoint:(e,t)=>{let a=t.payload,n=e.annotations[e.selectedAnnotation].object;if("keypoint"==n.type){let t=s.A.move(n,a.x,a.y);e.annotations[e.selectedAnnotation].object=t}},setSelectedTool:(e,t)=>{e.selectedTool=t.payload},setCanvasSize:(e,t)=>{e.width=t.payload.width,e.height=t.payload.height},setSelectedClassID:(e,t)=>{e.selectedClassID=t.payload},removeAnnotation:(e,t)=>{delete e.annotations[t.payload]},setIsDrawing:(e,t)=>{e.isDrawing=t.payload},setIsEditing:(e,t)=>{e.isEditing=t.payload},resetCanvasState:()=>l}}),{startDrawRect:r,updateDrawRect:d,updateHoveringAnnotation:c,updateHoveringVertex:y,goBackwardHistory:x,goForwardHistory:h,selectAnnotationFromHover:b,selectVertexFromHover:p,setSelectedTool:u,moveVertex:g,resetCanvasState:v,resetSelectedAnnotation:m,resetSelectedVertex:I,saveAnnotationsHistory:A,setCanvasSize:C,setSelectedClassID:f,loadAnnotations:P,resetHistory:w,setSelectedAnnotation:S,removeAnnotation:_,updateAnnotation:k,setIsDrawing:j,setIsEditing:M,drawPoint:V,moveSelectedPoint:H}=i.actions,E=i.reducer},2738:(e,t,a)=>{"use strict";a.d(t,{M:()=>l});var n=a(1990),o=a(1783),s=a(1006);let l=(0,n.U1)({reducer:{canvas:o.Ay,settings:s.Ay}})},4147:e=>{e.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_8c1c42",variable:"__variable_8c1c42"}},5373:(e,t,a)=>{"use strict";a.d(t,{B:()=>i,ProjectProvider:()=>l});var n=a(5155),o=a(2115);let s=(0,o.createContext)(void 0);function l(e){let{children:t}=e,[a,l]=(0,o.useState)(null),[i,r]=(0,o.useState)(null),[d,c]=(0,o.useState)(null),[y,x]=(0,o.useState)(null),[h,b]=(0,o.useState)(!1);return(0,n.jsx)(s.Provider,{value:{rootDirHandle:a,setRootDirHandle:l,imagesDirHandle:i,setImagesDirHandle:r,annotationsDirHandle:d,setAnnotationsDirHandle:c,db:y,setDb:x,isReady:h,setIsReady:b},children:t})}function i(){let e=(0,o.useContext)(s);if(!e)throw Error("useProject must be used within a ProjectProvider");return e}},7355:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});class n{static moveVertex(e,t,a,n){if(null==n)return;let o={...e};switch(n){case 1:o.x1=t,o.y1=a;break;case 2:o.x2=t,o.y1=a;break;case 3:o.x2=t,o.y2=a;break;case 4:o.x1=t,o.y2=a}return o}static findNearestVertex(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.02,o=new Map([[1,{x:e.x1,y:e.y1}],[2,{x:e.x2,y:e.y1}],[3,{x:e.x2,y:e.y2}],[4,{x:e.x1,y:e.y2}]]),s=null,l=1/0;return o.forEach((e,o)=>{let i=Math.hypot(e.x-t,e.y-a);i<n&&i<l&&(l=i,s=o)}),s}static draw(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[255,0,0],s=t.width,l=t.height,i=t.getContext("2d");if(null==i)return;i.strokeStyle="rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 1)");let r=e.x1*s,d=e.x2*s,c=e.y1*l,y=e.y2*l;if(i.beginPath(),i.lineWidth=1,i.fillStyle="rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 0.9)"),i.rect(r-2,c-2,4,4),i.rect(r-2,y-2,4,4),i.rect(d-2,c-2,4,4),i.rect(d-2,y-2,4,4),n){let t=this.giveVertex(e,n);t&&i.rect(t.x*s-5,t.y*l-5,10,10)}i.fill(),i.rect(r,c,d-r,y-c),a?(i.fillStyle="rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 0.2)"),i.fill()):i.stroke()}static containPoint(e,t,a){let n=Math.min(e.x1,e.x2),o=Math.max(e.x1,e.x2),s=Math.min(e.y1,e.y2),l=Math.max(e.y1,e.y2);return!!(n<t)&&!!(t<o)&&!!(s<a)&&!!(a<l)}static giveVertex(e,t){switch(t){case 1:return{x:e.x1,y:e.y1};case 2:return{x:e.x2,y:e.y1};case 3:return{x:e.x2,y:e.y2};case 4:return{x:e.x1,y:e.y2};default:return null}}static longestDimSize(e){return Math.max(Math.abs(e.y2-e.y1),Math.abs(e.x2-e.x1))}}let o=n},7604:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,4147,23)),Promise.resolve().then(a.t.bind(a,8489,23)),Promise.resolve().then(a.t.bind(a,347,23)),Promise.resolve().then(a.bind(a,881)),Promise.resolve().then(a.bind(a,5373))},8108:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});class n{static move(e,t,a){return{...e,x:t,y:a}}static isNear(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.02;return Math.hypot(e.x-t,e.y-a)<n}static draw(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[255,0,0],o=t.width,s=t.height,l=e.x*o,i=e.y*s,r=t.getContext("2d");r&&(r.beginPath(),r.fillStyle="rgba(".concat(n[0],", ").concat(n[1],", ").concat(n[2],", 0.9)"),r.arc(l,i,3,0,2*Math.PI),r.fill(),a&&(r.beginPath(),r.strokeStyle="rgba(".concat(n[0],", ").concat(n[1],", ").concat(n[2],", 0.8)"),r.lineWidth=2,r.arc(l,i,6,0,2*Math.PI),r.stroke()))}}let o=n},8489:e=>{e.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_63cdcc",variable:"__variable_63cdcc"}}},e=>{var t=t=>e(e.s=t);e.O(0,[896,635,441,684,358],()=>t(7604)),_N_E=e.O()}]);